(function(t){function e(e){for(var n,r,o=e[0],l=e[1],c=e[2],h=0,d=[];h<o.length;h++)r=o[h],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&d.push(a[r][0]),a[r]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);u&&u(e);while(d.length)d.shift()();return s.push.apply(s,c||[]),i()}function i(){for(var t,e=0;e<s.length;e++){for(var i=s[e],n=!0,o=1;o<i.length;o++){var l=i[o];0!==a[l]&&(n=!1)}n&&(s.splice(e--,1),t=r(r.s=i[0]))}return t}var n={},a={app:0},s=[];function r(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=n,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var u=l;s.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},"04be":function(t,e,i){},1213:function(t,e,i){"use strict";i("fdfd")},"12f6":function(t,e,i){"use strict";i("8568")},"15ce":function(t,e,i){"use strict";i("32b6")},"162e":function(t,e,i){"use strict";i("46e6")},1864:function(t,e,i){"use strict";i("8dd3")},"1ba7":function(t,e,i){"use strict";i("e998")},"1c73":function(t,e,i){"use strict";i("c2cb")},"2b31":function(t,e,i){"use strict";i("a126")},"2bbd":function(t,e,i){"use strict";i("7b65")},"32b6":function(t,e,i){},3452:function(t,e,i){},"38e3":function(t,e,i){"use strict";i("7c75")},"46e6":function(t,e,i){},"4b42":function(t,e,i){"use strict";i("76c6")},"56d7":function(t,e,i){"use strict";i.r(e);i("caad"),i("2532"),i("e260"),i("e6cf"),i("cca6"),i("a79d");var n,a,s=i("2b0e"),r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:{"theme-light":"light"===t.appState.theme,"theme-dark":"dark"===t.appState.theme},attrs:{id:"app"}},["free"===t.appState.controls.state?i("FreeFlightMobileControls"):t._e(),i("ControlBar"),i("MainMenu",{attrs:{menu:t.appState.menu}})],1)},o=[],l=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"control-bar"},[i("MenuButton",{attrs:{close:t.appState.menu.isOpen,back:!1,title:t.$t("menu.tooltip")},on:{action:function(e){return t.appState.menu.reOpenPage()}}}),i("div",{staticClass:"space thin-hide"}),t.appState.maps.length>0?i("SvgButton",{staticClass:"thin-hide",attrs:{title:t.$t("maps.tooltip")},on:{action:function(e){t.appState.menu.openPage("maps",t.$t("maps.title"))}}},[i("svg",{attrs:{viewBox:"0 0 30 30"}},[i("polygon",{attrs:{points:"26.708,22.841 19.049,25.186 11.311,20.718 3.292,22.841 7.725,5.96 13.475,4.814 19.314,7.409 25.018,6.037 "}})])]):t._e(),t.markers.markerSets.length>0||t.markers.markers.length>0?i("SvgButton",{staticClass:"thin-hide",attrs:{title:t.$t("markers.tooltip")},on:{action:function(e){t.appState.menu.openPage("markers",t.$t("markers.title"),{markerSet:t.markers})}}},[i("svg",{attrs:{viewBox:"0 0 30 30"}},[i("path",{attrs:{d:"M15,3.563c-4.459,0-8.073,3.615-8.073,8.073c0,6.483,8.196,14.802,8.196,14.802s7.951-8.013,7.951-14.802\n\t\t\tC23.073,7.177,19.459,3.563,15,3.563z M15,15.734c-2.263,0-4.098-1.835-4.098-4.099c0-2.263,1.835-4.098,4.098-4.098\n\t\t\tc2.263,0,4.098,1.835,4.098,4.098C19.098,13.899,17.263,15.734,15,15.734z"}})])]):t._e(),t.playerMarkerSet.fake?t._e():i("SvgButton",{staticClass:"thin-hide",attrs:{title:t.$t("players.tooltip")},on:{action:t.openPlayerList}},[i("svg",{attrs:{viewBox:"0 0 30 30"}},[i("g",[i("path",{attrs:{d:"M8.95,14.477c0.409-0.77,1.298-1.307,2.164-1.309h0.026c-0.053-0.234-0.087-0.488-0.087-0.755\n\t\t\tc0-1.381,0.715-2.595,1.791-3.301c-0.01,0-0.021-0.006-0.03-0.006h-1.427c-0.39,0-0.514-0.251-0.276-0.563\n\t\t\tc0,0,0.497-0.645,0.497-1.452c0-1.48-1.2-2.681-2.679-2.681c-1.481,0-2.679,1.2-2.679,2.681c0,0.807,0.496,1.452,0.496,1.452\n\t\t\tc0.24,0.311,0.114,0.565-0.275,0.565L5.042,9.118C4.649,9.119,4.182,9.405,3.998,9.75l-2.601,4.927\n\t\t\tc-0.184,0.347-0.062,0.802,0.265,1.015l1.297,0.83c0.332,0.213,0.794,0.135,1.034-0.18l0.598-0.775\n\t\t\tc0.238-0.31,0.471-0.245,0.516,0.141l0.454,3.854c0.035,0.311,0.272,0.566,0.564,0.66c0.018-0.279,0.087-0.561,0.225-0.82\n\t\t\tL8.95,14.477z"}}),i("path",{attrs:{d:"M28.604,14.677l-2.597-4.94c-0.185-0.346-0.65-0.631-1.042-0.631h-1.428c-0.39,0-0.514-0.251-0.274-0.563\n\t\t\tc0,0,0.496-0.645,0.496-1.452c0-1.48-1.2-2.681-2.68-2.681c-1.481,0-2.679,1.2-2.679,2.681c0,0.807,0.496,1.452,0.496,1.452\n\t\t\tc0.239,0.311,0.114,0.565-0.275,0.565l-1.428,0.009c-0.005,0-0.009,0.002-0.015,0.002c1.067,0.708,1.774,1.917,1.774,3.292\n\t\t\tc0,0.263-0.031,0.513-0.084,0.744h0.02c0.868,0,1.758,0.537,2.166,1.305l2.598,4.944c0.137,0.262,0.205,0.539,0.222,0.818\n\t\t\tc0.296-0.092,0.538-0.35,0.574-0.664l0.451-3.842c0.044-0.389,0.28-0.452,0.519-0.143l0.588,0.768\n\t\t\tc0.239,0.313,0.702,0.391,1.033,0.182l1.297-0.833C28.667,15.479,28.787,15.026,28.604,14.677z"}})]),i("path",{attrs:{d:"M19.932,15.058c-0.184-0.346-0.651-0.63-1.043-0.63h-1.427c-0.39,0-0.515-0.252-0.275-0.564c0,0,0.496-0.645,0.496-1.451\n\t\tc0-1.479-1.199-2.68-2.679-2.68c-1.482,0-2.679,1.201-2.679,2.68c0,0.806,0.496,1.451,0.496,1.451\n\t\tc0.24,0.312,0.114,0.566-0.275,0.566l-1.427,0.009c-0.393,0.001-0.861,0.287-1.045,0.632l-2.602,4.925\n\t\tc-0.185,0.348-0.062,0.803,0.266,1.016l1.297,0.832c0.332,0.213,0.794,0.133,1.034-0.18l0.598-0.775\n\t\tc0.239-0.311,0.472-0.246,0.517,0.141l0.454,3.854c0.043,0.389,0.403,0.705,0.794,0.705h5.148c0.392,0,0.749-0.316,0.794-0.705\n\t\tl0.45-3.844c0.045-0.389,0.282-0.451,0.52-0.143l0.587,0.768c0.239,0.313,0.703,0.393,1.033,0.182l1.297-0.832\n\t\tc0.331-0.213,0.451-0.666,0.269-1.016L19.932,15.058z"}})])]),i("div",{staticClass:"space thin-hide greedy"}),i("DayNightSwitch",{staticClass:"thin-hide",attrs:{title:t.$t("lighting.dayNightSwitch.tooltip")}}),i("div",{staticClass:"space thin-hide"}),i("ControlsSwitch",{staticClass:"thin-hide"}),i("div",{staticClass:"space thin-hide"}),i("SvgButton",{staticClass:"thin-hide",attrs:{title:t.$t("resetCamera.tooltip")},on:{action:function(e){return t.$bluemap.resetCamera()}}},[i("svg",{attrs:{viewBox:"0 0 30 30"}},[i("rect",{attrs:{x:"7.085",y:"4.341",transform:"matrix(0.9774 0.2116 -0.2116 0.9774 3.2046 -1.394)",width:"2.063",height:"19.875"}}),i("path",{attrs:{d:"M12.528,5.088c0,0,3.416-0.382,4.479-0.031c1.005,0.332,2.375,2.219,3.382,2.545c1.096,0.354,4.607-0.089,4.607-0.089\n      l-2.738,8.488c0,0-3.285,0.641-4.344,0.381c-1.049-0.257-2.607-2.015-3.642-2.324c-0.881-0.264-3.678-0.052-3.678-0.052\n      L12.528,5.088z"}})])]),i("PositionInput",{staticClass:"pos-input"}),i("Compass",{attrs:{title:t.$t("compass.tooltip")}})],1)},c=[],u=i("b85c"),h=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"position-input"},[i("NumberInput",{attrs:{label:"x",value:t.controls.position.x},on:{input:function(e){t.controls.position.x=parseFloat(e.target.value)}}}),"free"===t.appState.controls.state?i("NumberInput",{attrs:{label:"y",value:t.controls.position.y},on:{input:function(e){t.controls.position.y=parseFloat(e.target.value)}}}):t._e(),i("NumberInput",{attrs:{label:"z",value:t.controls.position.z},on:{input:function(e){t.controls.position.z=parseFloat(e.target.value)}}})],1)},d=[],p=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"number-input"},[i("label",[i("span",{staticClass:"label"},[t._v(t._s(t.label)+":")]),i("input",{attrs:{type:"number"},domProps:{value:t._f("format")(t.value)},on:{input:function(e){return t.$emit("input",e)},keydown:function(t){return t.stopPropagation()}}})])])},m=[],f=(i("a9e3"),{name:"NumberInput",props:{label:String,value:Number},filters:{format:function(t){return Math.floor(t)}}}),v=f,g=(i("1ba7"),i("2877")),y=Object(g["a"])(v,p,m,!1,null,null,null),b=y.exports,w={name:"PositionInput",components:{NumberInput:b},data:function(){return{controls:this.$bluemap.mapViewer.controlsManager.data,appState:this.$bluemap.appState}}},k=w,M=(i("982f"),Object(g["a"])(k,h,d,!1,null,null,null)),S=M.exports,x=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("SvgButton",{staticClass:"compass",on:{action:t.action}},[i("svg",{style:t.style,attrs:{viewBox:"0 0 30 30"}},[i("path",{staticClass:"north",attrs:{d:"M14.792,1.04c0.114-0.354,0.299-0.354,0.412,0l4.089,12.729c0.114,0.353-0.097,0.642-0.468,0.642\n      l-7.651,0.001c-0.371,0-0.581-0.288-0.468-0.642L14.792,1.04z"}}),i("path",{staticClass:"south",attrs:{d:"M10.707,16.23c-0.114-0.353,0.097-0.642,0.468-0.642l7.651-0.001c0.371,0,0.581,0.289,0.468,0.642\n      l-4.086,12.73c-0.113,0.353-0.299,0.353-0.412,0L10.707,16.23z"}})])])},O=[],j=(i("99af"),i("2b19"),i("d3b7"),i("ac1f"),i("25f0"),i("1276"),i("498a"),i("159b"),i("53ca")),T=i("5a89"),P=new T["K"](0,0),D=(new T["L"](0,0,0),new T["L"](1,0,0),new T["L"](0,1,0),new T["L"](0,0,1),function(t){var e=document.createElementNS("http://www.w3.org/1999/xhtml","img");return e.src=t,e}),L=function(t,e){var i="x";return i+=E(t),i+="z",i+=E(e),i=i.substring(0,i.length-1),i},E=function(t){var e="";t<0&&(t=-t,e+="-");for(var i=t.toString(),n=0;n<i.length;n++)e+=i.charAt(n)+"/";return e},C=function(t,e){return"x".concat(t,"z").concat(e)},_=function(){return Math.round(1e6*Math.random())},A=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t&&t.dispatchEvent)return t.dispatchEvent(new CustomEvent(e,{detail:i}))},z=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"info",n=A(t,"bluemapAlert",{message:e,level:i});n&&("info"===i?console.log("[BlueMap/".concat(i,"]"),e):"warning"===i?console.warn("[BlueMap/".concat(i,"]"),e):"error"===i?console.error("[BlueMap/".concat(i,"]"),e):console.debug("[BlueMap/".concat(i,"]"),e))},U=function(t){var e=document.createElement("template");return e.innerHTML=t.trim(),e.content.firstChild},F=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n={animationStart:-1,lastFrame:-1,cancelled:!1,frame:function(n){var a=this;if(!this.cancelled){-1===this.animationStart&&(this.animationStart=n,this.lastFrame=n);var s=0===e?1:T["q"].clamp((n-this.animationStart)/e,0,1),r=n-this.lastFrame;t(s,r),s<1?window.requestAnimationFrame((function(t){return a.frame(t)})):i&&i(!0),this.lastFrame=n}},cancel:function(){this.cancelled=!0,i&&i(!1)}};return window.requestAnimationFrame((function(t){return n.frame(t)})),n},V={linear:function(t){return t},easeInQuad:function(t){return t*t},easeOutQuad:function(t){return t*(2-t)},easeInOutQuad:function(t){return t<.5?2*t*t:(4-2*t)*t-1},easeInCubic:function(t){return t*t*t},easeOutCubic:function(t){return--t*t*t+1},easeInOutCubic:function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},easeInQuart:function(t){return t*t*t*t},easeOutQuart:function(t){return 1- --t*t*t*t},easeInOutQuart:function(t){return t<.5?8*t*t*t*t:1-8*--t*t*t*t},easeInQuint:function(t){return t*t*t*t*t},easeOutQuint:function(t){return 1+--t*t*t*t*t},easeInOutQuint:function(t){return t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t}},R=function(t){var e=t.getBoundingClientRect(),i=window.pageXOffset||document.documentElement.scrollLeft,n=window.pageYOffset||document.documentElement.scrollTop;return{top:e.top+n,left:e.left+i}},H=function t(e,i){if(Object.is(e,i))return!0;var n=Object(j["a"])(e);if(n!==Object(j["a"])(i))return!1;if("number"===n||"boolean"===n||"string"===n)return!1;if(Array.isArray(e)){var a=e.length;if(a!==i.length)return!1;for(var s=0;s<a;s++)if(!t(e[s],i[s]))return!1;return!0}for(var r in e)if(e.hasOwnProperty(r)&&!t(e[r],i[r]))return!1;return!0},B=function(t,e,i){if(t>=e)return t;var n=e-t;return n<1e-4?e:t+n*i},$=function(t,e,i){if(t<=e)return t;var n=t-e;return n<1e-4?e:t-n*i},I=function(t,e,i,n){return $(B(t,e,n),i,n)},K=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"svg-button",class:{active:t.active},on:{click:function(e){return t.$emit("action",e)}}},[t._t("default")],2)},N=[],Y={name:"SvgButton",props:{active:Boolean}},W=Y,q=(i("162e"),Object(g["a"])(W,K,N,!1,null,null,null)),G=q.exports,X={name:"Compass",components:{SvgButton:G},data:function(){return{controls:this.$bluemap.mapViewer.controlsManager.data}},computed:{style:function(){return{transform:"translate(-50%, -50%) rotate("+-this.controls.rotation+"rad)"}}},methods:{action:function(t){var e=this;t.preventDefault(),n&&n.cancel();var i=this.controls.rotation;n=F((function(t){e.controls.rotation=i*(1-V.easeOutQuad(t))}),300)}}},Z=X,Q=(i("38e3"),Object(g["a"])(Z,x,O,!1,null,null,null)),J=Q.exports,tt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("SvgButton",{staticClass:"day-night-switch",attrs:{active:!t.isDay},on:{action:t.action}},[i("svg",{attrs:{viewBox:"0 0 30 30"}},[i("path",{attrs:{d:"M17.011,19.722c-3.778-1.613-5.533-5.982-3.921-9.76c0.576-1.348,1.505-2.432,2.631-3.204\n      c-3.418-0.243-6.765,1.664-8.186,4.992c-1.792,4.197,0.159,9.053,4.356,10.844c3.504,1.496,7.462,0.377,9.717-2.476\n      C20.123,20.465,18.521,20.365,17.011,19.722z"}}),i("circle",{attrs:{cx:"5.123",cy:"7.64",r:"1.196"}}),i("circle",{attrs:{cx:"23.178",cy:"5.249",r:"1.195"}}),i("circle",{attrs:{cx:"20.412",cy:"13.805",r:"1.195"}}),i("circle",{attrs:{cx:"25.878",cy:"23.654",r:"1.195"}})])])},et=[],it={name:"DayNightSwitch",components:{SvgButton:G},data:function(){return{mapViewer:this.$bluemap.mapViewer.data}},computed:{isDay:function(){return this.mapViewer.uniforms.sunlightStrength.value>.6}},methods:{action:function(t){var e=this;t.preventDefault(),a&&a.cancel();var i=this.mapViewer.uniforms.sunlightStrength.value,n=this.isDay?.25:1;a=F((function(t){var a=V.easeOutQuad(t);e.mapViewer.uniforms.sunlightStrength.value=i*(1-a)+n*a}),300)}}},nt=it,at=(i("1c73"),Object(g["a"])(nt,tt,et,!1,null,null,null)),st=at.exports,rt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"controls-switch"},[i("SvgButton",{attrs:{active:t.isPerspectiveView,title:t.$t("controls.perspective.tooltip")},on:{action:t.setPerspectiveView}},[i("svg",{attrs:{viewBox:"0 0 30 30"}},[i("path",{attrs:{d:"M19.475,10.574c-0.166-0.021-0.337-0.036-0.51-0.045c-0.174-0.009-0.35-0.013-0.525-0.011\n        c-0.176,0.002-0.353,0.01-0.526,0.024c-0.175,0.015-0.347,0.036-0.515,0.063l-13.39,2.189\n        c-0.372,0.061-0.7,0.146-0.975,0.247c-0.276,0.102-0.5,0.221-0.66,0.349c-0.161,0.129-0.259,0.268-0.282,0.408\n        c-0.024,0.141,0.028,0.285,0.165,0.421l5.431,5.511c0.086,0.087,0.191,0.167,0.314,0.241s0.263,0.142,0.417,0.202\n        c0.155,0.062,0.323,0.115,0.502,0.162c0.18,0.046,0.371,0.085,0.569,0.116s0.405,0.054,0.616,0.068\n        c0.211,0.015,0.427,0.021,0.645,0.017c0.217-0.003,0.436-0.016,0.652-0.037c0.217-0.022,0.431-0.054,0.641-0.095L27.12,17.43\n        c0.371-0.073,0.679-0.175,0.917-0.296c0.236-0.12,0.404-0.259,0.497-0.407c0.093-0.147,0.111-0.305,0.052-0.461\n        c-0.059-0.156-0.195-0.313-0.415-0.46l-7.089-4.742c-0.089-0.06-0.192-0.115-0.308-0.166\n        c-0.116-0.051-0.243-0.097-0.381-0.138c-0.137-0.041-0.283-0.078-0.438-0.108C19.803,10.621,19.641,10.595,19.475,10.574"}})])]),i("SvgButton",{attrs:{active:t.isFlatView,title:t.$t("controls.flatView.tooltip")},on:{action:t.setFlatView}},[i("svg",{attrs:{viewBox:"0 0 30 30"}},[i("path",{attrs:{d:"M22.371,4.158c1.65,0,3,1.35,3,3v15.684c0,1.65-1.35,3-3,3H7.629c-1.65,0-3-1.35-3-3V7.158c0-1.65,1.35-3,3-3H22.371z"}})])]),i("SvgButton",{attrs:{active:t.isFreeFlight,title:t.$t("controls.freeFlight.tooltip")},on:{action:t.setFreeFlight}},[i("svg",{attrs:{viewBox:"0 0 30 30"}},[i("path",{attrs:{d:"M21.927,11.253c-0.256-0.487-0.915-0.885-1.465-0.885h-2.004c-0.55,0-0.726-0.356-0.39-0.792c0,0,0.698-0.905,0.698-2.041\n        c0-2.08-1.687-3.767-3.767-3.767s-3.767,1.687-3.767,3.767c0,1.136,0.698,2.041,0.698,2.041c0.336,0.436,0.161,0.794-0.389,0.797\n        l-2.005,0.01c-0.55,0.002-1.21,0.403-1.467,0.889l-3.656,6.924c-0.257,0.487-0.088,1.128,0.375,1.425l1.824,1.171\n        c0.462,0.297,1.116,0.184,1.451-0.253l0.839-1.092c0.335-0.437,0.662-0.346,0.726,0.2l0.637,5.415\n        c0.064,0.546,0.567,0.993,1.117,0.993h7.234c0.55,0,1.053-0.447,1.117-0.993l0.635-5.401c0.064-0.546,0.392-0.637,0.727-0.2\n        l0.828,1.078c0.335,0.437,0.988,0.55,1.451,0.253l1.823-1.171c0.463-0.297,0.633-0.938,0.377-1.425L21.927,11.253z"}})])])],1)},ot=[],lt={name:"ControlsSwitch",components:{SvgButton:G},data:function(){return{controls:this.$bluemap.appState.controls}},computed:{isPerspectiveView:function(){return"perspective"===this.controls.state},isFlatView:function(){return"flat"===this.controls.state},isFreeFlight:function(){return"free"===this.controls.state}},methods:{setPerspectiveView:function(){this.$bluemap.setPerspectiveView(500,this.isFreeFlight?100:0)},setFlatView:function(){this.$bluemap.setFlatView(500,this.isFreeFlight?100:0)},setFreeFlight:function(){this.$bluemap.setFreeFlight(500)}}},ct=lt,ut=(i("15ce"),Object(g["a"])(ct,rt,ot,!1,null,null,null)),ht=ut.exports,dt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("SvgButton",{staticClass:"menu-button",class:{close:t.close,back:t.back},on:{action:function(e){return t.$emit("action",e)}}},[i("svg",{attrs:{viewBox:"0 0 30 30"}},[i("g",[i("path",{attrs:{d:"M25.004,9.294c0,0.806-0.75,1.46-1.676,1.46H6.671c-0.925,0-1.674-0.654-1.674-1.46l0,0\n  c0-0.807,0.749-1.461,1.674-1.461h16.657C24.254,7.833,25.004,8.487,25.004,9.294L25.004,9.294z"}}),i("path",{attrs:{d:"M25.004,15c0,0.807-0.75,1.461-1.676,1.461H6.671c-0.925,0-1.674-0.654-1.674-1.461l0,0\n  c0-0.807,0.749-1.461,1.674-1.461h16.657C24.254,13.539,25.004,14.193,25.004,15L25.004,15z"}}),i("path",{attrs:{d:"M25.004,20.706c0,0.807-0.75,1.461-1.676,1.461H6.671c-0.925,0-1.674-0.654-1.674-1.461l0,0\n  c0-0.807,0.749-1.461,1.674-1.461h16.657C24.254,19.245,25.004,19.899,25.004,20.706L25.004,20.706z"}})])])])},pt=[],mt={name:"MenuButton",components:{SvgButton:G},props:{close:Boolean,back:Boolean}},ft=mt,vt=(i("1864"),Object(g["a"])(ft,dt,pt,!1,null,null,null)),gt=vt.exports,yt={name:"ControlBar",components:{SvgButton:G,MenuButton:gt,ControlsSwitch:ht,DayNightSwitch:st,PositionInput:S,Compass:J},data:function(){return{appState:this.$bluemap.appState,markers:this.$bluemap.mapViewer.markers.data}},computed:{playerMarkerSet:function(){var t,e=Object(u["a"])(this.markers.markerSets);try{for(e.s();!(t=e.n()).done;){var i=t.value;if("bm-players"===i.id)return i}}catch(n){e.e(n)}finally{e.f()}return{id:"bm-players",label:"Players",markerSets:[],markers:[],fake:!0}}},methods:{openPlayerList:function(){var t=this.playerMarkerSet;this.appState.menu.openPage("markers",this.$t("players.title"),{markerSet:t})}}},bt=yt,wt=(i("6865"),Object(g["a"])(bt,l,c,!1,null,null,null)),kt=wt.exports,Mt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("SideMenu",{attrs:{open:t.menu.isOpen,title:t.menu.currentPage().title,back:t.menu.pageStack.length>1},on:{back:function(e){return t.menu.closePage()},close:function(e){return t.menu.closeAll()}}},["root"===t.menu.currentPage().id?i("div",[i("SimpleButton",{attrs:{submenu:!0},on:{action:function(e){t.menu.openPage("maps",(function(){return t.$t("maps.title")}))}}},[t._v(t._s(t.$t("maps.button")))]),i("SimpleButton",{attrs:{submenu:!0},on:{action:function(e){t.menu.openPage("markers",(function(){return t.$t("markers.title")}),{markerSet:t.markers})}}},[t._v(t._s(t.$t("markers.button")))]),i("SimpleButton",{attrs:{submenu:!0},on:{action:function(e){t.menu.openPage("settings",(function(){return t.$t("settings.title")}))}}},[t._v(t._s(t.$t("settings.button")))]),i("SimpleButton",{attrs:{submenu:!0},on:{action:function(e){t.menu.openPage("info",(function(){return t.$t("info.title")}))}}},[t._v(t._s(t.$t("info.button")))]),i("hr"),i("SimpleButton",{on:{action:t.goFullscreen}},[t._v(t._s(t.$t("goFullscreen.button")))]),i("SimpleButton",{on:{action:function(e){return t.$bluemap.resetCamera()}}},[t._v(t._s(t.$t("resetCamera.button")))]),i("SimpleButton",{attrs:{title:t.$t("updateMap.tooltip")},on:{action:function(e){return t.$bluemap.updateMap()}}},[t._v(t._s(t.$t("updateMap.button")))])],1):t._e(),"maps"===t.menu.currentPage().id?i("div",t._l(t.appState.maps,(function(t){return i("MapButton",{key:t.id,attrs:{map:t}})})),1):t._e(),"markers"===t.menu.currentPage().id?i("MarkerSetMenu",{attrs:{menu:t.menu}}):t._e(),"settings"===t.menu.currentPage().id?i("SettingsMenu"):t._e(),"info"===t.menu.currentPage().id?i("div",{staticClass:"info-content",domProps:{innerHTML:t._s(t.$t("info.content"))}}):t._e()],1)},St=[],xt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Transition",{attrs:{name:"side-menu"},on:{enter:function(e){t.buttonEnterAnimation(),t.$emit("enter",e)}}},[t.open?i("div",{staticClass:"side-menu"},[i("MenuButton",{attrs:{close:t.open&&t.rendered,back:t.back},on:{action:function(e){return t.$emit("back",e)}}}),t.open&&t.back?i("MenuButton",{staticClass:"full-close",attrs:{close:!0},on:{action:function(e){return t.$emit("close",e)}}}):t._e(),i("div",{staticClass:"title"},[t._v(t._s(t.title))]),i("div",{staticClass:"content"},[t._t("default")],2)],1):t._e()])},Ot=[],jt=(i("96cf"),i("1da1")),Tt={name:"SideMenu",components:{MenuButton:gt},props:{title:{type:String,default:"Menu"},open:{type:Boolean,default:!0},back:Boolean},data:function(){return{rendered:!1}},methods:{buttonEnterAnimation:function(){var t=this;return Object(jt["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.rendered=!1,e.next=3,t.$nextTick();case 3:return e.next=5,t.$nextTick();case 5:t.rendered=!0;case 6:case"end":return e.stop()}}),e)})))()}}},Pt=Tt,Dt=(i("4b42"),Object(g["a"])(Pt,xt,Ot,!1,null,null,null)),Lt=Dt.exports,Et=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"simple-button",class:{active:t.active},on:{click:function(e){return t.$emit("action")}}},[i("div",{staticClass:"label"},[t._t("default")],2),t.submenu?i("div",{staticClass:"submenu-icon"},[i("svg",{attrs:{viewBox:"0 0 30 30"}},[i("path",{attrs:{d:"M25.004,9.294c0,0.806-0.75,1.46-1.676,1.46H6.671c-0.925,0-1.674-0.654-1.674-1.46l0,0\n\tc0-0.807,0.749-1.461,1.674-1.461h16.657C24.254,7.833,25.004,8.487,25.004,9.294L25.004,9.294z"}}),i("path",{attrs:{d:"M25.004,20.706c0,0.807-0.75,1.461-1.676,1.461H6.671c-0.925,0-1.674-0.654-1.674-1.461l0,0\n\tc0-0.807,0.749-1.461,1.674-1.461h16.657C24.254,19.245,25.004,19.899,25.004,20.706L25.004,20.706z"}})])]):t._e()])},Ct=[],_t={name:"SimpleButton",props:{submenu:Boolean,active:{type:Boolean,default:!1}}},At=_t,zt=(i("9eb8"),Object(g["a"])(At,Et,Ct,!1,null,null,null)),Ut=zt.exports,Ft=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("Group",{attrs:{title:t.$t("controls.title")}},[i("SimpleButton",{attrs:{active:"perspective"===t.appState.controls.state},on:{action:function(e){return t.$bluemap.setPerspectiveView(500,"free"===t.appState.controls.state?100:0)}}},[t._v(t._s(t.$t("controls.perspective.button")))]),i("SimpleButton",{attrs:{active:"flat"===t.appState.controls.state},on:{action:function(e){return t.$bluemap.setFlatView(500,"free"===t.appState.controls.state?100:0)}}},[t._v(t._s(t.$t("controls.flatView.button")))]),i("SimpleButton",{attrs:{active:"free"===t.appState.controls.state},on:{action:function(e){return t.$bluemap.setFreeFlight(500)}}},[t._v(t._s(t.$t("controls.freeFlight.button")))])],1),i("Group",{attrs:{title:t.$t("lighting.title")}},[i("Slider",{attrs:{value:t.mapViewer.uniforms.sunlightStrength.value,min:0,max:1,step:.01},on:{update:function(e){t.mapViewer.uniforms.sunlightStrength.value=e}}},[t._v(t._s(t.$t("lighting.sunlight")))]),i("Slider",{attrs:{value:t.mapViewer.uniforms.ambientLight.value,min:0,max:1,step:.01},on:{update:function(e){t.mapViewer.uniforms.ambientLight.value=e}}},[t._v(t._s(t.$t("lighting.ambientLight")))])],1),i("Group",{attrs:{title:t.$t("resolution.title")}},t._l(t.qualityStages,(function(e){return i("SimpleButton",{key:e.name,attrs:{active:t.mapViewer.superSampling===e.value},on:{action:function(i){t.$bluemap.mapViewer.superSampling=e.value,t.$bluemap.saveUserSettings()}}},[t._v(t._s(e.name))])})),1),i("Group",{attrs:{title:t.$t("renderDistance.title")}},[i("Slider",{attrs:{value:t.mapViewer.loadedHiresViewDistance,min:50,max:500,step:10},on:{update:function(e){t.mapViewer.loadedHiresViewDistance=e,t.$bluemap.mapViewer.updateLoadedMapArea()},lazy:function(e){return t.$bluemap.saveUserSettings()}}},[t._v(t._s(t.$t("renderDistance.hiresLayer")))]),i("Slider",{attrs:{value:t.mapViewer.loadedLowresViewDistance,min:500,max:1e4,step:100},on:{update:function(e){t.mapViewer.loadedLowresViewDistance=e,t.$bluemap.mapViewer.updateLoadedMapArea()},lazy:function(e){return t.$bluemap.saveUserSettings()}}},[t._v(t._s(t.$t("renderDistance.lowersLayer")))])],1),i("Group",{attrs:{title:t.$t("freeFlightControls.title")}},[i("Slider",{attrs:{value:t.appState.controls.mouseSensitivity,min:.1,max:5,step:.05},on:{update:function(e){t.appState.controls.mouseSensitivity=e,t.$bluemap.updateControlsSettings()},lazy:function(e){return t.$bluemap.saveUserSettings()}}},[t._v(t._s(t.$t("freeFlightControls.mouseSensitivity")))]),i("SwitchButton",{attrs:{on:t.appState.controls.invertMouse},on:{action:function(e){t.appState.controls.invertMouse=!t.appState.controls.invertMouse,t.$bluemap.updateControlsSettings(),t.$bluemap.saveUserSettings()}}},[t._v(t._s(t.$t("freeFlightControls.invertMouseY")))])],1),i("Group",{attrs:{title:t.$t("theme.title")}},t._l(t.themes,(function(e){return i("SimpleButton",{key:e.name,attrs:{active:t.appState.theme===e.value},on:{action:function(i){t.$bluemap.setTheme(e.value),t.$bluemap.saveUserSettings()}}},[t._v(t._s(e.name))])})),1),t.$i18n.languages.length>1?i("Group",{attrs:{title:t.$t("language.title")}},t._l(t.$i18n.languages,(function(e){return i("SimpleButton",{key:e.locale,attrs:{active:e.locale===t.$i18n.locale},on:{action:function(i){t.$i18n.setLanguage(e.locale),t.$bluemap.saveUserSettings()}}},[t._v(t._s(e.name))])})),1):t._e(),i("SwitchButton",{attrs:{on:t.appState.debug},on:{action:function(e){t.switchDebug(),t.$bluemap.saveUserSettings()}}},[t._v(t._s(t.$t("debug.button")))]),i("SimpleButton",{on:{action:function(e){return t.$bluemap.resetSettings()}}},[t._v(t._s(t.$t("resetAllSettings.button")))])],1)},Vt=[],Rt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"group"},[i("span",{staticClass:"title"},[t._v(t._s(t.title))]),i("div",{staticClass:"content"},[t._t("default")],2)])},Ht=[],Bt={name:"Group",props:{title:String}},$t=Bt,It=(i("fd67"),Object(g["a"])($t,Rt,Ht,!1,null,null,null)),Kt=It.exports,Nt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"slider"},[i("div",{staticClass:"label"},[t._t("default"),t._v(": "),i("span",{staticClass:"value"},[t._v(t._s(t.formattedValue))])],2),i("label",[i("input",{attrs:{type:"range",min:t.min,max:t.max,step:t.step},domProps:{value:t.value},on:{input:function(e){t.$emit("update",parseFloat(e.target.value))},change:function(e){t.$emit("lazy",parseFloat(e.target.value))}}})])])},Yt=[];i("b680");function Wt(t){return Math.floor(t)===t?0:t.toString().split(".")[1].length||0}var qt={name:"Slider",props:{value:Number,min:Number,max:Number,step:Number},computed:{formattedValue:function(){return parseFloat(this.value).toFixed(Wt(this.step))}}},Gt=qt,Xt=(i("c70c"),Object(g["a"])(Gt,Nt,Yt,!1,null,null,null)),Zt=Xt.exports,Qt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"switch-button",on:{click:function(e){return t.$emit("action")}}},[i("div",{staticClass:"label"},[t._t("default")],2),i("SwitchHandle",{attrs:{on:t.on}})],1)},Jt=[],te=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"switch",class:{on:t.on}})},ee=[],ie={name:"SwitchHandle",props:{on:Boolean}},ne=ie,ae=(i("ef8f"),Object(g["a"])(ne,te,ee,!1,null,null,null)),se=ae.exports,re={name:"SwitchButton",components:{SwitchHandle:se},props:{on:Boolean}},oe=re,le=(i("635d"),Object(g["a"])(oe,Qt,Jt,!1,null,null,null)),ce=le.exports,ue=i("a925"),he={pageTitle:"BlueMap - {map}",menu:{title:"Menu",tooltip:"Menu"},maps:{title:"Maps",button:"Maps",tooltip:"Map-List"},markers:{title:"Markers",button:"Markers",tooltip:"Marker-List",marker:"marker | markers",markerSet:"marker-set | marker-sets"},settings:{title:"Settings",button:"Settings"},goFullscreen:{button:"Go Fullscreen"},resetCamera:{button:"Reset Camera",tooltip:"Reset Camera & Position"},updateMap:{button:"Update Map",tooltip:"Clear Tile Cache"},lighting:{title:"Lighting",dayNightSwitch:{tooltip:"Day/Night"},sunlight:"Sunlight",ambientLight:"Ambient-Light"},resolution:{title:"Resolution",high:"High (SSAA, x2)",normal:"Normal (Native, x1)",low:"Low (Upscaling, x0.5)"},freeFlightControls:{title:"Free-Flight Controls",mouseSensitivity:"Mouse-Sensitivity",invertMouseY:"Invert Mouse Y"},renderDistance:{title:"Render Distance",hiresLayer:"Hires layer",lowersLayer:"Lowres layer"},theme:{title:"Theme",default:"Default (System/Browser)",dark:"Dark",light:"Light"},debug:{button:"Debug"},resetAllSettings:{button:"Reset All Settings"},players:{title:"Players",tooltip:"Player-List"},compass:{tooltip:"Compass / Face North"},controls:{title:"View / Controls",perspective:{button:"Perspective",tooltip:"Perspective-View"},flatView:{button:"Flat",tooltip:"Orthographic / Flat-View"},freeFlight:{button:"Free-Flight",tooltip:"Free-Flight / Spectator Mode"}},language:{title:"Language"},blockTooltip:{block:"Block",position:"Position",chunk:"Chunk",region:{region:"Region",file:"File"},light:{light:"Light",sun:"Sun",block:"Block"}},info:{title:"Info",button:"Info",content:'\n<img src="assets/logo.png" style="display: block; width: 40%; margin: 3em auto; border-radius: 50%">\n<p>\n\t<h2>Mouse-Controls:</h2>\n\t<table>\n\t\t<tr><th>move</th><td><kbd>left-click</kbd> + drag</td></tr>\n\t\t<tr><th>zoom</th><td><kbd>mousewheel</kbd> (scroll)</td></tr>\n\t\t<tr><th>rotate / tilt</th><td><kbd>right-click</kbd> + drag</td></tr>\n\t</table>\n</p>\n<p>\n\t<h2>Keyboard-Controls:</h2>\n\t<table>\n\t\t<tr><th>move</th><td><kbd>wasd</kbd> / <kbd>arrow-keys</kbd></td></tr>\n\t\t<tr><th>zoom</th><td>Numpad: <kbd>+</kbd>/<kbd>-</kbd> or <kbd>Ins</kbd>/<kbd>Home</kbd></td></tr>\n\t\t<tr><th>rotate / tilt</th><td><kbd>Left-Alt</kbd> + <kbd>wasd</kbd> / <kbd>arrow-keys</kbd> or <kbd>Delete</kbd>/<kbd>End</kbd>/<kbd>Page Up</kbd>/<kbd>Page Down</kbd></td></tr>\n\t</table>\n</p>\n<p>\n\t<h2>Touch-Controls:</h2>\n\t<table>\n\t\t<tr><th>move</th><td>touch + drag</td></tr>\n\t\t<tr><th>zoom</th><td>touch with two fingers + pinch</td></tr>\n\t\t<tr><th>rotate / tilt</th><td>touch with two fingers + rotate / move up/down</td></tr>\n\t</table>\n</p>\n<br><hr>\n<p>\n\tThis map has been generated with &#9829; using <a href="https://bluecolo.red/bluemap">BlueMap</a>.\n</p>\n\t\t'}};ue["a"].prototype.setLanguage=function(){var t=Object(jt["a"])(regeneratorRuntime.mark((function t(e){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,this.messages[e]){t.next=7;break}return i={},t.next=5,import("../lang/".concat(e,".js"));case 5:i=t.sent.default,this.setLocaleMessage(e,i);case 7:this.locale=e,document.querySelector("html").setAttribute("lang",e),t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](0),console.error("Failed to load language '".concat(e,"'!"),t.t0);case 14:case"end":return t.stop()}}),t,this,[[0,11]])})));return function(e){return t.apply(this,arguments)}}(),ue["a"].prototype.loadLanguageSettings=Object(jt["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,import("../lang/settings.js");case 2:e=t.sent.default,this.languages=e.languages,this.setLanguage(e.default);case 5:case"end":return t.stop()}}),t,this)}))),s["a"].use(ue["a"]);var de=new ue["a"]({locale:"fallback",fallbackLocale:"fallback",silentFallbackWarn:!0,messages:{fallback:he}}),pe=de,me=[{get name(){return pe.t("theme.default")},value:null},{get name(){return pe.t("theme.dark")},value:"dark"},{get name(){return pe.t("theme.light")},value:"light"}],fe=[{get name(){return pe.t("resolution.high")},value:2},{get name(){return pe.t("resolution.normal")},value:1},{get name(){return pe.t("resolution.low")},value:.5}],ve={name:"SettingsMenu",components:{SwitchButton:ce,Slider:Zt,SimpleButton:Ut,Group:Kt},data:function(){return{appState:this.$bluemap.appState,mapViewer:this.$bluemap.mapViewer.data,qualityStages:fe,themes:me}},methods:{switchDebug:function(){this.$bluemap.setDebug(!this.appState.debug)}}},ge=ve,ye=Object(g["a"])(ge,Ft,Vt,!1,null,null,null),be=ye.exports,we=(i("a434"),i("5530")),ke=i("d4ec"),Me=i("bee2"),Se=i("ade3"),xe=function(){function t(){Object(ke["a"])(this,t),this.isOpen=!1,this.pageStack=[]}return Object(Me["a"])(t,[{key:"currentPage",value:function(){return 0===this.pageStack.length?t.NULL_PAGE:this.pageStack[this.pageStack.length-1]}},{key:"openPage",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"root",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return pe.t("menu.title")},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.isOpen||(this.pageStack.splice(0,this.pageStack.length),this.isOpen=!0),"function"===typeof e?this.pageStack.push(Object(we["a"])({id:t,get title(){return e()}},i)):this.pageStack.push(Object(we["a"])({id:t,title:e},i))}},{key:"closePage",value:function(){this.pageStack.splice(this.pageStack.length-1,1),this.pageStack.length<1&&(this.isOpen=!1)}},{key:"reOpenPage",value:function(){0===this.pageStack.length?this.openPage():"root"!==this.pageStack[0].id?(this.pageStack.splice(0,this.pageStack.length),this.openPage()):this.isOpen=!0}},{key:"closeAll",value:function(){this.isOpen=!1}}]),t}();Object(Se["a"])(xe,"NULL_PAGE",{id:"-",title:"-"});var Oe=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"marker-sets"},t._l(t.filteredMarkerSets,(function(e){return i("MarkerSet",{key:e.id,attrs:{"marker-set":e},on:{more:function(i){return t.openMore(e)}}})})),1),t.filteredMarkerSets.length>0&t.thisMarkerSet.markers.length>0?i("hr"):t._e(),t.thisMarkerSet.markers.length>0?i("div",{staticClass:"markers"},[i("TextInput",{attrs:{value:t.filter.search,placeholder:"Search..."},on:{input:function(e){t.filter.search=e.target.value}}}),t._l(t.filteredMarkers,(function(t){return i("MarkerItem",{key:t.id,attrs:{marker:t}})}))],2):t._e()])},je=[],Te=(i("4de4"),i("b0c0"),i("841c"),i("2909")),Pe=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"marker-item",class:{"marker-hidden":!t.marker.visible}},[i("div",{staticClass:"marker-button",attrs:{title:t.marker.id},on:{click:function(e){return t.click(!1)}}},["player"===t.marker.type?i("div",{staticClass:"icon"},[i("img",{attrs:{src:"assets/playerheads/"+t.marker.playerUuid+".png",alt:"playerhead"},on:{error:t.steve}})]):t._e(),i("div",{staticClass:"info"},[i("div",{staticClass:"label"},[t._v(t._s(t.markerLabel))]),i("div",{staticClass:"stats"},[t.appState.debug?i("div",[t._v(" "+t._s(t.marker.type)+"-marker ")]):t._e(),i("div",[t._v(" ("+t._s(t._f("position")(t.marker.position.x))+" | "+t._s(t._f("position")(t.marker.position.y))+" | "+t._s(t._f("position")(t.marker.position.z))+") ")])])])]),"player"===t.marker.type?i("div",{staticClass:"follow-player-button",class:{active:t.controls.controls.followingPlayer&&t.controls.controls.followingPlayer.id===t.marker.id},attrs:{title:"Follow Player"},on:{click:function(e){return t.click(!0)}}},[i("svg",{attrs:{viewBox:"0 0 30 30"}},[i("circle",{attrs:{fill:"none","stroke-width":"3","stroke-miterlimit":"10",cx:"15",cy:"15",r:"10.375"}}),i("line",{attrs:{fill:"none","stroke-width":"3","stroke-miterlimit":"10",x1:"3.25",y1:"15",x2:"1.063",y2:"15"}}),i("line",{attrs:{fill:"none","stroke-width":"3","stroke-miterlimit":"10",x1:"15",y1:"26.75",x2:"15",y2:"28.938"}}),i("line",{attrs:{fill:"none","stroke-width":"3","stroke-miterlimit":"10",x1:"26.75",y1:"15",x2:"28.938",y2:"15"}}),i("line",{attrs:{fill:"none","stroke-width":"3","stroke-miterlimit":"10",x1:"15",y1:"3.25",x2:"15",y2:"1.063"}}),i("circle",{attrs:{stroke:"none",cx:"15",cy:"15",r:"6.042"}})])]):t._e()])},De=[],Le=(i("d81d"),{name:"MarkerItem",props:{marker:Object},data:function(){return{appState:this.$bluemap.appState,controls:this.$bluemap.mapViewer.controlsManager.data}},computed:{markerLabel:function(){switch(this.marker.type){case"player":return this.marker.name;default:break}if(this.marker.label){var t=/^(?:<[^>]*>\s*)*([^<>]*\S[^<>]*)(?:<|$)/gi.exec(this.marker.label);if(t&&t.length>1)return t[1]}return this.marker.id}},filters:{position:function(t){return Math.floor(t)}},methods:{click:function(t){var e=this;return Object(jt["a"])(regeneratorRuntime.mark((function i(){var n,a,s,r,o;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(n=e.$bluemap.mapViewer.controlsManager,n.controls&&n.controls.stopFollowingPlayerMarker&&n.controls.stopFollowingPlayerMarker(),"player"!==e.marker.type){i.next=30;break}if(e.$bluemap.mapViewer.map.data.world===e.marker.world){i.next=27;break}a=null,s=Object(u["a"])(e.$bluemap.maps),i.prev=6,s.s();case 8:if((r=s.n()).done){i.next=15;break}if(o=r.value,o.data.world!==e.marker.world){i.next=13;break}return a=o,i.abrupt("break",15);case 13:i.next=8;break;case 15:i.next=20;break;case 17:i.prev=17,i.t0=i["catch"](6),s.e(i.t0);case 20:return i.prev=20,s.f(),i.finish(20);case 23:if(a){i.next=25;break}return i.abrupt("return");case 25:return i.next=27,e.$bluemap.switchMap(a.data.id);case 27:t&&n.controls&&n.controls.followPlayerMarker&&n.controls.followPlayerMarker(e.marker),i.next=32;break;case 30:if(e.marker.visible){i.next=32;break}return i.abrupt("return");case 32:n.position.copy(e.marker.position);case 33:case"end":return i.stop()}}),i,null,[[6,17,20,23]])})))()},steve:function(t){t.target.src="assets/steve.png"}}}),Ee=Le,Ce=(i("12f6"),Object(g["a"])(Ee,Pe,De,!1,null,null,null)),_e=Ce.exports,Ae=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("input",{staticClass:"text-input",attrs:{type:"text"},domProps:{value:t.value},on:{input:function(e){return t.$emit("input",e)},keydown:function(t){return t.stopPropagation()}}})},ze=[],Ue={name:"TextInput",props:{value:String}},Fe=Ue,Ve=(i("1213"),Object(g["a"])(Fe,Ae,ze,!1,null,null,null)),Re=Ve.exports,He=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"marker-set",attrs:{title:t.markerSet.id}},[i("div",{staticClass:"info",on:{click:t.toggle}},[i("div",{staticClass:"marker-set-switch"},[i("div",{staticClass:"label"},[t._v(t._s(t.label))]),t.markerSet.toggleable?i("SwitchHandle",{attrs:{on:t.markerSet.visible}}):t._e()],1),i("div",{staticClass:"stats"},[i("div",[t._v(" "+t._s(t.markerSet.markers.length)+" "+t._s(t.$tc("markers.marker",t.markerSet.markers.length))+" ")]),t.filteredMarkerSets.length>0?i("div",[t._v(" "+t._s(t.filteredMarkerSets.length)+" "+t._s(t.$tc("markers.markerSet",t.filteredMarkerSets.length))+" ")]):t._e()])]),i("div",{staticClass:"open-menu-button",on:{click:function(e){return t.$emit("more",e)}}},[i("svg",{attrs:{viewBox:"0 0 30 30"}},[i("path",{attrs:{d:"M25.004,9.294c0,0.806-0.75,1.46-1.676,1.46H6.671c-0.925,0-1.674-0.654-1.674-1.46l0,0\n\tc0-0.807,0.749-1.461,1.674-1.461h16.657C24.254,7.833,25.004,8.487,25.004,9.294L25.004,9.294z"}}),i("path",{attrs:{d:"M25.004,20.706c0,0.807-0.75,1.461-1.676,1.461H6.671c-0.925,0-1.674-0.654-1.674-1.461l0,0\n\tc0-0.807,0.749-1.461,1.674-1.461h16.657C24.254,19.245,25.004,19.899,25.004,20.706L25.004,20.706z"}})])])])},Be=[],$e={name:"MarkerSet",components:{SwitchHandle:se},props:{markerSet:Object},computed:{filteredMarkerSets:function(){return this.markerSet.markerSets.filter((function(t){return"bm-popup-set"!==t.id}))},label:function(){return"bm-players"===this.markerSet.id?this.$t("players.title"):this.markerSet.label}},methods:{toggle:function(){this.markerSet.toggleable&&(this.markerSet.visible=!this.markerSet.visible)}}},Ie=$e,Ke=(i("bfc9"),Object(g["a"])(Ie,He,Be,!1,null,null,null)),Ne=Ke.exports,Ye={name:"MarkerSetMenu",components:{MarkerSet:Ne,TextInput:Re,MarkerItem:_e},props:{menu:xe},data:function(){return{filter:{search:""}}},computed:{thisMarkerSet:function(){return this.menu.currentPage().markerSet},filteredMarkers:function(){var t=this;return Object(Te["a"])(this.thisMarkerSet.markers).sort((function(t,e){return t.id<e.id?-1:t.id>e.id?1:0})).filter((function(e){return!t.filter.search||(!!e.id.includesCI(t.filter.search)||(!(!e.label||!e.label.includesCI(t.filter.search))||!("player"!==e.type||!e.name.includesCI(t.filter.search)&&!e.playerUuid.includesCI(t.filter.search))))}))},filteredMarkerSets:function(){return this.thisMarkerSet.markerSets.filter((function(t){return"bm-popup-set"!==t.id}))}},methods:{openMore:function(t){this.menu.openPage(this.menu.currentPage().id,this.menu.currentPage().title+" > "+t.label,{markerSet:t})}}},We=Ye,qe=Object(g["a"])(We,Oe,je,!1,null,null,null),Ge=qe.exports,Xe=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"map-button",class:{selected:t.map.id===t.selectedMapId},attrs:{title:t.map.id},on:{click:function(e){return t.switchMap(t.map.id)}}},[i("span",{staticClass:"sky",style:{color:"rgb("+255*t.map.skyColor.r+","+255*t.map.skyColor.g+","+255*t.map.skyColor.b+")"}},[t._v("â€¢")]),i("span",{staticClass:"name"},[t._v(t._s(t.map.name))])])},Ze=[],Qe={name:"MapButton",props:{map:Object},data:function(){return{mapViewer:this.$bluemap.mapViewer.data,appState:this.$bluemap.appState}},computed:{selectedMapId:function(){return this.mapViewer.map?this.mapViewer.map.id:null}},methods:{switchMap:function(t){this.$bluemap.switchMap(t,!0)}}},Je=Qe,ti=(i("2b31"),Object(g["a"])(Je,Xe,Ze,!1,null,null,null)),ei=ti.exports,ii={name:"MainMenu",components:{MapButton:ei,MarkerSetMenu:Ge,SettingsMenu:be,SimpleButton:Ut,SideMenu:Lt},props:{menu:xe},data:function(){return{appState:this.$bluemap.appState,markers:this.$bluemap.mapViewer.markers.data}},methods:{goFullscreen:function(){document.body.requestFullscreen()}}},ni=ii,ai=(i("ce79"),Object(g["a"])(ni,Mt,St,!1,null,null,null)),si=ai.exports,ri=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:{disabled:!t.enabled},attrs:{id:"ff-mobile-controls"}},[i("div",{staticClass:"move-fields"},[i("div",{staticClass:"button up-button",on:{touchstart:function(e){t.forward=1,t.forwardPointer=e.changedTouches[0].identifier,e.preventDefault()}}},[i("svg",{attrs:{viewBox:"0 0 100 50"}},[i("path",{attrs:{d:"M6.75,48.375c-2.75,0-3.384-1.565-1.409-3.479L46.41,5.104c1.975-1.914,5.207-1.913,7.182,0l41.067,39.792\n          c1.975,1.914,1.341,3.479-1.409,3.479H6.75z"}})])]),i("div",{staticClass:"button down-button",on:{touchstart:function(e){t.forward=-1,t.forwardPointer=e.changedTouches[0].identifier,e.preventDefault()}}},[i("svg",{staticClass:"down",attrs:{viewBox:"0 0 100 50"}},[i("path",{attrs:{d:"M6.75,48.375c-2.75,0-3.384-1.565-1.409-3.479L46.41,5.104c1.975-1.914,5.207-1.913,7.182,0l41.067,39.792\n          c1.975,1.914,1.341,3.479-1.409,3.479H6.75z"}})])])]),i("div",{staticClass:"height-fields"},[i("div",{staticClass:"button up-button",on:{touchstart:function(e){t.up=1,t.upPointer=e.changedTouches[0].identifier,e.preventDefault()}}},[i("svg",{attrs:{viewBox:"0 0 100 50"}},[i("path",{attrs:{d:"M6.75,48.375c-2.75,0-3.384-1.565-1.409-3.479L46.41,5.104c1.975-1.914,5.207-1.913,7.182,0l41.067,39.792\n          c1.975,1.914,1.341,3.479-1.409,3.479H6.75z"}})])]),i("div",{staticClass:"button down-button",on:{touchstart:function(e){t.up=-1,t.upPointer=e.changedTouches[0].identifier,e.preventDefault()}}},[i("svg",{staticClass:"down",attrs:{viewBox:"0 0 100 50"}},[i("path",{attrs:{d:"M6.75,48.375c-2.75,0-3.384-1.565-1.409-3.479L46.41,5.104c1.975-1.914,5.207-1.913,7.182,0l41.067,39.792\n          c1.975,1.914,1.341,3.479-1.409,3.479H6.75z"}})])])])])},oi=[],li={name:"FreeFlightMobileControls",data:function(){return{enabled:!1,forward:0,forwardPointer:-1,up:0,upPointer:-1}},methods:{onTouchStop:function(t){console.log("Stop: ",t),t.changedTouches[0].identifier===this.forwardPointer&&(this.forward=0),t.changedTouches[0].identifier===this.upPointer&&(this.up=0)},onFrame:function(t){var e=this.$bluemap.mapViewer.controlsManager;e.position.x+=this.forward*Math.sin(e.rotation)*t.detail.delta*.02,e.position.z+=this.forward*-Math.cos(e.rotation)*t.detail.delta*.02,e.position.y+=this.up*t.detail.delta*.01},enable:function(t){this.enabled=!0}},mounted:function(){window.addEventListener("touchstart",this.enable),window.addEventListener("touchend",this.onTouchStop),window.addEventListener("touchcancel",this.onTouchStop),this.$bluemap.events.addEventListener("bluemapRenderFrame",this.onFrame)},beforeDestroy:function(){window.removeEventListener("touchstart",this.enable),window.removeEventListener("touchend",this.onTouchStop),window.removeEventListener("touchcancel",this.onTouchStop),this.$bluemap.events.removeEventListener("bluemapRenderFrame",this.onFrame)}},ci=li,ui=(i("2bbd"),Object(g["a"])(ci,ri,oi,!1,null,null,null)),hi=ui.exports,di={name:"App",components:{FreeFlightMobileControls:hi,MainMenu:si,ControlBar:kt},data:function(){return{appState:this.$bluemap.appState}}},pi=di,mi=(i("5c0b"),Object(g["a"])(pi,r,o,!1,null,null,null)),fi=mi.exports,vi=(i("4ec9"),i("3ca3"),i("ddb0"),function(){function t(e,i,n,a){Object(ke["a"])(this,t),Object.defineProperty(this,"isTile",{value:!0}),this.model=null,this.onLoad=n,this.onUnload=a,this.x=e,this.z=i,this.unloaded=!0,this.loading=!1}return Object(Me["a"])(t,[{key:"load",value:function(t){var e=this;return this.loading?Promise.reject("tile is already loading!"):(this.loading=!0,this.unload(),this.unloaded=!1,t.load(this.x,this.z).then((function(t){e.unloaded?t.geometry.dispose():(e.model=t,e.onLoad(e))})).finally((function(){e.loading=!1})))}},{key:"unload",value:function(){this.unloaded=!0,this.model&&(this.onUnload(this),this.model.geometry.dispose(),this.model=null)}},{key:"loaded",get:function(){return!!this.model}}]),t}()),gi=function(){function t(e,i){Object(ke["a"])(this,t),this.canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.canvas.width=e,this.canvas.height=i,this.tileMapContext=this.canvas.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.texture=new T["H"](this.canvas),this.texture.generateMipmaps=!1,this.texture.magFilter=T["p"],this.texture.minFilter=T["p"],this.texture.wrapS=T["e"],this.texture.wrapT=T["e"],this.texture.flipY=!1,this.texture.needsUpdate=!0}return Object(Me["a"])(t,[{key:"setAll",value:function(t){this.tileMapContext.fillStyle=t,this.tileMapContext.fillRect(0,0,this.canvas.width,this.canvas.height),this.texture.needsUpdate=!0}},{key:"setTile",value:function(t,e,i){this.tileMapContext.fillStyle=i,this.tileMapContext.fillRect(t,e,1,1),this.texture.needsUpdate=!0}}]),t}();Object(Se["a"])(gi,"EMPTY","#000"),Object(Se["a"])(gi,"LOADED","#fff");var yi=function(){function t(e,i){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;Object(ke["a"])(this,t),Object(Se["a"])(this,"loadCloseTiles",(function(){n.unloaded||n.loadNextTile()&&(n.loadTimeout&&clearTimeout(n.loadTimeout),n.currentlyLoading<8?n.loadTimeout=setTimeout(n.loadCloseTiles,0):n.loadTimeout=setTimeout(n.loadCloseTiles,1e3))})),Object(Se["a"])(this,"handleLoadedTile",(function(t){n.scene.add(t.model),n.onTileLoad(t)})),Object(Se["a"])(this,"handleUnloadedTile",(function(e){n.tileMap.setTile(e.x-n.centerTile.x+t.tileMapHalfSize,e.z-n.centerTile.y+t.tileMapHalfSize,gi.EMPTY),n.scene.remove(e.model),n.onTileUnload(e)})),Object.defineProperty(this,"isTileManager",{value:!0}),this.events=r,this.scene=e,this.tileLoader=i,this.onTileLoad=a||function(){},this.onTileUnload=s||function(){},this.viewDistanceX=1,this.viewDistanceZ=1,this.centerTile=new T["K"](0,0),this.currentlyLoading=0,this.loadTimeout=null,this.tiles=new Map,this.tileMap=new gi(t.tileMapSize,t.tileMapSize),this.unloaded=!0}return Object(Me["a"])(t,[{key:"loadAroundTile",value:function(e,i,n,a){var s=this;this.unloaded=!1;var r=!1;(this.viewDistanceX>n||this.viewDistanceZ>a)&&(r=!0),this.viewDistanceX=n,this.viewDistanceZ=a,(r||this.centerTile.x!==e||this.centerTile.y!==i)&&(this.centerTile.set(e,i),this.removeFarTiles(),this.tileMap.setAll(gi.EMPTY),this.tiles.forEach((function(e){e.loading||s.tileMap.setTile(e.x-s.centerTile.x+t.tileMapHalfSize,e.z-s.centerTile.y+t.tileMapHalfSize,gi.LOADED)}))),this.loadCloseTiles()}},{key:"unload",value:function(){this.unloaded=!0,this.removeAllTiles()}},{key:"removeFarTiles",value:function(){var t=this;this.tiles.forEach((function(e,i,n){(e.x+t.viewDistanceX<t.centerTile.x||e.x-t.viewDistanceX>t.centerTile.x||e.z+t.viewDistanceZ<t.centerTile.y||e.z-t.viewDistanceZ>t.centerTile.y)&&(e.unload(),n.delete(i))}))}},{key:"removeAllTiles",value:function(){this.tileMap.setAll(gi.EMPTY),this.tiles.forEach((function(t){t.unload()})),this.tiles.clear()}},{key:"loadNextTile",value:function(){if(this.unloaded)return!1;var t=0,e=0,i=1,n=1;while(n<2*Math.max(this.viewDistanceX,this.viewDistanceZ)+1){while(2*t*i<n){if(this.tryLoadTile(this.centerTile.x+t,this.centerTile.y+e))return!0;t+=i}while(2*e*i<n){if(this.tryLoadTile(this.centerTile.x+t,this.centerTile.y+e))return!0;e+=i}i*=-1,n+=1}return!1}},{key:"tryLoadTile",value:function(e,i){var n=this;if(this.unloaded)return!1;if(Math.abs(e-this.centerTile.x)>this.viewDistanceX)return!1;if(Math.abs(i-this.centerTile.y)>this.viewDistanceZ)return!1;var a=C(e,i),s=this.tiles.get(a);return void 0===s&&(this.currentlyLoading++,s=new vi(e,i,this.handleLoadedTile,this.handleUnloadedTile),this.tiles.set(a,s),s.load(this.tileLoader).then((function(){n.tileMap.setTile(s.x-n.centerTile.x+t.tileMapHalfSize,s.z-n.centerTile.y+t.tileMapHalfSize,gi.LOADED),n.loadTimeout&&clearTimeout(n.loadTimeout),n.loadTimeout=setTimeout(n.loadCloseTiles,0)})).catch((function(t){t.status&&"empty"===t.status||t.target&&404===t.target.status||t.type&&"abort"===t.type||z(n.events,"Failed to load tile: "+t,"warning")})).finally((function(){n.tileMap.setTile(s.x-n.centerTile.x+t.tileMapHalfSize,s.z-n.centerTile.y+t.tileMapHalfSize,gi.LOADED),n.currentlyLoading--})),!0)}}]),t}();Object(Se["a"])(yi,"tileMapSize",100),Object(Se["a"])(yi,"tileMapHalfSize",yi.tileMapSize/2);var bi=function t(e,i,n){var a=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;Object(ke["a"])(this,t),Object(Se["a"])(this,"load",(function(t,e){var i=a.tilePath+L(t,e)+".json";return new Promise((function(n,s){a.fileLoader.load(i+"?"+a.tileCacheHash,(function(r){if(r.type&&"BufferGeometry"===r.type){var o=a.bufferGeometryLoader.parse(r),l=new T["s"](o,a.material);a.layer&&l.layers.set(a.layer);var c=a.tileSettings.tileSize,u=a.tileSettings.translate,h=a.tileSettings.scale;l.position.set(t*c.x+u.x,0,e*c.z+u.z),l.scale.set(h.x,1,h.z),l.userData.tileUrl=i,l.updateMatrixWorld(!0),n(l)}else s({status:"empty"})}),(function(){}),s)}))})),Object.defineProperty(this,"isTileLoader",{value:!0}),this.tilePath=e,this.material=i,this.tileSettings=n,this.layer=r,this.tileCacheHash=s,this.fileLoader=new T["i"],this.fileLoader.setResponseType("json"),this.bufferGeometryLoader=new T["d"]},wi=(i("6062"),i("257e")),ki=i("262e"),Mi=i("2caf"),Si=i("45eb"),xi=i("7e84"),Oi=function(t){Object(ki["a"])(i,t);var e=Object(Mi["a"])(i);function i(t){var n;return Object(ke["a"])(this,i),n=e.call(this),Object.defineProperty(Object(wi["a"])(n),"isMarkerSet",{value:!0}),n.data={id:t,label:t,toggleable:!0,defaultHide:!1,markerSets:[],markers:[],visible:n.visible},Object.defineProperty(Object(wi["a"])(n),"visible",{get:function(){return this.data.visible},set:function(t){this.data.visible=t}}),n}return Object(Me["a"])(i,[{key:"add",value:function(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];if(1===n.length){var s=n[0];s.isMarkerSet&&this.data.markerSets.push(s.data),s.isMarker&&this.data.markers.push(s.data)}return(t=Object(Si["a"])(Object(xi["a"])(i.prototype),"add",this)).call.apply(t,[this].concat(n))}},{key:"remove",value:function(){for(var t,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];if(1===n.length){var s=n[0];if(s.isMarkerSet){var r=this.data.markerSets.indexOf(s.data);r>-1&&this.data.markerSets.splice(r,1)}if(s.isMarker){var o=this.data.markers.indexOf(s.data);o>-1&&this.data.markers.splice(o,1)}}return(t=Object(Si["a"])(Object(xi["a"])(i.prototype),"remove",this)).call.apply(t,[this].concat(n))}},{key:"dispose",value:function(){this.children.forEach((function(t){t.dispose&&t.dispose()}))}}]),i}(T["z"]);i("cb29");T["I"].line={linewidth:{value:1},resolution:{value:new T["K"](1,1)},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1},opacity:{value:1}},T["B"]["line"]={uniforms:T["J"].merge([T["I"].common,T["I"].fog,T["I"].line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\tvarying vec2 vUv;\n\t\t\n\t\tvarying float vDistance;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\tvUv = uv;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec2 ndcStart = clipStart.xy / clipStart.w;\n\t\t\tvec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd - ndcStart;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t// perpendicular to dir\n\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\n\t\t\t// undo aspect ratio adjustment\n\t\t\tdir.x /= aspect;\n\t\t\toffset.x /= aspect;\n\n\t\t\t// sign flip\n\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t// endcaps\n\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\toffset += - dir;\n\n\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\toffset += dir;\n\n\t\t\t}\n\n\t\t\t// adjust for linewidth\n\t\t\toffset *= linewidth;\n\n\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\toffset /= resolution.y;\n\n\t\t\t// select end\n\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t// back to clip space\n\t\t\toffset *= clip.w;\n\n\t\t\tclip.xy += offset;\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\t\t\t\n\t\t\tvDistance = -mvPosition.z;\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\t#define FLT_MAX 3.402823466e+38\n\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\t\t\n\t\tuniform float fadeDistanceMax;\n\t\tuniform float fadeDistanceMin;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashSize;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\t\t\n\t\tvarying float vDistance;\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\tfloat a = vUv.x;\n\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t}\n\n\t\t\t// distance fading\n\t\t\tfloat fdMax = FLT_MAX;\n\t\t\tif ( fadeDistanceMax > 0.0 ) fdMax = fadeDistanceMax;\n\t\t\t\n\t\t\tfloat minDelta = (vDistance - fadeDistanceMin) / fadeDistanceMin;\n\t\t\tfloat maxDelta = (vDistance - fadeDistanceMax) / (fadeDistanceMax * 0.5);\n\t\t\tfloat distanceOpacity = min(\n\t\t\t\tclamp(minDelta, 0.0, 1.0),\n\t\t\t\t1.0 - clamp(maxDelta + 1.0, 0.0, 1.0)\n\t\t\t);\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, opacity * distanceOpacity );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, diffuseColor.a );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t}\n\t\t"};var ji=function(t){T["C"].call(this,{type:"LineMaterial",uniforms:T["J"].clone(T["B"]["line"].uniforms),vertexShader:T["B"]["line"].vertexShader,fragmentShader:T["B"]["line"].fragmentShader,clipping:!0}),this.dashed=!1,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}}}),this.setValues(t)};ji.prototype=Object.create(T["C"].prototype),ji.prototype.constructor=ji,ji.prototype.isLineMaterial=!0;var Ti="\n#include <common>\n".concat(T["A"].logdepthbuf_pars_vertex,"\n\nvarying vec3 vPosition;\n//varying vec3 vWorldPosition;\n//varying vec3 vNormal;\n//varying vec2 vUv;\n//varying vec3 vColor;\nvarying float vDistance;\n\nvoid main() {\n\tvec4 worldPos = modelMatrix * vec4(position, 1);\n\tvec4 viewPos = viewMatrix * worldPos;\n\t\n\tvPosition = position;\n\t//vWorldPosition = worldPos.xyz;\n\t//vNormal = normal;\n\t//vUv = uv;\n\t//vColor = vec3(1.0);\n\tvDistance = -viewPos.z;\n\t\n\tgl_Position = projectionMatrix * viewPos;\n\t\n\t").concat(T["A"].logdepthbuf_vertex," \n}\n"),Pi="\n".concat(T["A"].logdepthbuf_pars_fragment,"\n\n#define FLT_MAX 3.402823466e+38\n\nvarying vec3 vPosition;\n//varying vec3 vWorldPosition;\n//varying vec3 vNormal;\n//varying vec2 vUv;\n//varying vec3 vColor;\nvarying float vDistance;\n\nuniform vec3 markerColor;\nuniform float markerOpacity;\n\nuniform float fadeDistanceMax;\nuniform float fadeDistanceMin;\n\nvoid main() {\n\tvec4 color = vec4(markerColor, markerOpacity);\n\t\n\t// distance fading\n\tfloat fdMax = FLT_MAX;\n\tif ( fadeDistanceMax > 0.0 ) fdMax = fadeDistanceMax;\n\t\n\tfloat minDelta = (vDistance - fadeDistanceMin) / fadeDistanceMin;\n\tfloat maxDelta = (vDistance - fadeDistanceMax) / (fadeDistanceMax * 0.5);\n\tfloat distanceOpacity = min(\n\t\tclamp(minDelta, 0.0, 1.0),\n\t\t1.0 - clamp(maxDelta + 1.0, 0.0, 1.0)\n\t);\n\t\n\tcolor.a *= distanceOpacity;\n\t\n\t// apply vertex-color\n\t//color.rgb *= vColor.rgb;\n\t\n\tgl_FragColor = color;\n\t\n\t").concat(T["A"].logdepthbuf_fragment,"\n}\n"),Di=(i("cfc3"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("72f7"),function(){T["l"].call(this),this.type="LineSegmentsGeometry";var t=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],e=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],i=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(i),this.setAttribute("position",new T["j"](t,3)),this.setAttribute("uv",new T["j"](e,2))});Di.prototype=Object.assign(Object.create(T["l"].prototype),{constructor:Di,isLineSegmentsGeometry:!0,applyMatrix4:function(t){var e=this.attributes.instanceStart,i=this.attributes.instanceEnd;return void 0!==e&&(e.applyMatrix4(t),i.applyMatrix4(t),e.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},setPositions:function(t){var e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var i=new T["m"](e,6,1);return this.setAttribute("instanceStart",new T["n"](i,3,0)),this.setAttribute("instanceEnd",new T["n"](i,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this},setColors:function(t){var e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var i=new T["m"](e,6,1);return this.setAttribute("instanceColorStart",new T["n"](i,3,0)),this.setAttribute("instanceColorEnd",new T["n"](i,3,3)),this},fromWireframeGeometry:function(t){return this.setPositions(t.attributes.position.array),this},fromEdgesGeometry:function(t){return this.setPositions(t.attributes.position.array),this},fromMesh:function(t){return this.fromWireframeGeometry(new T["P"](t.geometry)),this},fromLineSegments:function(t){var e=t.geometry;return e.isGeometry?this.setPositions(e.vertices):e.isBufferGeometry&&this.setPositions(e.attributes.position.array),this},computeBoundingBox:function(){var t=new T["b"];return function(){null===this.boundingBox&&(this.boundingBox=new T["b"]);var e=this.attributes.instanceStart,i=this.attributes.instanceEnd;void 0!==e&&void 0!==i&&(this.boundingBox.setFromBufferAttribute(e),t.setFromBufferAttribute(i),this.boundingBox.union(t))}}(),computeBoundingSphere:function(){var t=new T["L"];return function(){null===this.boundingSphere&&(this.boundingSphere=new T["F"]),null===this.boundingBox&&this.computeBoundingBox();var e=this.attributes.instanceStart,i=this.attributes.instanceEnd;if(void 0!==e&&void 0!==i){var n=this.boundingSphere.center;this.boundingBox.getCenter(n);for(var a=0,s=0,r=e.count;s<r;s++)t.fromBufferAttribute(e,s),a=Math.max(a,n.distanceToSquared(t)),t.fromBufferAttribute(i,s),a=Math.max(a,n.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}}(),toJSON:function(){},applyMatrix:function(t){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(t)}});var Li=function(){Di.call(this),this.type="LineGeometry"};Li.prototype=Object.assign(Object.create(Di.prototype),{constructor:Li,isLineGeometry:!0,setPositions:function(t){for(var e=t.length-3,i=new Float32Array(2*e),n=0;n<e;n+=3)i[2*n]=t[n],i[2*n+1]=t[n+1],i[2*n+2]=t[n+2],i[2*n+3]=t[n+3],i[2*n+4]=t[n+4],i[2*n+5]=t[n+5];return Di.prototype.setPositions.call(this,i),this},setColors:function(t){for(var e=t.length-3,i=new Float32Array(2*e),n=0;n<e;n+=3)i[2*n]=t[n],i[2*n+1]=t[n+1],i[2*n+2]=t[n+2],i[2*n+3]=t[n+3],i[2*n+4]=t[n+4],i[2*n+5]=t[n+5];return Di.prototype.setColors.call(this,i),this},fromLine:function(t){var e=t.geometry;return e.isGeometry?this.setPositions(e.vertices):e.isBufferGeometry&&this.setPositions(e.attributes.position.array),this},copy:function(){return this}});var Ei=function(t,e){void 0===t&&(t=new Di),void 0===e&&(e=new ji({color:16777215*Math.random()})),T["s"].call(this,t,e),this.type="LineSegments2"};Ei.prototype=Object.assign(Object.create(T["s"].prototype),{constructor:Ei,isLineSegments2:!0,computeLineDistances:function(){var t=new T["L"],e=new T["L"];return function(){for(var i=this.geometry,n=i.attributes.instanceStart,a=i.attributes.instanceEnd,s=new Float32Array(2*n.data.count),r=0,o=0,l=n.data.count;r<l;r++,o+=2)t.fromBufferAttribute(n,r),e.fromBufferAttribute(a,r),s[o]=0===o?0:s[o-1],s[o+1]=s[o]+t.distanceTo(e);var c=new T["m"](s,2,1);return i.setAttribute("instanceDistanceStart",new T["n"](c,1,0)),i.setAttribute("instanceDistanceEnd",new T["n"](c,1,1)),this}}(),raycast:function(){var t=new T["M"],e=new T["M"],i=new T["M"],n=new T["L"],a=new T["r"],s=new T["o"],r=new T["L"];return function(o,l){null===o.camera&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');var c=void 0!==o.params.Line2&&o.params.Line2.threshold||0,u=o.ray,h=o.camera,d=h.projectionMatrix,p=this.geometry,m=this.material,f=m.resolution,v=m.linewidth+c,g=p.attributes.instanceStart,y=p.attributes.instanceEnd;u.at(1,i),i.w=1,i.applyMatrix4(h.matrixWorldInverse),i.applyMatrix4(d),i.multiplyScalar(1/i.w),i.x*=f.x/2,i.y*=f.y/2,i.z=0,n.copy(i);var b=this.matrixWorld;a.multiplyMatrices(h.matrixWorldInverse,b);for(var w=0,k=g.count;w<k;w++){t.fromBufferAttribute(g,w),e.fromBufferAttribute(y,w),t.w=1,e.w=1,t.applyMatrix4(a),e.applyMatrix4(a),t.applyMatrix4(d),e.applyMatrix4(d),t.multiplyScalar(1/t.w),e.multiplyScalar(1/e.w);var M=t.z<-1&&e.z<-1,S=t.z>1&&e.z>1;if(!M&&!S){t.x*=f.x/2,t.y*=f.y/2,e.x*=f.x/2,e.y*=f.y/2,s.start.copy(t),s.start.z=0,s.end.copy(e),s.end.z=0;var x=s.closestPointToPointParameter(n,!0);s.at(x,r);var O=T["q"].lerp(t.z,e.z,x),j=O>=-1&&O<=1,P=n.distanceTo(r)<.5*v;if(j&&P){s.start.fromBufferAttribute(g,w),s.end.fromBufferAttribute(y,w),s.start.applyMatrix4(b),s.end.applyMatrix4(b);var D=new T["L"],L=new T["L"];u.distanceSqToSegment(s.start,s.end,L,D),l.push({point:L,pointOnLine:D,distance:u.origin.distanceTo(L),object:this,face:null,faceIndex:w,uv:null,uv2:null})}}}}}()});var Ci=function(t,e){void 0===t&&(t=new Li),void 0===e&&(e=new ji({color:16777215*Math.random()})),Ei.call(this,t,e),this.type="Line2"};Ci.prototype=Object.assign(Object.create(Ei.prototype),{constructor:Ci,isLine2:!0});i("9911"),i("4c53");var _i=function(t){Object(ki["a"])(i,t);var e=Object(Mi["a"])(i);function i(t){var n;return Object(ke["a"])(this,i),n=e.call(this),Object.defineProperty(Object(wi["a"])(n),"isMarker",{value:!0}),n.data={id:t,type:"marker",position:n.position,visible:n.visible},Object.defineProperty(Object(wi["a"])(n),"position",{get:function(){return this.data.position},set:function(t){this.data.position=t}}),Object.defineProperty(Object(wi["a"])(n),"visible",{get:function(){return this.data.visible},set:function(t){this.data.visible=t}}),n}return Object(Me["a"])(i,[{key:"dispose",value:function(){}},{key:"updateFromData",value:function(t){}}],[{key:"calculateDistanceOpacity",value:function(t,e,n,a){var s=i.calculateDistanceToCameraPlane(t,e),r=(s-n)/n,o=(s-a)/(.5*a);return Math.min(T["q"].clamp(r,0,1),1-T["q"].clamp(o+1,0,1))}},{key:"calculateDistanceToCameraPlane",value:function(t,e){return i._posRelativeToCamera.subVectors(t,e.position),e.getWorldDirection(i._cameraDirection),i._posRelativeToCamera.dot(i._cameraDirection)}}]),i}(T["w"]);Object(Se["a"])(_i,"_posRelativeToCamera",new T["L"]),Object(Se["a"])(_i,"_cameraDirection",new T["L"]);i("18a5"),i("10d1");var Ai=function(t){var e=this;T["w"].call(this),this.element=document.createElement("div");var i=t.parentNode;i.replaceChild(this.element,t),this.element.appendChild(t),this.element.style.position="absolute",this.anchor=new T["K"],this.events=null,this.addEventListener("removed",(function(){this.traverse((function(t){t.element instanceof Element&&null!==t.element.parentNode&&t.element.parentNode.removeChild(t.element)}))}));var n=-1,a=function(t){var i=!1,a=Date.now();a-n<500&&(i=!0),n=a;var s={doubleTap:i};e.onClick({event:t,data:s})?(t.preventDefault(),t.stopPropagation()):A(e.events,"bluemapMapInteraction",{data:s,object:e})};this.element.addEventListener("click",a),this.element.addEventListener("touch",a)};Ai.prototype=Object.create(T["w"].prototype),Ai.prototype.constructor=Ai;var zi=function(){var t,e,i,n,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,s=this,r=new T["L"],o=new T["r"],l=new T["r"],c={objects:new WeakMap},u=document.createElement("div");u.style.overflow="hidden",this.domElement=u,this.events=a,this.getSize=function(){return{width:t,height:e}},this.setSize=function(a,s){t=a,e=s,i=t/2,n=e/2,u.style.width=a+"px",u.style.height=s+"px"};var h=function t(e,a,o,h){if(e instanceof Ai){e.events=s.events,e.onBeforeRender(s,a,o),r.setFromMatrixPosition(e.matrixWorld),r.applyMatrix4(l);var p=e.element,m="translate("+(r.x*i+i-e.anchor.x)+"px,"+(-r.y*n+n-e.anchor.y)+"px)";p.style.WebkitTransform=m,p.style.MozTransform=m,p.style.oTransform=m,p.style.transform=m,p.style.display=h&&e.visible&&r.z>=-1&&r.z<=1&&"0"!==p.style.opacity?"":"none";var f={distanceToCameraSquared:d(o,e)};c.objects.set(e,f),p.parentNode!==u&&u.appendChild(p),e.onAfterRender(s,a,o)}for(var v=0,g=e.children.length;v<g;v++)t(e.children[v],a,o,h&&e.visible)},d=function(){var t=new T["L"],e=new T["L"];return function(i,n){return t.setFromMatrixPosition(i.matrixWorld),e.setFromMatrixPosition(n.matrixWorld),t.distanceToSquared(e)}}(),p=function(t){var e=[];return t.traverse((function(t){t instanceof Ai&&e.push(t)})),e},m=function(t){for(var e=p(t).sort((function(t,e){var i=c.objects.get(t).distanceToCameraSquared,n=c.objects.get(e).distanceToCameraSquared;return i-n})),i=e.length,n=0,a=e.length;n<a;n++)e[n].element.style.zIndex=i-n};this.render=function(t,e){!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),o.copy(e.matrixWorldInverse),l.multiplyMatrices(e.projectionMatrix,o),h(t,t,e,!0),m(t)}},Ui=function(t){Object(ki["a"])(i,t);var e=Object(Mi["a"])(i);function i(t){var n;return Object(ke["a"])(this,i),n=e.call(this,t),Object.defineProperty(Object(wi["a"])(n),"isObjectMarker",{value:!0}),n.data.type="object",n.data.label=null,n.data.detail=null,n.data.link=null,n.data.newTab=!0,n.lastClick=-1,n}return Object(Me["a"])(i,[{key:"onClick",value:function(t){var e=new T["L"];if(t.intersection&&(e.copy(t.intersection.pointOnLine||t.intersection.point),e.sub(this.position)),t.data.doubleTap)return!1;if(this.data.detail||this.data.label){var i=new Fi(this.data.detail||this.data.label);i.position.copy(e),this.add(i),i.open()}return this.data.link&&window.open(this.data.link,this.data.newTab?"_blank":"_self"),!0}},{key:"updateFromData",value:function(t){var e=t.position||{};this.position.setX(e.x||0),this.position.setY(e.y||0),this.position.setZ(e.z||0),this.data.label=t.label||null,this.data.detail=t.detail||null,this.data.link=t.link||null,this.data.newTab=!!t.newTab}}]),i}(_i),Fi=function(t){Object(ki["a"])(i,t);var e=Object(Mi["a"])(i);function i(t){return Object(ke["a"])(this,i),e.call(this,U('<div class="bm-marker-labelpopup">'.concat(t,"</div>")))}return Object(Me["a"])(i,[{key:"open",value:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=this.element.style.opacity||1;this.element.style.opacity=0;var n=F((function(e){t.element.style.opacity=(e*i).toString()}),300);if(e){var a=function e(i){i.composedPath().includes(t.element)||(n.cancel(),t.close(),window.removeEventListener("mousedown",e),window.removeEventListener("touchstart",e),window.removeEventListener("keydown",e),window.removeEventListener("mousewheel",e))};window.addEventListener("mousedown",a),window.addEventListener("touchstart",a),window.addEventListener("keydown",a),window.addEventListener("mousewheel",a)}}},{key:"close",value:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=parseFloat(this.element.style.opacity);F((function(e){t.element.style.opacity=(i-e*i).toString()}),300,(function(i){e&&i&&t.parent&&t.parent.remove(t)}))}}]),i}(Ai),Vi=function(t){Object(ki["a"])(i,t);var e=Object(Mi["a"])(i);function i(t){var n;Object(ke["a"])(this,i),n=e.call(this,t),Object.defineProperty(Object(wi["a"])(n),"isShapeMarker",{value:!0}),n.data.type="shape";var a=new T["K"],s=new T["D"]([a,a,a]);return n.fill=new Ri(s),n.border=new Hi(s),n.border.renderOrder=-1,n.add(n.border,n.fill),n._markerData={},n}return Object(Me["a"])(i,[{key:"setShapeY",value:function(t){var e=t-this.position.y;this.fill.position.y=e,this.border.position.y=e}},{key:"setShape",value:function(t){this.fill.updateGeometry(t),this.border.updateGeometry(t)}},{key:"updateFromData",value:function(t){Object(Si["a"])(Object(xi["a"])(i.prototype),"updateFromData",this).call(this,t),this._markerData.shape&&H(t.shape,this._markerData.shape)&&this._markerData.position&&H(t.position,this._markerData.position)||this.setShape(this.createShapeFromData(t.shape)),this.setShapeY((t.shapeY||t.height||0)+.01),this.border.depthTest=!!t.depthTest,this.fill.depthTest=!!t.depthTest,this.border.linewidth=void 0!==t.lineWidth?t.lineWidth:2;var e=t.lineColor||t.borderColor||{};this.border.color.setRGB((e.r||0)/255,(e.g||0)/255,(e.b||0)/255),this.border.opacity=e.a||0;var n=t.fillColor||{};this.fill.color.setRGB((n.r||0)/255,(n.g||0)/255,(n.b||0)/255),this.fill.opacity=n.a||0;var a=t.minDistance||0,s=void 0!==t.maxDistance?t.maxDistance:Number.MAX_VALUE;this.border.fadeDistanceMin=a,this.border.fadeDistanceMax=s,this.fill.fadeDistanceMin=a,this.fill.fadeDistanceMax=s,this._markerData=t}},{key:"dispose",value:function(){Object(Si["a"])(Object(xi["a"])(i.prototype),"dispose",this).call(this),this.fill.dispose(),this.border.dispose()}},{key:"createShapeFromData",value:function(t){var e=this,i=[];return Array.isArray(t)&&t.forEach((function(t){var n=(t.x||0)-e.position.x,a=(t.z||0)-e.position.z;i.push(new T["K"](n,a))})),new T["D"](i)}}]),i}(Ui),Ri=function(t){Object(ki["a"])(i,t);var e=Object(Mi["a"])(i);function i(t){Object(ke["a"])(this,i);var n=i.createGeometry(t),a=new T["C"]({vertexShader:Ti,fragmentShader:Pi,side:T["g"],depthTest:!0,transparent:!0,uniforms:{markerColor:{value:new T["f"]},markerOpacity:{value:0},fadeDistanceMin:{value:0},fadeDistanceMax:{value:Number.MAX_VALUE}}});return e.call(this,n,a)}return Object(Me["a"])(i,[{key:"color",get:function(){return this.material.uniforms.markerColor.value}},{key:"opacity",get:function(){return this.material.uniforms.markerOpacity.value},set:function(t){this.material.uniforms.markerOpacity.value=t,this.visible=t>0}},{key:"depthTest",get:function(){return this.material.depthTest},set:function(t){this.material.depthTest=t}},{key:"fadeDistanceMin",get:function(){return this.material.uniforms.fadeDistanceMin.value},set:function(t){this.material.uniforms.fadeDistanceMin.value=t}},{key:"fadeDistanceMax",get:function(){return this.material.uniforms.fadeDistanceMax.value},set:function(t){this.material.uniforms.fadeDistanceMax.value=t}},{key:"onClick",value:function(t){if(t.intersection){if(t.intersection.distance>this.fadeDistanceMax)return!1;if(t.intersection.distance<this.fadeDistanceMin)return!1}return Object(Si["a"])(Object(xi["a"])(i.prototype),"onClick",this).call(this,t)}},{key:"updateGeometry",value:function(t){this.geometry.dispose(),this.geometry=i.createGeometry(t)}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}],[{key:"createGeometry",value:function(t){var e=new T["E"](t,5);return e.rotateX(Math.PI/2),e}}]),i}(T["s"]),Hi=function(t){Object(ki["a"])(i,t);var e=Object(Mi["a"])(i);function i(t){var n;Object(ke["a"])(this,i);var a=new Li;a.setPositions(i.createLinePoints(t));var s=new ji({color:new T["f"],opacity:0,transparent:!0,linewidth:1,depthTest:!0,vertexColors:!1,dashed:!1});return s.uniforms.fadeDistanceMin={value:0},s.uniforms.fadeDistanceMax={value:Number.MAX_VALUE},s.resolution.set(window.innerWidth,window.innerHeight),n=e.call(this,a,s),n.computeLineDistances(),n}return Object(Me["a"])(i,[{key:"color",get:function(){return this.material.color}},{key:"opacity",get:function(){return this.material.opacity},set:function(t){this.material.opacity=t,this.visible=t>0}},{key:"linewidth",get:function(){return this.material.linewidth},set:function(t){this.material.linewidth=t}},{key:"depthTest",get:function(){return this.material.depthTest},set:function(t){this.material.depthTest=t}},{key:"fadeDistanceMin",get:function(){return this.material.uniforms.fadeDistanceMin.value},set:function(t){this.material.uniforms.fadeDistanceMin.value=t}},{key:"fadeDistanceMax",get:function(){return this.material.uniforms.fadeDistanceMax.value},set:function(t){this.material.uniforms.fadeDistanceMax.value=t}},{key:"onClick",value:function(t){if(t.intersection){if(t.intersection.distance>this.fadeDistanceMax)return!1;if(t.intersection.distance<this.fadeDistanceMin)return!1}return Object(Si["a"])(Object(xi["a"])(i.prototype),"onClick",this).call(this,t)}},{key:"updateGeometry",value:function(t){this.geometry.setPositions(i.createLinePoints(t)),this.computeLineDistances()}},{key:"onBeforeRender",value:function(t){t.getSize(this.material.resolution)}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}],[{key:"createLinePoints",value:function(t){var e=[],i=t.getPoints(5);return i.forEach((function(t){return e.push(t.x,0,t.y)})),e.push(i[0].x,0,i[0].y),e}}]),i}(Ci),Bi=function(t){Object(ki["a"])(i,t);var e=Object(Mi["a"])(i);function i(t){var n;Object(ke["a"])(this,i),n=e.call(this,t),Object.defineProperty(Object(wi["a"])(n),"isExtrudeMarker",{value:!0}),n.data.type="extrude";var a=new T["K"],s=new T["D"]([a,a,a]);return n.fill=new $i(s),n.border=new Ii(s),n.border.renderOrder=-1,n.add(n.border,n.fill),n._markerData={},n}return Object(Me["a"])(i,[{key:"setShapeY",value:function(t,e){var i=e-this.position.y,n=e-t;this.fill.position.y=i,this.border.position.y=i,this.fill.scale.y=n,this.border.scale.y=n}},{key:"setShape",value:function(t){this.fill.updateGeometry(t),this.border.updateGeometry(t)}},{key:"updateFromData",value:function(t){Object(Si["a"])(Object(xi["a"])(i.prototype),"updateFromData",this).call(this,t),this._markerData.shape&&H(t.shape,this._markerData.shape)&&this._markerData.position&&H(t.position,this._markerData.position)||this.setShape(this.createShapeFromData(t.shape)),this.setShapeY((t.shapeMinY||0)-.01,(t.shapeMaxY||0)+.01),this.border.depthTest=!!t.depthTest,this.fill.depthTest=!!t.depthTest,this.border.linewidth=void 0!==t.lineWidth?t.lineWidth:2;var e=t.lineColor||{};this.border.color.setRGB((e.r||0)/255,(e.g||0)/255,(e.b||0)/255),this.border.opacity=e.a||0;var n=t.fillColor||{};this.fill.color.setRGB((n.r||0)/255,(n.g||0)/255,(n.b||0)/255),this.fill.opacity=n.a||0;var a=t.minDistance||0,s=void 0!==t.maxDistance?t.maxDistance:Number.MAX_VALUE;this.border.fadeDistanceMin=a,this.border.fadeDistanceMax=s,this.fill.fadeDistanceMin=a,this.fill.fadeDistanceMax=s,this._markerData=t}},{key:"dispose",value:function(){Object(Si["a"])(Object(xi["a"])(i.prototype),"dispose",this).call(this),this.fill.dispose(),this.border.dispose()}},{key:"createShapeFromData",value:function(t){var e=this,i=[];return Array.isArray(t)&&t.forEach((function(t){var n=(t.x||0)-e.position.x+.01,a=(t.z||0)-e.position.z+.01;i.push(new T["K"](n,a))})),new T["D"](i)}}]),i}(Ui),$i=function(t){Object(ki["a"])(i,t);var e=Object(Mi["a"])(i);function i(t){Object(ke["a"])(this,i);var n=i.createGeometry(t),a=new T["C"]({vertexShader:Ti,fragmentShader:Pi,side:T["g"],depthTest:!0,transparent:!0,uniforms:{markerColor:{value:new T["f"]},markerOpacity:{value:0},fadeDistanceMin:{value:0},fadeDistanceMax:{value:Number.MAX_VALUE}}});return e.call(this,n,a)}return Object(Me["a"])(i,[{key:"color",get:function(){return this.material.uniforms.markerColor.value}},{key:"opacity",get:function(){return this.material.uniforms.markerOpacity.value},set:function(t){this.material.uniforms.markerOpacity.value=t,this.visible=t>0}},{key:"depthTest",get:function(){return this.material.depthTest},set:function(t){this.material.depthTest=t}},{key:"fadeDistanceMin",get:function(){return this.material.uniforms.fadeDistanceMin.value},set:function(t){this.material.uniforms.fadeDistanceMin.value=t}},{key:"fadeDistanceMax",get:function(){return this.material.uniforms.fadeDistanceMax.value},set:function(t){this.material.uniforms.fadeDistanceMax.value=t}},{key:"onClick",value:function(t){if(t.intersection){if(t.intersection.distance>this.fadeDistanceMax)return!1;if(t.intersection.distance<this.fadeDistanceMin)return!1}return Object(Si["a"])(Object(xi["a"])(i.prototype),"onClick",this).call(this,t)}},{key:"updateGeometry",value:function(t){this.geometry.dispose(),this.geometry=i.createGeometry(t)}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}],[{key:"createGeometry",value:function(t){var e=new T["h"](t,{depth:1,steps:5,bevelEnabled:!1});return e.rotateX(Math.PI/2),e}}]),i}(T["s"]),Ii=function(t){Object(ki["a"])(i,t);var e=Object(Mi["a"])(i);function i(t){var n;Object(ke["a"])(this,i);var a=new Di;a.setPositions(i.createLinePoints(t));var s=new ji({color:new T["f"],opacity:0,transparent:!0,linewidth:1,depthTest:!0,vertexColors:!1,dashed:!1});return s.uniforms.fadeDistanceMin={value:0},s.uniforms.fadeDistanceMax={value:Number.MAX_VALUE},s.resolution.set(window.innerWidth,window.innerHeight),n=e.call(this,a,s),n.computeLineDistances(),n}return Object(Me["a"])(i,[{key:"color",get:function(){return this.material.color}},{key:"opacity",get:function(){return this.material.opacity},set:function(t){this.material.opacity=t,this.visible=t>0}},{key:"linewidth",get:function(){return this.material.linewidth},set:function(t){this.material.linewidth=t}},{key:"depthTest",get:function(){return this.material.depthTest},set:function(t){this.material.depthTest=t}},{key:"fadeDistanceMin",get:function(){return this.material.uniforms.fadeDistanceMin.value},set:function(t){this.material.uniforms.fadeDistanceMin.value=t}},{key:"fadeDistanceMax",get:function(){return this.material.uniforms.fadeDistanceMax.value},set:function(t){this.material.uniforms.fadeDistanceMax.value=t}},{key:"onClick",value:function(t){if(t.intersection){if(t.intersection.distance>this.fadeDistanceMax)return!1;if(t.intersection.distance<this.fadeDistanceMin)return!1}return Object(Si["a"])(Object(xi["a"])(i.prototype),"onClick",this).call(this,t)}},{key:"updateGeometry",value:function(t){this.geometry.setPositions(i.createLinePoints(t)),this.computeLineDistances()}},{key:"onBeforeRender",value:function(t){t.getSize(this.material.resolution)}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}],[{key:"createLinePoints",value:function(t){var e=[],i=t.getPoints(5);i.push(i[0]);var n=null;return i.forEach((function(t){e.push(t.x,0,t.y),e.push(t.x,-1,t.y),n&&(e.push(n.x,0,n.y),e.push(t.x,0,t.y),e.push(n.x,-1,n.y),e.push(t.x,-1,t.y)),n=t})),e}}]),i}(Ci),Ki=function(t){Object(ki["a"])(i,t);var e=Object(Mi["a"])(i);function i(t){var n;return Object(ke["a"])(this,i),n=e.call(this,t),Object.defineProperty(Object(wi["a"])(n),"isLineMarker",{value:!0}),n.data.type="line",n.line=new Ni([0,0,0]),n.add(n.line),n._markerData={},n}return Object(Me["a"])(i,[{key:"setLine",value:function(t){var e;if("Curve"!==t.type&&"CurvePath"!==t.type||(t=t.getPoints(5)),!Array.isArray(t))throw new Error("Invalid argument type!");0===t.length?e=[]:t[0].isVector3?(e=[],t.forEach((function(t){e.push(t.x,t.y,t.z)}))):e=t,this.line.updateGeometry(e)}},{key:"updateFromData",value:function(t){Object(Si["a"])(Object(xi["a"])(i.prototype),"updateFromData",this).call(this,t),this._markerData.line&&H(t.line,this._markerData.line)&&this._markerData.position&&H(t.position,this._markerData.position)||this.setLine(this.createPointsFromData(t.line)),this.line.depthTest=!!t.depthTest,this.line.linewidth=void 0!==t.lineWidth?t.lineWidth:2;var e=t.lineColor||{};this.line.color.setRGB((e.r||0)/255,(e.g||0)/255,(e.b||0)/255),this.line.opacity=e.a||0;var n=t.minDistance||0,a=void 0!==t.maxDistance?t.maxDistance:Number.MAX_VALUE;this.line.fadeDistanceMin=n,this.line.fadeDistanceMax=a,this._markerData=t}},{key:"dispose",value:function(){Object(Si["a"])(Object(xi["a"])(i.prototype),"dispose",this).call(this),this.line.dispose()}},{key:"createPointsFromData",value:function(t){var e=this,i=[];return Array.isArray(t)&&t.forEach((function(t){var n=(t.x||0)-e.position.x,a=(t.y||0)-e.position.y,s=(t.z||0)-e.position.z;i.push(n,a,s)})),i}}]),i}(Ui),Ni=function(t){Object(ki["a"])(i,t);var e=Object(Mi["a"])(i);function i(t){var n;Object(ke["a"])(this,i);var a=new Li;a.setPositions(t);var s=new ji({color:new T["f"],opacity:0,transparent:!0,linewidth:1,depthTest:!0,vertexColors:!1,dashed:!1});return s.uniforms.fadeDistanceMin={value:0},s.uniforms.fadeDistanceMax={value:Number.MAX_VALUE},s.resolution.set(window.innerWidth,window.innerHeight),n=e.call(this,a,s),n.computeLineDistances(),n}return Object(Me["a"])(i,[{key:"color",get:function(){return this.material.color}},{key:"opacity",get:function(){return this.material.opacity},set:function(t){this.material.opacity=t,this.visible=t>0}},{key:"linewidth",get:function(){return this.material.linewidth},set:function(t){this.material.linewidth=t}},{key:"depthTest",get:function(){return this.material.depthTest},set:function(t){this.material.depthTest=t}},{key:"fadeDistanceMin",get:function(){return this.material.uniforms.fadeDistanceMin.value},set:function(t){this.material.uniforms.fadeDistanceMin.value=t}},{key:"fadeDistanceMax",get:function(){return this.material.uniforms.fadeDistanceMax.value},set:function(t){this.material.uniforms.fadeDistanceMax.value=t}},{key:"onClick",value:function(t){if(t.intersection){if(t.intersection.distance>this.fadeDistanceMax)return!1;if(t.intersection.distance<this.fadeDistanceMin)return!1}return Object(Si["a"])(Object(xi["a"])(i.prototype),"onClick",this).call(this,t)}},{key:"updateGeometry",value:function(t){this.geometry.setPositions(t),this.computeLineDistances()}},{key:"onBeforeRender",value:function(t){t.getSize(this.material.resolution)}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),i}(Ci),Yi=function(t){Object(ki["a"])(i,t);var e=Object(Mi["a"])(i);function i(t){var n;return Object(ke["a"])(this,i),n=e.call(this,t),Object.defineProperty(Object(wi["a"])(n),"isHtmlMarker",{value:!0}),n.data.type="html",n.data.label=null,n.elementObject=new Ai(U('<div id="bm-marker-'.concat(n.data.id,'" class="bm-marker-').concat(n.data.type,'"></div>'))),n.elementObject.onBeforeRender=function(t,e,i){return n.onBeforeRender(t,e,i)},n.fadeDistanceMin=0,n.fadeDistanceMax=Number.MAX_VALUE,n.addEventListener("removed",(function(){n.element.parentNode&&n.element.parentNode.removeChild(n.element)})),n.add(n.elementObject),n}return Object(Me["a"])(i,[{key:"onBeforeRender",value:function(t,e,i){this.fadeDistanceMax===Number.MAX_VALUE&&this.fadeDistanceMin<=0?this.element.style.opacity=void 0:this.element.style.opacity=_i.calculateDistanceOpacity(this.position,i,this.fadeDistanceMin,this.fadeDistanceMax).toString()}},{key:"html",get:function(){return this.element.innerHTML},set:function(t){this.element.innerHTML=t}},{key:"anchor",get:function(){return this.elementObject.anchor}},{key:"element",get:function(){return this.elementObject.element.getElementsByTagName("div")[0]}},{key:"updateFromData",value:function(t){var e=t.position||{};this.position.setX(e.x||0),this.position.setY(e.y||0),this.position.setZ(e.z||0),this.data.label=t.label||null;var i=t.anchor||{};this.anchor.setX(i.x||0),this.anchor.setY(i.y||0),this.element.innerHTML!==t.html&&(this.element.innerHTML=t.html),this.fadeDistanceMin=t.minDistance||0,this.fadeDistanceMax=void 0!==t.maxDistance?t.maxDistance:Number.MAX_VALUE}},{key:"dispose",value:function(){Object(Si["a"])(Object(xi["a"])(i.prototype),"dispose",this).call(this),this.element.parentNode&&this.element.parentNode.removeChild(this.element)}}]),i}(_i),Wi=function(t){Object(ki["a"])(i,t);var e=Object(Mi["a"])(i);function i(t){var n;return Object(ke["a"])(this,i),n=e.call(this,t),Object.defineProperty(Object(wi["a"])(n),"isPoiMarker",{value:!0}),n.data.type="poi",n.html='<img src="" alt="POI Icon ('.concat(n.data.id,')" class="bm-marker-poi-icon" draggable="false" style="pointer-events: auto"><div class="bm-marker-poi-label"></div>'),n.iconElement=n.element.getElementsByTagName("img").item(0),n.labelElement=n.element.getElementsByTagName("div").item(0),n._lastIcon=null,n}return Object(Me["a"])(i,[{key:"onClick",value:function(t){var e=this;if(t.data.doubleTap)return!1;if(this.highlight||!this.data.label)return!0;this.highlight=!0;var i=function t(i){i.composedPath().includes(e.element)||(e.highlight=!1,window.removeEventListener("mousedown",t),window.removeEventListener("touchstart",t),window.removeEventListener("keydown",t),window.removeEventListener("mousewheel",t))};return setTimeout((function(){window.addEventListener("mousedown",i),window.addEventListener("touchstart",i),window.addEventListener("keydown",i),window.addEventListener("mousewheel",i)}),0),!0}},{key:"highlight",get:function(){return this.element.classList.contains("bm-marker-highlight")},set:function(t){t?this.element.classList.add("bm-marker-highlight"):this.element.classList.remove("bm-marker-highlight")}},{key:"updateFromData",value:function(t){var e=t.position||{};this.position.setX(e.x||0),this.position.setY(e.y||0),this.position.setZ(e.z||0);var i=t.anchor||t.iconAnchor||{};this.iconElement.style.transform="translate(".concat(-i.x,"px, ").concat(-i.y,"px)"),this.data.label!==t.label&&(this.data.label=t.label||"",this.labelElement.innerHTML=this.data.label||""),this._lastIcon!==t.icon&&(this.iconElement.src=t.icon||"assets/poi.svg",this._lastIcon=t.icon),this.fadeDistanceMin=t.minDistance||0,this.fadeDistanceMax=void 0!==t.maxDistance?t.maxDistance:Number.MAX_VALUE}}]),i}(Yi),qi=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Object(ke["a"])(this,t),Object.defineProperty(this,"isMarkerManager",{value:!0}),this.markerScene=e,this.fileUrl=i,this.events=n,this.markerSets=new Map,this.markers=new Map,this._updateInterval=null}return Object(Me["a"])(t,[{key:"setAutoUpdateInterval",value:function(t){var e=this;if(this._updateInterval&&clearTimeout(this._updateInterval),t>0){var i=function i(){e.update().then((function(n){e._updateInterval=n?setTimeout(i,t):setTimeout(i,Math.max(t,15e3))})).catch((function(n){z(e.events,n,"warning"),e._updateInterval=setTimeout(i,Math.max(t,15e3))}))};this._updateInterval=setTimeout(i,t)}}},{key:"update",value:function(){var t=this;return this.loadMarkerFile().then((function(e){return t.updateFromData(e)}))}},{key:"dispose",value:function(){this.setAutoUpdateInterval(0),this.markerSets.forEach((function(t){return t.dispose()}))}},{key:"clear",value:function(){var t=this;this.markerSets.forEach((function(e){return t.removeMarkerSet(e.data.id)}))}},{key:"addMarkerSet",value:function(t){this.removeMarkerSet(t.data.id),this.markerSets.set(t.data.id,t),this.markerScene.add(t)}},{key:"removeMarkerSet",value:function(t){var e=this.markerSets.get(t);e&&(this.markerScene.remove(e),this.markerSets.delete(t),e.dispose())}},{key:"addMarker",value:function(t,e){this.removeMarker(e.data.id),this.markers.set(e.data.id,e),t.add(e)}},{key:"removeMarker",value:function(t){var e=this.markers.get(t);e&&(e.parent&&e.parent.remove(e),this.markers.delete(t),e.dispose())}},{key:"updateFromData",value:function(t){return!1}},{key:"loadMarkerFile",value:function(){var t=this;return new Promise((function(e,i){var n=new T["i"];n.setResponseType("json"),n.load(t.fileUrl+"?"+_(),(function(n){n?e(n):i("Failed to parse '".concat(t.fileUrl,"'!"))}),(function(){}),(function(){return i("Failed to load '".concat(t.fileUrl,"'!"))}))}))}}]),t}(),Gi=function(t){Object(ki["a"])(i,t);var e=Object(Mi["a"])(i);function i(t,n,a){var s,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return Object(ke["a"])(this,i),s=e.call(this,t,n,r),Object.defineProperty(Object(wi["a"])(s),"isMarkerFileManager",{value:!0}),s.mapId=a,s}return Object(Me["a"])(i,[{key:"updateFromData",value:function(t){var e=this;if(!Array.isArray(t.markerSets))return!1;var i=new Set;return t.markerSets.forEach((function(t){try{var n=e.updateMarkerSetFromData(t);i.add(n)}catch(a){z(e.events,a,"fine")}})),this.markerSets.forEach((function(t,n){i.has(t)||e.removeMarkerSet(n)})),!0}},{key:"updateMarkerSetFromData",value:function(t){var e=this;if(!t.id)throw new Error("markerset-data has no id!");var i=this.markerSets.get(t.id);i||(i=new Oi(t.id),this.addMarkerSet(i),t.defaultHide&&(i.visible=!1)),i.data.label=t.label||t.id,i.data.toggleable=!!t.toggleable,i.data.defaultHide=!!t.defaultHide;var n=new Set;return Array.isArray(t.marker)&&t.marker.forEach((function(t){if(!t.map||t.map===e.mapId)try{var a=e.updateMarkerFromData(i,t);n.add(a)}catch(s){z(e.events,s,"fine"),console.debug(s)}})),i.children.forEach((function(t){!t.isMarker||n.has(t)||e.markers.has(t.markerId)||e.removeMarker(t.markerId)})),i}},{key:"updateMarkerFromData",value:function(t,e){if(!e.id)throw new Error("marker-data has no id!");if(!e.type)throw new Error("marker-data has no type!");var i=this.markers.get(e.id);if(!i||i.data.type!==e.type){switch(e.type){case"shape":i=new Vi(e.id);break;case"extrude":i=new Bi(e.id);break;case"line":i=new Ki(e.id);break;case"html":i=new Yi(e.id);break;case"poi":i=new Wi(e.id);break;default:throw new Error("Unknown marker-type: '".concat(e.type,"'"))}this.addMarker(t,i)}return i.parent!==t&&t.add(i),i.updateFromData(e),i}}]),i}(qi),Xi=function(t){Object(ki["a"])(i,t);var e=Object(Mi["a"])(i);function i(t,n){var a;return Object(ke["a"])(this,i),a=e.call(this,t),Object.defineProperty(Object(wi["a"])(a),"isPlayerMarker",{value:!0}),a.data.type="player",a.data.playerUuid=n,a.data.name=n,a.data.world="?",a.elementObject=new Ai(U('\n<div id="bm-marker-'.concat(a.data.id,'" class="bm-marker-').concat(a.data.type,'">\n    <img src="assets/playerheads/').concat(a.data.playerUuid,'.png" alt="playerhead" draggable="false">\n    <div class="bm-player-name"></div>\n</div>\n        '))),a.elementObject.onBeforeRender=function(t,e,i){return a.onBeforeRender(t,e,i)},a.playerHeadElement=a.element.getElementsByTagName("img")[0],a.playerNameElement=a.element.getElementsByTagName("div")[0],a.addEventListener("removed",(function(){a.element.parentNode&&a.element.parentNode.removeChild(a.element)})),a.playerHeadElement.addEventListener("error",(function(){a.playerHeadElement.src="assets/steve.png"}),{once:!0}),a.add(a.elementObject),a}return Object(Me["a"])(i,[{key:"element",get:function(){return this.elementObject.element.getElementsByTagName("div")[0]}},{key:"onBeforeRender",value:function(t,e,i){var n=_i.calculateDistanceToCameraPlane(this.position,i),a="near";n>1e3&&(a="med"),n>5e3&&(a="far"),this.element.setAttribute("distance-data",a)}},{key:"updateFromData",value:function(t){var e=this,i=t.position||{};if(this.position.x||this.position.y||this.position.z){var n={x:this.position.x,y:this.position.y,z:this.position.z},a={x:(i.x||0)-n.x,y:(i.y||0)+1.8-n.y,z:(i.z||0)-n.z};(a.x||a.y||a.z)&&F((function(t){var i=V.easeInOutCubic(t);e.position.set(n.x+a.x*i||0,n.y+a.y*i||0,n.z+a.z*i||0)}),500)}else this.position.set(i.x||0,i.y||0,i.z||0);var s=t.name||this.data.playerUuid;this.data.name=s,this.playerNameElement.innerHTML!==s&&(this.playerNameElement.innerHTML=s),this.data.world=t.world||"?"}},{key:"dispose",value:function(){Object(Si["a"])(Object(xi["a"])(i.prototype),"dispose",this).call(this);var t=this.elementObject.element;t.parentNode&&t.parentNode.removeChild(t)}}]),i}(_i),Zi=function(t){Object(ki["a"])(i,t);var e=Object(Mi["a"])(i);function i(t,n,a){var s,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return Object(ke["a"])(this,i),s=e.call(this,t,n,r),Object.defineProperty(Object(wi["a"])(s),"isPlayerMarkerManager",{value:!0}),s.worldId=a,s.getPlayerMarkerSet(),s}return Object(Me["a"])(i,[{key:"updateFromData",value:function(t){var e=this;if(!Array.isArray(t.players))return this.clear(),!1;var i=new Set;return t.players.forEach((function(t){try{var n=e.updatePlayerMarkerFromData(t);i.add(n)}catch(a){z(e.events,a,"fine")}})),this.markers.forEach((function(t,n){i.has(t)||e.removeMarker(n)})),!0}},{key:"updatePlayerMarkerFromData",value:function(t){var e=t.uuid;if(!e)throw new Error("player-data has no uuid!");var i="bm-player-"+e,n=this.markers.get(i),a=this.getPlayerMarkerSet();return n&&n.isPlayerMarker||(n=new Xi(i,e),this.addMarker(a,n)),n.parent!==a&&a.add(n),n.updateFromData(t),n.visible=t.world===this.worldId,n}},{key:"getPlayerMarkerSet",value:function(){var t=this.markerSets.get("bm-players");return t||(t=new Oi("bm-players"),t.data.label="Players",this.addMarkerSet(t)),t}}]),i}(qi),Qi=function(){function t(e,i,n,a){var s=this,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;Object(ke["a"])(this,t),Object(Se["a"])(this,"onTileLoad",(function(t){return function(e){A(s.events,"bluemapMapTileLoaded",{tile:e,layer:t})}})),Object(Se["a"])(this,"onTileUnload",(function(t){return function(e){A(s.events,"bluemapMapTileUnloaded",{tile:e,layer:t})}})),Object.defineProperty(this,"isMap",{value:!0}),this.events=r,this.data={id:e,dataUrl:i,settingsUrl:n,texturesUrl:a,name:e,world:"-",startPos:{x:0,z:0},skyColor:new T["f"],ambientLight:0,hires:{tileSize:{x:32,z:32},scale:{x:1,z:1},translate:{x:2,z:2}},lowres:{tileSize:{x:32,z:32},scale:{x:1,z:1},translate:{x:2,z:2}}},this.raycaster=new T["y"],this.hiresMaterial=null,this.lowresMaterial=null,this.loadedTextures=[],this.hiresTileManager=null,this.lowresTileManager=null}return Object(Me["a"])(t,[{key:"load",value:function(t,e,i,n,a){var s=this,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.unload();var o=this.loadSettings(),l=this.loadTexturesFile();return this.lowresMaterial=this.createLowresMaterial(i,n,a),Promise.all([o,l]).then((function(i){var n=i[1];if(null===n)throw new Error("Failed to parse textures.json!");s.hiresMaterial=s.createHiresMaterial(t,e,a,n),s.hiresTileManager=new yi(new T["z"],new bi("".concat(s.data.dataUrl,"hires/"),s.hiresMaterial,s.data.hires,r),s.onTileLoad("hires"),s.onTileUnload("hires"),s.events),s.lowresTileManager=new yi(new T["z"],new bi("".concat(s.data.dataUrl,"lowres/"),s.lowresMaterial,s.data.lowres,r),s.onTileLoad("lowres"),s.onTileUnload("lowres"),s.events),s.hiresTileManager.scene.autoUpdate=!1,s.lowresTileManager.scene.autoUpdate=!1,z(s.events,"Map '".concat(s.data.id,"' is loaded."),"fine")}))}},{key:"loadSettings",value:function(){var t=this;return this.loadSettingsFile().then((function(e){t.data.name=e.name?e.name:t.data.name,t.data.world=e.world?e.world:t.data.world,t.data.startPos=Object(we["a"])(Object(we["a"])({},t.data.startPos),e.startPos),t.data.skyColor.setRGB(void 0!==e.skyColor.r?e.skyColor.r:t.data.skyColor.r,void 0!==e.skyColor.g?e.skyColor.g:t.data.skyColor.g,void 0!==e.skyColor.b?e.skyColor.b:t.data.skyColor.b),t.data.ambientLight=e.ambientLight?e.ambientLight:t.data.ambientLight,void 0===e.hires&&(e.hires={}),void 0===e.lowres&&(e.lowres={}),t.data.hires={tileSize:Object(we["a"])(Object(we["a"])({},t.data.hires.tileSize),e.hires.tileSize),scale:Object(we["a"])(Object(we["a"])({},t.data.hires.scale),e.hires.scale),translate:Object(we["a"])(Object(we["a"])({},t.data.hires.translate),e.hires.translate)},t.data.lowres={tileSize:Object(we["a"])(Object(we["a"])({},t.data.lowres.tileSize),e.lowres.tileSize),scale:Object(we["a"])(Object(we["a"])({},t.data.lowres.scale),e.lowres.scale),translate:Object(we["a"])(Object(we["a"])({},t.data.lowres.translate),e.lowres.translate)},z(t.events,"Settings for map '".concat(t.data.id,"' loaded."),"fine")}))}},{key:"loadMapArea",value:function(t,e,i,n){if(this.isLoaded){var a=Math.floor((t-this.data.hires.translate.x)/this.data.hires.tileSize.x),s=Math.floor((e-this.data.hires.translate.z)/this.data.hires.tileSize.z),r=Math.floor(i/this.data.hires.tileSize.x),o=Math.floor(i/this.data.hires.tileSize.z),l=Math.floor((t-this.data.lowres.translate.x)/this.data.lowres.tileSize.x),c=Math.floor((e-this.data.lowres.translate.z)/this.data.lowres.tileSize.z),u=Math.floor(n/this.data.lowres.tileSize.x),h=Math.floor(n/this.data.lowres.tileSize.z);this.hiresTileManager.loadAroundTile(a,s,r,o),this.lowresTileManager.loadAroundTile(l,c,u,h)}}},{key:"loadSettingsFile",value:function(){var t=this;return new Promise((function(e,i){z(t.events,"Loading settings for map '".concat(t.data.id,"'..."),"fine");var n=new T["i"];n.setResponseType("json"),n.load(t.data.settingsUrl+"?"+_(),(function(n){n.maps&&n.maps[t.data.id]?e(n.maps[t.data.id]):i("the settings.json does not contain information for map: ".concat(t.data.id))}),(function(){}),(function(){return i("Failed to load the settings.json for map: ".concat(t.data.id))}))}))}},{key:"loadTexturesFile",value:function(){var t=this;return new Promise((function(e,i){z(t.events,"Loading textures for map '".concat(t.data.id,"'..."),"fine");var n=new T["i"];n.setResponseType("json"),n.load(t.data.texturesUrl+"?"+_(),e,(function(){}),(function(){return i("Failed to load the textures.json for map: ".concat(t.data.id))}))}))}},{key:"createHiresMaterial",value:function(t,e,i,n){var a=this,s=[];if(!Array.isArray(n.textures))throw new Error("Invalid texture.json: 'textures' is not an array!");for(var r=function(r){var o=n.textures[r],l=o.color;(!Array.isArray(l)||l.length<4)&&(l=[0,0,0,0]);var c=1===l[3],u=!!o.transparent,h=new T["H"];h.image=D(o.texture),h.anisotropy=1,h.generateMipmaps=c||u,h.magFilter=T["u"],h.minFilter=h.generateMipmaps?T["v"]:T["u"],h.wrapS=T["e"],h.wrapT=T["e"],h.flipY=!1,h.flatShading=!0,h.image.addEventListener("load",(function(){return h.needsUpdate=!0})),a.loadedTextures.push(h);var d=new T["C"]({uniforms:Object(we["a"])(Object(we["a"])({},i),{},{textureImage:{type:"t",value:h},transparent:{value:u}}),vertexShader:t,fragmentShader:e,transparent:u,depthWrite:!0,depthTest:!0,vertexColors:T["N"],side:T["k"],wireframe:!1});d.needsUpdate=!0,s[r]=d},o=0;o<n.textures.length;o++)r(o);return s}},{key:"createLowresMaterial",value:function(t,e,i){return new T["C"]({uniforms:i,vertexShader:t,fragmentShader:e,transparent:!1,depthWrite:!0,depthTest:!0,vertexColors:T["N"],side:T["k"],wireframe:!1})}},{key:"unload",value:function(){this.hiresTileManager&&this.hiresTileManager.unload(),this.hiresTileManager=null,this.lowresTileManager&&this.lowresTileManager.unload(),this.lowresTileManager=null,this.hiresMaterial&&this.hiresMaterial.forEach((function(t){return t.dispose()})),this.hiresMaterial=null,this.lowresMaterial&&this.lowresMaterial.dispose(),this.lowresMaterial=null,this.loadedTextures.forEach((function(t){return t.dispose()})),this.loadedTextures=[]}},{key:"terrainHeightAt",value:function(t,e){if(!this.isLoaded)return!1;this.raycaster.set(new T["L"](t,300,e),new T["L"](0,-1,0)),this.raycaster.near=1,this.raycaster.far=300,this.raycaster.layers.enableAll();var i=C(Math.floor((t-this.data.hires.translate.x)/this.data.hires.tileSize.x),Math.floor((e-this.data.hires.translate.z)/this.data.hires.tileSize.z)),n=this.hiresTileManager.tiles.get(i);if(!n||!n.model){var a=C(Math.floor((t-this.data.lowres.translate.x)/this.data.lowres.tileSize.x),Math.floor((e-this.data.lowres.translate.z)/this.data.lowres.tileSize.z));n=this.lowresTileManager.tiles.get(a)}if(!n||!n.model)return!1;try{var s=this.raycaster.intersectObjects([n.model]);if(s.length>0)return s[0].point.y}catch(r){return!1}}},{key:"dispose",value:function(){this.unload()}},{key:"isLoaded",get:function(){return!(!this.hiresMaterial||!this.lowresMaterial)}}]),t}(),Ji="\nuniform float sunlightStrength;\nuniform float ambientLight;\nuniform vec3 skyColor;\n\nvarying vec3 vPosition;\n\nvoid main() {\n\tfloat horizonWidth = 0.005;\n\tfloat horizonHeight = 0.0;\n\t\n\tvec4 color = vec4(skyColor * max(sunlightStrength * sunlightStrength, ambientLight), 1.0);\n\tfloat voidMultiplier = (clamp(vPosition.y - horizonHeight, -horizonWidth, horizonWidth) + horizonWidth) / (horizonWidth * 2.0);\n\tcolor.rgb *= voidMultiplier;\n\n\tgl_FragColor = color;\n}\n",tn="\nvarying vec3 vPosition;\nvoid main() {\n\tvPosition = position;\n\t\n\tgl_Position = \n\t\tprojectionMatrix *\n\t\tmodelViewMatrix *\n\t\tvec4(position, 1);\n}\n",en=function(t){Object(ki["a"])(i,t);var e=Object(Mi["a"])(i);function i(t){var n;Object(ke["a"])(this,i),n=e.call(this),n.autoUpdate=!1,Object.defineProperty(Object(wi["a"])(n),"isSkyboxScene",{value:!0});var a=new T["G"](1,40,5),s=new T["C"]({uniforms:t,vertexShader:tn,fragmentShader:Ji,side:T["a"]}),r=new T["s"](a,s);return n.add(r),n}return i}(T["z"]),nn=function(){function t(e,i){Object(ke["a"])(this,t),Object.defineProperty(this,"isControlsManager",{value:!0}),this.data={mapViewer:null,camera:null,controls:null,position:new T["L"](0,0,0),rotation:0,angle:0,tilt:0},this.mapViewer=e,this.camera=i,this.lastPosition=this.position.clone(),this.lastRotation=this.rotation,this.lastAngle=this.angle,this.lastDistance=this.distance,this.lastOrtho=this.ortho,this.lastTilt=this.tilt,this.lastMapUpdatePosition=this.position.clone(),this.averageDeltaTime=16,this._controls=null,this.distance=300,this.position.set(0,0,0),this.rotation=0,this.angle=0,this.tilt=0,this.ortho=0,this.updateCamera()}return Object(Me["a"])(t,[{key:"update",value:function(t,e){t>50&&(t=50),this.averageDeltaTime=.9*this.averageDeltaTime+.1*t,this._controls&&this._controls.update(this.averageDeltaTime,e),this.updateCamera()}},{key:"updateCamera",value:function(){var t=this.isValueChanged();if(t){this.resetValueChanged();while(this.rotation>=Math.PI)this.rotation-=2*Math.PI;while(this.rotation<=-Math.PI)this.rotation+=2*Math.PI;var e=this.angle;Math.abs(e)<=1e-4?e=1e-4:Math.abs(e)-Math.PI<=1e-4&&(e-=1e-4);var i=this.distance;Math.abs(i)<=1e-4&&(i=1e-4),this.ortho>0&&(i=T["q"].lerp(i,Math.max(i,300),Math.pow(this.ortho,8)));var n=new T["L"](Math.sin(this.rotation),0,-Math.cos(this.rotation)),a=new T["L"](0,1,0).cross(n);if(n.applyAxisAngle(a,Math.PI/2-e),n.multiplyScalar(i),this.camera.rotation.set(0,0,0),this.camera.position.copy(this.position).sub(n),this.camera.lookAt(this.position),this.camera.rotateZ(this.tilt+e<0?Math.PI:0),this.ortho<=0){var s=T["q"].clamp(i/1e3,.01,1),r=T["q"].clamp(2*i,Math.max(s+1,2e3),i+5e3);r-s>1e4&&(s=r-1e4),this.camera.near=s,this.camera.far=r}else 0===this.angle?(this.camera.near=1,this.camera.far=i+300):(this.camera.near=1,this.camera.far=1e5);A(this.mapViewer.events,"bluemapCameraMoved",{controlsManager:this,camera:this.camera})}if(this.mapViewer.map){var o=1;t&&(o=this.distance>300?.5*this.mapViewer.data.loadedLowresViewDistance:.5*this.mapViewer.data.loadedHiresViewDistance),(Math.abs(this.lastMapUpdatePosition.x-this.position.x)>=o||Math.abs(this.lastMapUpdatePosition.z-this.position.z)>=o)&&(this.lastMapUpdatePosition=this.position.clone(),this.mapViewer.loadMapArea(this.position.x,this.position.z))}}},{key:"handleMapInteraction",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.mapViewer.handleMapInteraction(t,e)}},{key:"isValueChanged",value:function(){return!(this.data.position.equals(this.lastPosition)&&this.data.rotation===this.lastRotation&&this.data.angle===this.lastAngle&&this.distance===this.lastDistance&&this.ortho===this.lastOrtho&&this.data.tilt===this.lastTilt)}},{key:"resetValueChanged",value:function(){this.lastPosition.copy(this.data.position),this.lastRotation=this.data.rotation,this.lastAngle=this.data.angle,this.lastDistance=this.distance,this.lastOrtho=this.ortho,this.lastTilt=this.data.tilt}},{key:"ortho",get:function(){return this.camera.ortho},set:function(t){this.camera.ortho=t}},{key:"distance",get:function(){return this.camera.distance},set:function(t){this.camera.distance=t}},{key:"controls",get:function(){return this._controls},set:function(t){this._controls&&this._controls.stop&&this._controls.stop(),this._controls=t,t&&(this.data.controls=t.data||null),this._controls&&this._controls.start&&this._controls.start(this)}},{key:"mapViewer",get:function(){return this._mapViewer},set:function(t){this._mapViewer=t,this.data.mapViewer=t.data}},{key:"camera",get:function(){return this._camera},set:function(t){this._camera=t,this.data.camera=t.data}},{key:"position",get:function(){return this.data.position},set:function(t){this.data.position=t}},{key:"rotation",get:function(){return this.data.rotation},set:function(t){this.data.rotation=t}},{key:"angle",get:function(){return this.data.angle},set:function(t){this.data.angle=t}},{key:"tilt",get:function(){return this.data.tilt},set:function(t){this.data.tilt=t}}]),t}(),an=function t(){var e=0,i=document.createElement("div");function n(t){return i.appendChild(t.dom),t}function a(t){for(var n=0;n<i.children.length;n++)i.children[n].style.display=n===t?"block":"none";e=t}function s(){a(-1)}i.style.cssText="position:absolute;bottom:5px;right:5px;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",(function(t){t.preventDefault(),a(++e%i.children.length)}),!1);var r=(performance||Date).now(),o=r,l=0,c=r,u=n(new t.Panel("FPS","#0ff","#002")),h=n(new t.Panel("MS (render)","#0f0","#020")),d=n(new t.Panel("MS (all)","#f80","#210")),p=null;return self.performance&&self.performance.memory&&(p=n(new t.Panel("MB","#f08","#201"))),a(0),{REVISION:16,dom:i,addPanel:n,showPanel:a,hide:s,begin:function(){r=(performance||Date).now()},end:function(){l++;var t=(performance||Date).now();if(h.update(t-r,200),d.update(t-c,200),t>=o+1e3&&(u.update(1e3*l/(t-o),100),o=t,l=0,p)){var e=performance.memory;p.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){r=this.end(),c=r},domElement:i,setMode:a}};an.Panel=function(t,e,i){var n=1/0,a=0,s=Math.round,r=s(window.devicePixelRatio||1),o=160*r,l=96*r,c=3*r,u=3*r,h=3*r,d=15*r,p=154*r,m=77*r,f=document.createElement("canvas");f.width=o,f.height=l,f.style.cssText="width:160px;height:96px";var v=f.getContext("2d");return v.font="bold "+9*r+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=i,v.fillRect(0,0,o,l),v.fillStyle=e,v.fillText(t,c,u),v.fillRect(h,d,p,m),v.fillStyle=i,v.globalAlpha=.9,v.fillRect(h,d,p,m),{dom:f,update:function(l,g){n=Math.min(n,l),a=Math.max(a,l),v.fillStyle=i,v.globalAlpha=1,v.fillRect(0,0,o,d),v.fillStyle=e,v.fillText(s(l)+" "+t+" ("+s(n)+"-"+s(a)+")",c,u),v.drawImage(f,h+r,d,p-r,m,h,d,p-r,m),v.fillRect(h+p-r,d,r,m),v.fillStyle=i,v.globalAlpha=.9,v.fillRect(h+p-r,d,r,s((1-l/g)*m))}}};var sn=an,rn="\n#include <common>\n".concat(T["A"].logdepthbuf_pars_vertex,"\n\nattribute float ao;\nattribute float sunlight;\nattribute float blocklight;\n\nvarying vec3 vPosition;\n//varying vec3 vWorldPosition;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vColor;\nvarying float vAo;\nvarying float vSunlight;\nvarying float vBlocklight;\n//varying float vDistance;\n\nvoid main() {\n\tvec4 worldPos = modelMatrix * vec4(position, 1);\n\tvec4 viewPos = viewMatrix * worldPos;\n\n\tvPosition = position;\n\t//vWorldPosition = worldPos.xyz;\n\tvNormal = normal;\n\tvUv = uv;\n\tvColor = color;\n\tvAo = ao;\n\tvSunlight = sunlight;\n\tvBlocklight = blocklight;\n\t//vDistance = -viewPos.z\n\t\n\tgl_Position = projectionMatrix * viewPos;\n\t\n\t").concat(T["A"].logdepthbuf_vertex," \n}\n"),on="\n".concat(T["A"].logdepthbuf_pars_fragment,"\n\n#ifndef texture\n\t#define texture texture2D\n#endif\n\nuniform sampler2D textureImage;\nuniform float sunlightStrength;\nuniform float ambientLight;\n\nvarying vec3 vPosition;\n//varying vec3 vWorldPosition;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vColor;\nvarying float vAo;\nvarying float vSunlight;\nvarying float vBlocklight;\n//varying float vDistance;\n\nvoid main() {\n\tvec4 color = texture(textureImage, vUv);\n\tif (color.a == 0.0) discard;\n\t\n\t//apply vertex-color\n\tcolor.rgb *= vColor.rgb;\n\n\t//apply ao\n\tcolor.rgb *= vAo;\n\t\n\t//apply light\n\tfloat light = mix(vBlocklight, max(vSunlight, vBlocklight), sunlightStrength);\n\tcolor.rgb *= mix(ambientLight, 1.0, light / 15.0);\n\t\n\tgl_FragColor = color;\n\t\n\t").concat(T["A"].logdepthbuf_fragment,"\n}\n"),ln="\n#include <common>\n".concat(T["A"].logdepthbuf_pars_vertex,"\n\nvarying vec3 vPosition;\nvarying vec3 vWorldPosition;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vColor;\nvarying float vDistance;\n\nvoid main() {\n\tvec4 worldPos = modelMatrix * vec4(position, 1);\n\tvec4 viewPos = viewMatrix * worldPos;\n\t\n\tvPosition = position;\n\tvWorldPosition = worldPos.xyz;\n\tvNormal = normal;\n\tvUv = uv;\n\tvColor = color;\n\tvDistance = -viewPos.z;\n\t\n\tgl_Position = projectionMatrix * viewPos;\n\t\t\n\t").concat(T["A"].logdepthbuf_vertex,"\n}\n"),cn="\n".concat(T["A"].logdepthbuf_pars_fragment,"\n\n#ifndef texture\n\t#define texture texture2D\n#endif\n\nstruct TileMap {\n\tsampler2D map;\n\tfloat size;\n\tvec2 scale;\n\tvec2 translate;\n\tvec2 pos; \n};\n\nuniform float sunlightStrength;\nuniform float ambientLight;\nuniform TileMap hiresTileMap;\n\nvarying vec3 vPosition;\nvarying vec3 vWorldPosition;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vColor;\nvarying float vDistance;\n\nvoid main() {\n\t//discard if hires tile is loaded at that position\n\tif (vDistance < 1900.0 && texture(hiresTileMap.map, ((vWorldPosition.xz - hiresTileMap.translate) / hiresTileMap.scale - hiresTileMap.pos) / hiresTileMap.size + 0.5).r >= 1.0) discard;\n\t\n\tvec4 color = vec4(vColor, 1.0);\n\n\tfloat diff = sqrt(max(dot(vNormal, vec3(0.3637, 0.7274, 0.5819)), 0.0)) * 0.4 + 0.6;\n\tcolor *= diff;\n\n\tcolor *= mix(sunlightStrength, 1.0, ambientLight);\n\n\tgl_FragColor = color;\n\t\n\t").concat(T["A"].logdepthbuf_fragment,"\n}\n"),un=function(t){Object(ki["a"])(i,t);var e=Object(Mi["a"])(i);function i(t,n,a,s,r){var o;return Object(ke["a"])(this,i),o=e.call(this,t,n,a,s),o.data={fov:o.fov,aspect:o.aspect,near:o.near,far:o.far,zoom:o.zoom,ortho:r,distance:1},Object.defineProperty(Object(wi["a"])(o),"fov",{get:function(){return this.data.fov},set:function(t){this.data.fov=t}}),Object.defineProperty(Object(wi["a"])(o),"aspect",{get:function(){return this.data.aspect},set:function(t){this.data.aspect=t}}),Object.defineProperty(Object(wi["a"])(o),"near",{get:function(){return this.data.near},set:function(t){this.data.near=t}}),Object.defineProperty(Object(wi["a"])(o),"far",{get:function(){return this.data.far},set:function(t){this.data.far=t}}),Object.defineProperty(Object(wi["a"])(o),"zoom",{get:function(){return this.data.zoom},set:function(t){this.data.zoom=t}}),o.updateProjectionMatrix(),o}return Object(Me["a"])(i,[{key:"updateProjectionMatrix",value:function(){this.ortographicProjection||(this.ortographicProjection=new T["r"]),this.perspectiveProjection||(this.perspectiveProjection=new T["r"]),this.data||(this.data={});var t=this.near,e=t*Math.tan(.5*T["q"].DEG2RAD*this.fov)/this.zoom,i=2*e,n=this.aspect*i,a=-.5*n,s=this.view;if(null!==this.view&&this.view.enabled){var r=s.fullWidth,o=s.fullHeight;a+=s.offsetX*n/r,e-=s.offsetY*i/o,n*=s.width/r,i*=s.height/o}var l=this.filmOffset;0!==l&&(a+=t*l/this.getFilmWidth());var c=1-Math.pow(this.ortho-1,6),u=Math.max(this.distance,1e-4)*Math.tan(.5*T["q"].DEG2RAD*this.fov)/this.zoom,h=2*u,d=this.aspect*h,p=-.5*d;this.perspectiveProjection.makePerspective(a,a+n,e,e-i,t,this.far),this.ortographicProjection.makeOrthographic(p,p+d,u,u-h,t,this.far);for(var m=0;m<16;m++)this.projectionMatrix.elements[m]=this.perspectiveProjection.elements[m]*(1-c)+this.ortographicProjection.elements[m]*c;this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"isPerspectiveCamera",get:function(){return this.ortho<1}},{key:"isOrthographicCamera",get:function(){return!this.isPerspectiveCamera}},{key:"type",get:function(){return this.isPerspectiveCamera?"PerspectiveCamera":"OrthographicCamera"},set:function(t){}},{key:"ortho",get:function(){return this.data.ortho},set:function(t){this.data.ortho=t}},{key:"distance",get:function(){return this.data.distance},set:function(t){this.data.distance=t}}]),i}(T["x"]),hn=function(){function t(e){var i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;Object(ke["a"])(this,t),Object(Se["a"])(this,"handleContainerResize",(function(){i.renderer.setSize(i.rootElement.clientWidth,i.rootElement.clientHeight),i.renderer.setPixelRatio(window.devicePixelRatio*i.superSampling),i.css2dRenderer.setSize(i.rootElement.clientWidth,i.rootElement.clientHeight),i.camera.aspect=i.rootElement.clientWidth/i.rootElement.clientHeight,i.camera.updateProjectionMatrix()})),Object(Se["a"])(this,"renderLoop",(function(t){requestAnimationFrame(i.renderLoop),i.lastFrame<=0&&(i.lastFrame=t);var e=t-i.lastFrame;i.lastFrame=t,i.stats.begin(),null!=i.map&&i.controlsManager.update(e,i.map),i.render(e),i.stats.update()})),Object(Se["a"])(this,"updateLoadedMapArea",(function(){i.map&&i.map.loadMapArea(i.data.loadedCenter.x,i.data.loadedCenter.y,i.data.loadedHiresViewDistance,i.data.loadedLowresViewDistance)})),Object.defineProperty(this,"isMapViewer",{value:!0}),this.rootElement=e,this.events=n,this.data={map:null,camera:null,controlsManager:null,uniforms:{sunlightStrength:{value:1},ambientLight:{value:0},skyColor:{value:new T["f"](.5,.5,1)},hiresTileMap:{value:{map:null,size:yi.tileMapSize,scale:new T["K"](1,1),translate:new T["K"],pos:new T["K"]}}},superSampling:1,loadedCenter:new T["K"](0,0),loadedHiresViewDistance:200,loadedLowresViewDistance:2e3},this.tileCacheHash=_(),this.stats=new sn,this.stats.hide(),this.renderer=new T["O"]({antialias:!0,sortObjects:!0,preserveDrawingBuffer:!0,logarithmicDepthBuffer:!0}),this.renderer.autoClear=!1,this.renderer.uniforms=this.data.uniforms,this.css2dRenderer=new zi(this.events),this.skyboxScene=new en(this.data.uniforms),this.camera=new un(75,1,.1,1e4,0),this.skyboxCamera=new T["x"](75,1,.1,1e4),this.controlsManager=new nn(this,this.camera),this.raycaster=new T["y"],this.raycaster.layers.enableAll(),this.raycaster.params.Line2={threshold:20},this.map=null,this.markers=new Oi("bm-root"),this.lastFrame=0,this.initializeRootElement(),window.addEventListener("resize",this.handleContainerResize),requestAnimationFrame(this.renderLoop)}return Object(Me["a"])(t,[{key:"initializeRootElement",value:function(){this.rootElement.innerHTML="";var t=U('<div style="position: relative; width: 100%; height: 100%; overflow: hidden;"></div>');this.rootElement.appendChild(t),t.appendChild(this.renderer.domElement),this.css2dRenderer.domElement.style.position="absolute",this.css2dRenderer.domElement.style.top="0",this.css2dRenderer.domElement.style.left="0",this.css2dRenderer.domElement.style.pointerEvents="none",t.appendChild(this.css2dRenderer.domElement),t.appendChild(this.stats.dom),this.handleContainerResize()}},{key:"handleMapInteraction",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=R(this.rootElement),n=new T["K"]((t.x-i.top)/this.rootElement.clientWidth*2-1,-(t.y-i.left)/this.rootElement.clientHeight*2+1);if(this.map&&this.map.isLoaded){this.raycaster.setFromCamera(n,this.camera);for(var a=this.raycaster.intersectObjects([this.map.hiresTileManager.scene,this.map.lowresTileManager.scene,this.markers],!0),s=null,r=null,o=null,l=!1,c=0;c<a.length;c++)if(a[c].object){var u=a[c].object,h=u,d=h.visible;while(d&&h.parent)h=h.parent,d=h.visible;if(d){s||(s=a[c]);var p=u;while(p.parent)p=p.parent;if(p===this.map.lowresTileManager.scene&&(r||(r=a[c])),p===this.map.hiresTileManager.scene&&(o||(o=a[c])),(!l||u.material&&!u.material.depthTest)&&u.onClick&&u.onClick({data:e,intersection:a[c]}))return;p!==this.map.lowresTileManager.scene&&(l=!0)}}A(this.events,"bluemapMapInteraction",{data:e,hit:s,hiresHit:o,lowresHit:r,intersections:a,ray:this.raycaster.ray})}}},{key:"render",value:function(t){A(this.events,"bluemapRenderFrame",{delta:t}),this.camera.updateProjectionMatrix(),this.skyboxCamera.rotation.copy(this.camera.rotation),this.skyboxCamera.updateProjectionMatrix(),this.renderer.clear(),this.renderer.render(this.skyboxScene,this.skyboxCamera),this.renderer.clearDepth(),this.map&&this.map.isLoaded&&(this.data.uniforms.hiresTileMap.value.pos.copy(this.map.hiresTileManager.centerTile),this.renderer.render(this.map.lowresTileManager.scene,this.camera),this.renderer.clearDepth(),this.controlsManager.distance<2e3&&this.renderer.render(this.map.hiresTileManager.scene,this.camera)),this.renderer.render(this.markers,this.camera),this.css2dRenderer.render(this.markers,this.camera)}},{key:"switchMap",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.map&&this.map.isMap&&this.map.unload(),this.map=e,this.map&&this.map.isMap?e.load(rn,on,ln,cn,this.data.uniforms,this.tileCacheHash).then((function(){var i,n=Object(u["a"])(t.map.loadedTextures);try{for(n.s();!(i=n.n()).done;){var a=i.value;t.renderer.initTexture(a)}}catch(s){n.e(s)}finally{n.f()}t.data.uniforms.skyColor.value=e.data.skyColor,t.data.uniforms.ambientLight.value=e.data.ambientLight,t.data.uniforms.hiresTileMap.value.map=e.hiresTileManager.tileMap.texture,t.data.uniforms.hiresTileMap.value.scale.set(e.data.hires.tileSize.x,e.data.hires.tileSize.z),t.data.uniforms.hiresTileMap.value.translate.set(e.data.hires.translate.x,e.data.hires.translate.z),setTimeout(t.updateLoadedMapArea),A(t.events,"bluemapMapChanged",{map:e})})).catch((function(e){z(t.events,e,"error")})):Promise.resolve()}},{key:"loadMapArea",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;this.data.loadedCenter.set(t,e),i>=0&&(this.data.loadedHiresViewDistance=i),n>=0&&(this.data.loadedLowresViewDistance=n),this.updateLoadedMapArea()}},{key:"clearTileCache",value:function(t){t||(t=_()),this.tileCacheHash=t,this.map&&(this.map.lowresTileManager.tileLoader.tileCacheHash=this.tileCacheHash,this.map.hiresTileManager.tileLoader.tileCacheHash=this.tileCacheHash)}},{key:"superSampling",get:function(){return this.data.superSampling},set:function(t){this.data.superSampling=t,this.handleContainerResize()}},{key:"camera",get:function(){return this._camera},set:function(t){this._camera=t,this.data.camera=t.data}},{key:"controlsManager",get:function(){return this._controlsManager},set:function(t){this._controlsManager=t,this.data.controlsManager=t.data}},{key:"map",get:function(){return this._map},set:function(t){this._map=t,t&&(this.data.map=t.data)}}]),t}(),dn=function(){function t(e,i,n){var a=this;Object(ke["a"])(this,t),Object(Se["a"])(this,"onMouseDown",(function(t){(void 0!==t.buttons?1!==t.buttons:0!==t.button)||t.altKey||(a.moving=!0,a.deltaPosition.set(0,0),a.lastPosition.set(t.x,t.y))})),Object(Se["a"])(this,"onMouseMove",(function(e){var i=t.tempVec2_1.set(e.x,e.y);a.moving&&a.deltaPosition.sub(i).add(a.lastPosition),a.lastPosition.copy(i)})),Object(Se["a"])(this,"onMouseUp",(function(t){0===t.button&&(a.moving=!1)})),Object(Se["a"])(this,"updatePixelToSpeedMultiplier",(function(){a.pixelToSpeedMultiplierX=1/a.target.clientWidth*(a.target.clientWidth/a.target.clientHeight),a.pixelToSpeedMultiplierY=1/a.target.clientHeight})),this.target=e,this.manager=null,this.moving=!1,this.lastPosition=new T["K"],this.deltaPosition=new T["K"],this.speed=i,this.stiffness=n,this.pixelToSpeedMultiplierX=0,this.pixelToSpeedMultiplierY=0,this.updatePixelToSpeedMultiplier()}return Object(Me["a"])(t,[{key:"start",value:function(t){this.manager=t,this.target.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"stop",value:function(){this.target.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"update",value:function(e,i){if(0!==this.deltaPosition.x||0!==this.deltaPosition.y){var n=this.stiffness/(16.666/e);n=T["q"].clamp(n,0,1);var a=t.tempVec2_1.copy(this.deltaPosition);a.rotateAround(P,this.manager.rotation),this.manager.position.x+=a.x*n*this.manager.distance*this.speed*this.pixelToSpeedMultiplierX,this.manager.position.z+=a.y*n*this.manager.distance*this.speed*this.pixelToSpeedMultiplierY,this.deltaPosition.multiplyScalar(1-n),this.deltaPosition.lengthSq()<1e-4&&this.deltaPosition.set(0,0)}}},{key:"reset",value:function(){this.deltaPosition.set(0,0)}}]),t}();Object(Se["a"])(dn,"tempVec2_1",new T["K"]);var pn=function(){function t(e,i,n){var a=this;Object(ke["a"])(this,t),Object(Se["a"])(this,"onMouseWheel",(function(t){var e=t.deltaY;t.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(e*=.01),t.deltaMode===WheelEvent.DOM_DELTA_LINE&&(e*=.33),a.deltaZoom+=e})),this.target=e,this.manager=null,this.stiffness=n,this.speed=i,this.deltaZoom=0}return Object(Me["a"])(t,[{key:"start",value:function(t){this.manager=t,this.target.addEventListener("wheel",this.onMouseWheel,{passive:!0})}},{key:"stop",value:function(){this.target.removeEventListener("wheel",this.onMouseWheel)}},{key:"update",value:function(t,e){if(0!==this.deltaZoom){var i=this.stiffness/(16.666/t);i=T["q"].clamp(i,0,1),this.manager.distance*=Math.pow(1.5,this.deltaZoom*i*this.speed),this.deltaZoom*=1-i,Math.abs(this.deltaZoom)<1e-4&&(this.deltaZoom=0)}}},{key:"reset",value:function(){this.deltaZoom=0}}]),t}(),mn=function(){function t(e,i,n){var a=this;Object(ke["a"])(this,t),Object(Se["a"])(this,"onMouseDown",(function(t){((void 0!==t.buttons?2===t.buttons:2===t.button)||(t.altKey||t.ctrlKey)&&(void 0!==t.buttons?1===t.buttons:0===t.button))&&(a.moving=!0,a.deltaRotation=0,a.lastX=t.x)})),Object(Se["a"])(this,"onMouseMove",(function(t){a.moving&&(a.deltaRotation+=t.x-a.lastX),a.lastX=t.x})),Object(Se["a"])(this,"onMouseUp",(function(t){a.moving=!1})),Object(Se["a"])(this,"updatePixelToSpeedMultiplier",(function(){a.pixelToSpeedMultiplierX=1/a.target.clientWidth})),this.target=e,this.manager=null,this.moving=!1,this.lastX=0,this.deltaRotation=0,this.speed=i,this.stiffness=n,this.pixelToSpeedMultiplierX=0,this.updatePixelToSpeedMultiplier()}return Object(Me["a"])(t,[{key:"start",value:function(t){this.manager=t,this.target.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"stop",value:function(){this.target.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"update",value:function(t,e){if(0!==this.deltaRotation){var i=this.stiffness/(16.666/t);i=T["q"].clamp(i,0,1),this.manager.rotation+=this.deltaRotation*i*this.speed*this.pixelToSpeedMultiplierX,this.deltaRotation*=1-i,Math.abs(this.deltaRotation)<1e-4&&(this.deltaRotation=0)}}},{key:"reset",value:function(){this.deltaRotation=0}}]),t}(),fn=function(){function t(e,i,n){var a=this;Object(ke["a"])(this,t),Object(Se["a"])(this,"onMouseDown",(function(t){((void 0!==t.buttons?2===t.buttons:2===t.button)||(t.altKey||t.ctrlKey)&&(void 0!==t.buttons?1===t.buttons:0===t.button))&&(a.moving=!0,a.deltaAngle=0,a.lastY=t.y)})),Object(Se["a"])(this,"onMouseMove",(function(t){a.moving&&(a.deltaAngle-=t.y-a.lastY),a.lastY=t.y})),Object(Se["a"])(this,"onMouseUp",(function(t){a.moving=!1})),Object(Se["a"])(this,"updatePixelToSpeedMultiplier",(function(){a.pixelToSpeedMultiplierY=1/a.target.clientHeight})),this.target=e,this.manager=null,this.moving=!1,this.lastY=0,this.deltaAngle=0,this.speed=i,this.stiffness=n,this.pixelToSpeedMultiplierY=0,this.updatePixelToSpeedMultiplier()}return Object(Me["a"])(t,[{key:"start",value:function(t){this.manager=t,this.target.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"stop",value:function(){this.target.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"update",value:function(t,e){if(0!==this.deltaAngle){var i=this.stiffness/(16.666/t);i=T["q"].clamp(i,0,1),this.manager.angle+=this.deltaAngle*i*this.speed*this.pixelToSpeedMultiplierY,this.deltaAngle*=1-i,Math.abs(this.deltaAngle)<1e-4&&(this.deltaAngle=0)}}},{key:"reset",value:function(){this.deltaAngle=0}}]),t}(),vn=i("c8b5"),gn=function(){function t(e,i){Object(ke["a"])(this,t),this.manager=null,this.cameraHeightStiffness=e,this.targetHeightStiffness=i,this.maxAngle=Math.PI/2,this.targetHeight=0,this.cameraHeight=0,this.minCameraHeight=0,this.distanceTagretHeight=0}return Object(Me["a"])(t,[{key:"start",value:function(t){this.manager=t}},{key:"stop",value:function(){}},{key:"update",value:function(t,e){this.updateHeights(t,e),this.manager.position.y=Math.max(this.manager.position.y,this.getSuggestedHeight())}},{key:"updateHeights",value:function(t,e){var i=this.targetHeightStiffness/(16.666/t);i=T["q"].clamp(i,0,1);var n=e.terrainHeightAt(this.manager.position.x,this.manager.position.z)+3||0,a=n-this.targetHeight;if(this.targetHeight+=a*i,Math.abs(a)<.001&&(this.targetHeight=n),this.minCameraHeight=0,this.maxAngle>=.1){var s=this.cameraHeightStiffness/(16.666/t);s=T["q"].clamp(s,0,1);var r=e.terrainHeightAt(this.manager.camera.position.x,this.manager.camera.position.z)||0,o=r-this.cameraHeight;this.cameraHeight+=o*s,Math.abs(o)<.001&&(this.cameraHeight=r);var l=Math.cos(this.maxAngle)*this.manager.distance;this.minCameraHeight=this.cameraHeight-l+1}this.distanceTagretHeight=Math.max(T["q"].lerp(this.targetHeight,0,this.manager.distance/500),0)}},{key:"getSuggestedHeight",value:function(){return Math.max(this.distanceTagretHeight,this.minCameraHeight)}}]),t}(),yn=function(){function t(e){Object(ke["a"])(this,t),this.code=e;for(var i=arguments.length,n=new Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];this.ctrl=n.includes(t.CTRL)||"CtrlLeft"===this.code||"CtrlRight"===this.code,this.shift=n.includes(t.SHIFT)||"ShiftLeft"===this.code||"ShiftRight"===this.code,this.alt=n.includes(t.ALT)||"AltLeft"===this.code||"AltRight"===this.code}return Object(Me["a"])(t,[{key:"testDown",value:function(t){return this.code===t.code&&this.ctrl===t.ctrlKey&&this.shift===t.shiftKey&&this.alt===t.altKey}},{key:"testUp",value:function(t){return this.code===t.code}}],[{key:"oneDown",value:function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(var a=0,s=i;a<s.length;a++){var r=s[a];if(r.testDown(t))return!0}return!1}},{key:"oneUp",value:function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];for(var a=0,s=i;a<s.length;a++){var r=s[a];if(r.testUp(t))return!0}return!1}}]),t}();Object(Se["a"])(yn,"CTRL",0),Object(Se["a"])(yn,"SHIFT",1),Object(Se["a"])(yn,"ALT",2);var bn=function(){function t(e,i,n){var a=this;Object(ke["a"])(this,t),Object(Se["a"])(this,"onKeyDown",(function(e){yn.oneDown.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.UP)))&&(a.up=!0,e.preventDefault()),yn.oneDown.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.DOWN)))&&(a.down=!0,e.preventDefault()),yn.oneDown.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.LEFT)))&&(a.left=!0,e.preventDefault()),yn.oneDown.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.RIGHT)))&&(a.right=!0,e.preventDefault())})),Object(Se["a"])(this,"onKeyUp",(function(e){yn.oneUp.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.UP)))&&(a.up=!1),yn.oneUp.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.DOWN)))&&(a.down=!1),yn.oneUp.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.LEFT)))&&(a.left=!1),yn.oneUp.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.RIGHT)))&&(a.right=!1)})),this.target=e,this.manager=null,this.deltaPosition=new T["K"],this.up=!1,this.down=!1,this.left=!1,this.right=!1,this.speed=i,this.stiffness=n}return Object(Me["a"])(t,[{key:"start",value:function(t){this.manager=t,window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}},{key:"stop",value:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}},{key:"update",value:function(e,i){if(this.up&&(this.deltaPosition.y-=1),this.down&&(this.deltaPosition.y+=1),this.left&&(this.deltaPosition.x-=1),this.right&&(this.deltaPosition.x+=1),0!==this.deltaPosition.x||0!==this.deltaPosition.y){var n=this.stiffness/(16.666/e);n=T["q"].clamp(n,0,1);var a=t.temp_v2.copy(this.deltaPosition);a.rotateAround(P,this.manager.rotation),this.manager.position.x+=a.x*n*this.manager.distance*this.speed*e*.06,this.manager.position.z+=a.y*n*this.manager.distance*this.speed*e*.06,this.deltaPosition.multiplyScalar(1-n),this.deltaPosition.lengthSq()<1e-4&&this.deltaPosition.set(0,0)}}}]),t}();Object(Se["a"])(bn,"KEYS",{LEFT:[new yn("ArrowLeft"),new yn("KeyA")],UP:[new yn("ArrowUp"),new yn("KeyW")],RIGHT:[new yn("ArrowRight"),new yn("KeyD")],DOWN:[new yn("ArrowDown"),new yn("KeyS")]}),Object(Se["a"])(bn,"temp_v2",new T["K"]);var wn=function(){function t(e,i,n){var a=this;Object(ke["a"])(this,t),Object(Se["a"])(this,"onKeyDown",(function(e){yn.oneDown.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.UP)))&&(a.up=!0,e.preventDefault()),yn.oneDown.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.DOWN)))&&(a.down=!0,e.preventDefault())})),Object(Se["a"])(this,"onKeyUp",(function(e){yn.oneUp.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.UP)))&&(a.up=!1),yn.oneUp.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.DOWN)))&&(a.down=!1)})),this.target=e,this.manager=null,this.deltaAngle=0,this.up=!1,this.down=!1,this.speed=i,this.stiffness=n}return Object(Me["a"])(t,[{key:"start",value:function(t){this.manager=t,window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}},{key:"stop",value:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}},{key:"update",value:function(t,e){if(this.up&&(this.deltaAngle-=1),this.down&&(this.deltaAngle+=1),0!==this.deltaAngle){var i=this.stiffness/(16.666/t);i=T["q"].clamp(i,0,1),this.manager.angle+=this.deltaAngle*i*this.speed*t*.06,this.deltaAngle*=1-i,Math.abs(this.deltaAngle)<1e-4&&(this.deltaAngle=0)}}}]),t}();Object(Se["a"])(wn,"KEYS",{UP:[new yn("ArrowUp",yn.ALT),new yn("KeyW",yn.ALT),new yn("PageUp")],DOWN:[new yn("ArrowDown",yn.ALT),new yn("KeyS",yn.ALT),new yn("PageDown")]});var kn=function(){function t(e,i,n){var a=this;Object(ke["a"])(this,t),Object(Se["a"])(this,"onKeyDown",(function(e){yn.oneDown.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.LEFT)))&&(a.left=!0,e.preventDefault()),yn.oneDown.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.RIGHT)))&&(a.right=!0,e.preventDefault())})),Object(Se["a"])(this,"onKeyUp",(function(e){yn.oneUp.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.LEFT)))&&(a.left=!1),yn.oneUp.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.RIGHT)))&&(a.right=!1)})),this.target=e,this.manager=null,this.deltaRotation=0,this.left=!1,this.right=!1,this.speed=i,this.stiffness=n}return Object(Me["a"])(t,[{key:"start",value:function(t){this.manager=t,window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}},{key:"stop",value:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}},{key:"update",value:function(t,e){if(this.left&&(this.deltaRotation+=1),this.right&&(this.deltaRotation-=1),0!==this.deltaRotation){var i=this.stiffness/(16.666/t);i=T["q"].clamp(i,0,1),this.manager.rotation+=this.deltaRotation*i*this.speed*t*.06,this.deltaRotation*=1-i,Math.abs(this.deltaRotation)<1e-4&&(this.deltaRotation=0)}}}]),t}();Object(Se["a"])(kn,"KEYS",{LEFT:[new yn("ArrowLeft",yn.ALT),new yn("KeyA",yn.ALT),new yn("Delete")],RIGHT:[new yn("ArrowRight",yn.ALT),new yn("KeyD",yn.ALT),new yn("End")]});var Mn=function(){function t(e,i,n){var a=this;Object(ke["a"])(this,t),Object(Se["a"])(this,"onKeyDown",(function(e){yn.oneDown.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.IN)))&&(a.in=!0,e.preventDefault()),yn.oneDown.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.OUT)))&&(a.out=!0,e.preventDefault())})),Object(Se["a"])(this,"onKeyUp",(function(e){yn.oneUp.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.IN)))&&(a.in=!1),yn.oneUp.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.OUT)))&&(a.out=!1)})),this.target=e,this.manager=null,this.deltaZoom=0,this.in=!1,this.out=!1,this.speed=i,this.stiffness=n}return Object(Me["a"])(t,[{key:"start",value:function(t){this.manager=t,window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}},{key:"stop",value:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}},{key:"update",value:function(t,e){if(this.in&&(this.deltaZoom-=1),this.out&&(this.deltaZoom+=1),0!==this.deltaZoom){var i=this.stiffness/(16.666/t);i=T["q"].clamp(i,0,1),this.manager.distance*=Math.pow(1.5,this.deltaZoom*i*this.speed*t*.06),this.deltaZoom*=1-i,Math.abs(this.deltaZoom)<1e-4&&(this.deltaZoom=0)}}}]),t}();Object(Se["a"])(Mn,"KEYS",{IN:[new yn("NumpadAdd"),new yn("Insert")],OUT:[new yn("NumpadSubtract"),new yn("Home")]});var Sn=function(){function t(e,i,n,a){var s=this;Object(ke["a"])(this,t),Object(Se["a"])(this,"onTouchDown",(function(t){"mouse"!==t.pointerType&&(s.moving=!0,s.deltaPosition.set(0,0),s.lastPosition.set(t.center.x,t.center.y))})),Object(Se["a"])(this,"onTouchMove",(function(e){if("mouse"!==e.pointerType){var i=t.tempVec2_1.set(e.center.x,e.center.y);s.moving&&s.deltaPosition.sub(i).add(s.lastPosition),s.lastPosition.copy(i)}})),Object(Se["a"])(this,"onTouchUp",(function(t){"mouse"!==t.pointerType&&(s.moving=!1)})),Object(Se["a"])(this,"updatePixelToSpeedMultiplier",(function(){s.pixelToSpeedMultiplierX=1/s.target.clientWidth*(s.target.clientWidth/s.target.clientHeight),s.pixelToSpeedMultiplierY=1/s.target.clientHeight})),this.target=e,this.hammer=i,this.manager=null,this.moving=!1,this.lastPosition=new T["K"],this.deltaPosition=new T["K"],this.speed=n,this.stiffness=a,this.pixelToSpeedMultiplierX=0,this.pixelToSpeedMultiplierY=0,this.updatePixelToSpeedMultiplier()}return Object(Me["a"])(t,[{key:"start",value:function(t){this.manager=t,this.hammer.on("movestart",this.onTouchDown),this.hammer.on("movemove",this.onTouchMove),this.hammer.on("moveend",this.onTouchUp),this.hammer.on("movecancel",this.onTouchUp),window.addEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"stop",value:function(){this.hammer.off("movestart",this.onTouchDown),this.hammer.off("movemove",this.onTouchMove),this.hammer.off("moveend",this.onTouchUp),this.hammer.off("movecancel",this.onTouchUp),window.removeEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"update",value:function(e,i){if(0!==this.deltaPosition.x||0!==this.deltaPosition.y){var n=this.stiffness/(16.666/e);n=T["q"].clamp(n,0,1);var a=t.tempVec2_1.copy(this.deltaPosition);a.rotateAround(P,this.manager.rotation),this.manager.position.x+=a.x*n*this.manager.distance*this.speed*this.pixelToSpeedMultiplierX,this.manager.position.z+=a.y*n*this.manager.distance*this.speed*this.pixelToSpeedMultiplierY,this.deltaPosition.multiplyScalar(1-n),this.deltaPosition.lengthSq()<1e-4&&this.deltaPosition.set(0,0)}}},{key:"reset",value:function(){this.deltaPosition.set(0,0)}}]),t}();Object(Se["a"])(Sn,"tempVec2_1",new T["K"]);var xn=function(){function t(e,i,n){var a=this;Object(ke["a"])(this,t),Object(Se["a"])(this,"onTouchDown",(function(t){a.moving=!0,a.deltaRotation=0,a.lastRotation=t.rotation})),Object(Se["a"])(this,"onTouchMove",(function(t){if(a.moving){var e=t.rotation-a.lastRotation;e>180&&(e-=360),e<-180&&(e+=360),a.deltaRotation-=e}a.lastRotation=t.rotation})),Object(Se["a"])(this,"onTouchUp",(function(t){a.moving=!1})),this.hammer=e,this.manager=null,this.moving=!1,this.lastRotation=0,this.deltaRotation=0,this.speed=i,this.stiffness=n}return Object(Me["a"])(t,[{key:"start",value:function(t){this.manager=t,this.hammer.on("rotatestart",this.onTouchDown),this.hammer.on("rotatemove",this.onTouchMove),this.hammer.on("rotateend",this.onTouchUp),this.hammer.on("rotatecancel",this.onTouchUp)}},{key:"stop",value:function(){this.hammer.off("rotatestart",this.onTouchDown),this.hammer.off("rotatemove",this.onTouchMove),this.hammer.off("rotateend",this.onTouchUp),this.hammer.off("rotatecancel",this.onTouchUp)}},{key:"update",value:function(t,e){if(0!==this.deltaRotation){var i=this.stiffness/(16.666/t);i=T["q"].clamp(i,0,1),this.manager.rotation+=this.deltaRotation*i*this.speed,this.deltaRotation*=1-i,Math.abs(this.deltaRotation)<1e-4&&(this.deltaRotation=0)}}},{key:"reset",value:function(){this.deltaRotation=0}}]),t}(),On=function(){function t(e,i,n,a){var s=this;Object(ke["a"])(this,t),Object(Se["a"])(this,"onTouchDown",(function(t){s.moving=!0,s.deltaAngle=0,s.lastY=t.center.y})),Object(Se["a"])(this,"onTouchMove",(function(t){s.moving&&(s.deltaAngle-=t.center.y-s.lastY),s.lastY=t.center.y})),Object(Se["a"])(this,"onTouchUp",(function(t){s.moving=!1})),Object(Se["a"])(this,"updatePixelToSpeedMultiplier",(function(){s.pixelToSpeedMultiplierY=1/s.target.clientHeight})),this.target=e,this.hammer=i,this.manager=null,this.moving=!1,this.lastY=0,this.deltaAngle=0,this.speed=n,this.stiffness=a,this.pixelToSpeedMultiplierY=0,this.updatePixelToSpeedMultiplier()}return Object(Me["a"])(t,[{key:"start",value:function(t){this.manager=t,this.hammer.on("tiltstart",this.onTouchDown),this.hammer.on("tiltmove",this.onTouchMove),this.hammer.on("tiltend",this.onTouchUp),this.hammer.on("tiltcancel",this.onTouchUp),window.addEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"stop",value:function(){this.hammer.off("tiltstart",this.onTouchDown),this.hammer.off("tiltmove",this.onTouchMove),this.hammer.off("tiltend",this.onTouchUp),this.hammer.off("tiltcancel",this.onTouchUp),window.removeEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"update",value:function(t,e){if(0!==this.deltaAngle){var i=this.stiffness/(16.666/t);i=T["q"].clamp(i,0,1),this.manager.angle+=this.deltaAngle*i*this.speed*this.pixelToSpeedMultiplierY,this.deltaAngle*=1-i,Math.abs(this.deltaAngle)<1e-4&&(this.deltaAngle=0)}}},{key:"reset",value:function(){this.deltaAngle=0}}]),t}(),jn=function(){function t(e){var i=this;Object(ke["a"])(this,t),Object(Se["a"])(this,"onTouchDown",(function(t){i.moving=!0,i.lastZoom=1})),Object(Se["a"])(this,"onTouchMove",(function(t){i.moving&&(i.deltaZoom*=t.scale/i.lastZoom),i.lastZoom=t.scale})),Object(Se["a"])(this,"onTouchUp",(function(t){i.moving=!1})),this.hammer=e,this.manager=null,this.moving=!1,this.deltaZoom=1,this.lastZoom=1}return Object(Me["a"])(t,[{key:"start",value:function(t){this.manager=t,this.hammer.on("zoomstart",this.onTouchDown),this.hammer.on("zoommove",this.onTouchMove),this.hammer.on("zoomend",this.onTouchUp),this.hammer.on("zoomcancel",this.onTouchUp)}},{key:"stop",value:function(){this.hammer.off("zoomstart",this.onTouchDown),this.hammer.off("zoommove",this.onTouchMove),this.hammer.off("zoomend",this.onTouchUp),this.hammer.off("zoomcancel",this.onTouchUp)}},{key:"update",value:function(t,e){1!==this.deltaZoom&&(this.manager.distance/=this.deltaZoom,this.deltaZoom=1)}},{key:"reset",value:function(){this.deltaZoom=1}}]),t}(),Tn=.5*Math.PI,Pn=function(){function t(e){var i=this;Object(ke["a"])(this,t),Object(Se["a"])(this,"onContextMenu",(function(t){t.preventDefault()})),Object(Se["a"])(this,"onTap",(function(t){var e=!1,n=new T["K"](t.center.x,t.center.y),a=Date.now();i.lastTap>0&&i.lastTapCenter&&a-i.lastTap<500&&i.lastTapCenter.distanceTo(n)<5?(e=!0,i.lastTap=-1):(i.lastTap=a,i.lastTapCenter=n),i.manager.handleMapInteraction(new T["K"](t.center.x,t.center.y),{doubleTap:e})})),this.rootElement=e,this.data={followingPlayer:null},this.manager=null,this.hammer=new vn["Manager"](this.rootElement),this.initializeHammer(),this.mouseMove=new dn(this.rootElement,1.5,.3),this.mouseRotate=new mn(this.rootElement,6,.3),this.mouseAngle=new fn(this.rootElement,3,.3),this.mouseZoom=new pn(this.rootElement,1,.2),this.keyMove=new bn(this.rootElement,.025,.2),this.keyRotate=new kn(this.rootElement,.06,.15),this.keyAngle=new wn(this.rootElement,.04,.15),this.keyZoom=new Mn(this.rootElement,.2,.15),this.touchMove=new Sn(this.rootElement,this.hammer,1.5,.3),this.touchRotate=new xn(this.hammer,.0174533,.3),this.touchAngle=new On(this.rootElement,this.hammer,3,.3),this.touchZoom=new jn(this.hammer),this.mapHeight=new gn(.2,.1),this.lastTap=-1,this.lastTapCenter=null}return Object(Me["a"])(t,[{key:"start",value:function(t){this.manager=t,this.rootElement.addEventListener("contextmenu",this.onContextMenu),this.hammer.on("tap",this.onTap),this.mouseMove.start(t),this.mouseRotate.start(t),this.mouseAngle.start(t),this.mouseZoom.start(t),this.keyMove.start(t),this.keyRotate.start(t),this.keyAngle.start(t),this.keyZoom.start(t),this.touchMove.start(t),this.touchRotate.start(t),this.touchAngle.start(t),this.touchZoom.start(t),this.mapHeight.start(t)}},{key:"stop",value:function(){this.stopFollowingPlayerMarker(),this.rootElement.removeEventListener("contextmenu",this.onContextMenu),this.hammer.off("tap",this.onTap),this.mouseMove.stop(),this.mouseRotate.stop(),this.mouseAngle.stop(),this.mouseZoom.stop(),this.keyMove.stop(),this.keyRotate.stop(),this.keyAngle.stop(),this.keyZoom.stop(),this.touchMove.stop(),this.touchRotate.stop(),this.touchAngle.stop(),this.touchZoom.stop(),this.mapHeight.stop()}},{key:"update",value:function(e,i){this.manager.position.y=0,t._beforeMoveTemp.copy(this.manager.position),this.mouseMove.update(e,i),this.keyMove.update(e,i),this.touchMove.update(e,i),this.data.followingPlayer&&!t._beforeMoveTemp.equals(this.manager.position)&&this.stopFollowingPlayerMarker(),this.data.followingPlayer&&this.manager.position.copy(this.data.followingPlayer.position),this.mouseZoom.update(e,i),this.keyZoom.update(e,i),this.touchZoom.update(e,i),this.manager.distance=I(this.manager.distance,5,1e4,.8);var n=this.getMaxPerspectiveAngleForDistance(this.manager.distance);0===this.manager.ortho&&(this.mouseRotate.update(e,i),this.keyRotate.update(e,i),this.touchRotate.update(e,i)),0===this.manager.ortho&&(this.mouseAngle.update(e,i),this.keyAngle.update(e,i),this.touchAngle.update(e,i),this.manager.angle=I(this.manager.angle,0,n,.8)),0!==this.manager.ortho&&0!==this.manager.angle||(this.mapHeight.maxAngle=n,this.mapHeight.update(e,i))}},{key:"reset",value:function(){this.mouseMove.reset(),this.mouseRotate.reset(),this.mouseAngle.reset(),this.mouseZoom.reset(),this.touchMove.reset(),this.touchRotate.reset(),this.touchAngle.reset(),this.touchZoom.reset()}},{key:"getMaxPerspectiveAngleForDistance",value:function(t){return T["q"].clamp((1-Math.pow(Math.max(t-5,.001)/500,.5))*Tn,0,Tn)}},{key:"initializeHammer",value:function(){var t=new vn["Tap"]({event:"tap",pointers:1,taps:1,threshold:5}),e=new vn["Pan"]({event:"move",pointers:1,direction:vn["DIRECTION_ALL"],threshold:0}),i=new vn["Pan"]({event:"tilt",pointers:2,direction:vn["DIRECTION_VERTICAL"],threshold:0}),n=new vn["Rotate"]({event:"rotate",pointers:2,threshold:0}),a=new vn["Pinch"]({event:"zoom",pointers:2,threshold:0});e.recognizeWith(n),e.recognizeWith(i),e.recognizeWith(a),i.recognizeWith(n),i.recognizeWith(a),n.recognizeWith(a),this.hammer.add(t),this.hammer.add(i),this.hammer.add(e),this.hammer.add(n),this.hammer.add(a)}},{key:"followPlayerMarker",value:function(t){t.isPlayerMarker&&(t=t.data),this.data.followingPlayer=t}},{key:"stopFollowingPlayerMarker",value:function(){this.data.followingPlayer=null}}]),t}();Object(Se["a"])(Pn,"_beforeMoveTemp",new T["L"]);var Dn=function(){function t(e,i,n){var a=this;Object(ke["a"])(this,t),Object(Se["a"])(this,"onKeyDown",(function(e){yn.oneUp.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.UP)))&&(a.up=!0,e.preventDefault()),yn.oneUp.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.DOWN)))&&(a.down=!0,e.preventDefault()),yn.oneUp.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.LEFT)))&&(a.left=!0,e.preventDefault()),yn.oneUp.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.RIGHT)))&&(a.right=!0,e.preventDefault())})),Object(Se["a"])(this,"onKeyUp",(function(e){yn.oneUp.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.UP)))&&(a.up=!1),yn.oneUp.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.DOWN)))&&(a.down=!1),yn.oneUp.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.LEFT)))&&(a.left=!1),yn.oneUp.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.RIGHT)))&&(a.right=!1)})),this.target=e,this.manager=null,this.deltaPosition=new T["K"],this.up=!1,this.down=!1,this.left=!1,this.right=!1,this.speed=i,this.stiffness=n}return Object(Me["a"])(t,[{key:"start",value:function(t){this.manager=t,window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}},{key:"stop",value:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}},{key:"update",value:function(e,i){if(this.up&&(this.deltaPosition.y-=1),this.down&&(this.deltaPosition.y+=1),this.left&&(this.deltaPosition.x-=1),this.right&&(this.deltaPosition.x+=1),0!==this.deltaPosition.x||0!==this.deltaPosition.y){var n=this.stiffness/(16.666/e);n=T["q"].clamp(n,0,1);var a=t.temp_v2.copy(this.deltaPosition);a.rotateAround(P,this.manager.rotation),this.manager.position.x+=a.x*n*this.speed*e*.06,this.manager.position.z+=a.y*n*this.speed*e*.06,this.deltaPosition.multiplyScalar(1-n),this.deltaPosition.lengthSq()<1e-4&&this.deltaPosition.set(0,0)}}}]),t}();Object(Se["a"])(Dn,"KEYS",{LEFT:[new yn("ArrowLeft"),new yn("KeyA")],UP:[new yn("ArrowUp"),new yn("KeyW")],RIGHT:[new yn("ArrowRight"),new yn("KeyD")],DOWN:[new yn("ArrowDown"),new yn("KeyS")]}),Object(Se["a"])(Dn,"temp_v2",new T["K"]);var Ln=function(){function t(e,i,n,a,s){var r=this;Object(ke["a"])(this,t),Object(Se["a"])(this,"onMouseDown",(function(t){r.moving=!0,r.deltaRotation=0,r.lastX=t.x})),Object(Se["a"])(this,"onMouseMove",(function(t){document.pointerLockElement?r.deltaRotation-=t.movementX*r.speedCapture*r.pixelToSpeedMultiplier:r.moving&&(1===t.buttons?r.deltaRotation-=(t.x-r.lastX)*r.speedLeft*r.pixelToSpeedMultiplier:r.deltaRotation-=(t.x-r.lastX)*r.speedRight*r.pixelToSpeedMultiplier),r.lastX=t.x})),Object(Se["a"])(this,"onMouseUp",(function(t){r.moving=!1})),Object(Se["a"])(this,"updatePixelToSpeedMultiplier",(function(){r.pixelToSpeedMultiplier=1/r.target.clientWidth*(r.target.clientWidth/r.target.clientHeight)})),this.target=e,this.manager=null,this.moving=!1,this.lastX=0,this.deltaRotation=0,this.speedLeft=i,this.speedRight=n,this.speedCapture=a,this.stiffness=s,this.pixelToSpeedMultiplier=0,this.updatePixelToSpeedMultiplier()}return Object(Me["a"])(t,[{key:"start",value:function(t){this.manager=t,this.target.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"stop",value:function(){this.target.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"update",value:function(t,e){if(0!==this.deltaRotation){var i=this.stiffness/(16.666/t);i=T["q"].clamp(i,0,1),this.manager.rotation+=this.deltaRotation*i,this.deltaRotation*=1-i,Math.abs(this.deltaRotation)<1e-4&&(this.deltaRotation=0)}}},{key:"reset",value:function(){this.deltaRotation=0}}]),t}(),En=function(){function t(e,i,n,a,s){var r=this;Object(ke["a"])(this,t),Object(Se["a"])(this,"onMouseDown",(function(t){r.moving=!0,r.deltaAngle=0,r.lastY=t.y})),Object(Se["a"])(this,"onMouseMove",(function(t){document.pointerLockElement?r.deltaAngle+=t.movementY*r.speedCapture*r.pixelToSpeedMultiplier:r.moving&&(1===t.buttons?r.deltaAngle+=(t.y-r.lastY)*r.speedLeft*r.pixelToSpeedMultiplier:r.deltaAngle+=(t.y-r.lastY)*r.speedRight*r.pixelToSpeedMultiplier),r.lastY=t.y})),Object(Se["a"])(this,"onMouseUp",(function(t){r.moving=!1})),Object(Se["a"])(this,"updatePixelToSpeedMultiplier",(function(){r.pixelToSpeedMultiplier=1/r.target.clientHeight})),this.target=e,this.manager=null,this.moving=!1,this.lastY=0,this.deltaAngle=0,this.speedLeft=i,this.speedRight=n,this.speedCapture=a,this.stiffness=s,this.pixelToSpeedMultiplier=0,this.updatePixelToSpeedMultiplier()}return Object(Me["a"])(t,[{key:"start",value:function(t){this.manager=t,this.target.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"stop",value:function(){this.target.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"update",value:function(t,e){if(0!==this.deltaAngle){var i=this.stiffness/(16.666/t);i=T["q"].clamp(i,0,1),this.manager.angle+=this.deltaAngle*i,this.deltaAngle*=1-i,Math.abs(this.deltaAngle)<1e-4&&(this.deltaAngle=0)}}},{key:"reset",value:function(){this.deltaAngle=0}}]),t}(),Cn=function(){function t(e,i,n){var a=this;Object(ke["a"])(this,t),Object(Se["a"])(this,"onKeyDown",(function(e){yn.oneUp.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.UP)))?(a.up=!0,e.preventDefault()):yn.oneUp.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.DOWN)))&&(a.down=!0,e.preventDefault())})),Object(Se["a"])(this,"onKeyUp",(function(e){yn.oneUp.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.UP)))&&(a.up=!1),yn.oneUp.apply(yn,[e].concat(Object(Te["a"])(t.KEYS.DOWN)))&&(a.down=!1)})),this.target=e,this.manager=null,this.deltaY=0,this.up=!1,this.down=!1,this.speed=i,this.stiffness=n}return Object(Me["a"])(t,[{key:"start",value:function(t){this.manager=t,window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}},{key:"stop",value:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}},{key:"update",value:function(t,e){if(this.up&&(this.deltaY+=1),this.down&&(this.deltaY-=1),0!==this.deltaY){var i=this.stiffness/(16.666/t);i=T["q"].clamp(i,0,1),this.manager.position.y+=this.deltaY*i*this.speed*t*.06,this.deltaY*=1-i,Math.abs(this.deltaY)<1e-4&&(this.deltaY=0)}}}]),t}();Object(Se["a"])(Cn,"KEYS",{UP:[new yn("Space"),new yn("PageUp")],DOWN:[new yn("ShiftLeft"),new yn("ShiftRight"),new yn("PageDown")]});var _n=function(){function t(e,i,n,a){var s=this;Object(ke["a"])(this,t),Object(Se["a"])(this,"onTouchDown",(function(t){"mouse"!==t.pointerType&&(s.moving=!0,s.deltaPosition.set(0,0),s.lastPosition.set(t.center.x,t.center.y))})),Object(Se["a"])(this,"onTouchMove",(function(e){if("mouse"!==e.pointerType){var i=t.tempVec2_1.set(e.center.x,e.center.y);s.moving&&s.deltaPosition.sub(i).add(s.lastPosition),s.lastPosition.copy(i)}})),Object(Se["a"])(this,"onTouchUp",(function(t){"mouse"!==t.pointerType&&(s.moving=!1)})),Object(Se["a"])(this,"updatePixelToSpeedMultiplier",(function(){s.pixelToSpeedMultiplierX=1/s.target.clientWidth*(s.target.clientWidth/s.target.clientHeight),s.pixelToSpeedMultiplierY=1/s.target.clientHeight})),this.target=e,this.hammer=i,this.manager=null,this.moving=!1,this.lastPosition=new T["K"],this.deltaPosition=new T["K"],this.speed=n,this.stiffness=a,this.pixelToSpeedMultiplierX=0,this.pixelToSpeedMultiplierY=0,this.updatePixelToSpeedMultiplier()}return Object(Me["a"])(t,[{key:"start",value:function(t){this.manager=t,this.hammer.on("movestart",this.onTouchDown),this.hammer.on("movemove",this.onTouchMove),this.hammer.on("moveend",this.onTouchUp),this.hammer.on("movecancel",this.onTouchUp),window.addEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"stop",value:function(){this.hammer.off("movestart",this.onTouchDown),this.hammer.off("movemove",this.onTouchMove),this.hammer.off("moveend",this.onTouchUp),this.hammer.off("movecancel",this.onTouchUp),window.removeEventListener("resize",this.updatePixelToSpeedMultiplier)}},{key:"update",value:function(t,e){if(0!==this.deltaPosition.x||0!==this.deltaPosition.y){var i=this.stiffness/(16.666/t);i=T["q"].clamp(i,0,1),this.manager.rotation+=this.deltaPosition.x*this.speed*this.pixelToSpeedMultiplierX*this.stiffness,this.manager.angle-=this.deltaPosition.y*this.speed*this.pixelToSpeedMultiplierY*this.stiffness,this.deltaPosition.multiplyScalar(1-i),this.deltaPosition.lengthSq()<1e-4&&this.deltaPosition.set(0,0)}}},{key:"reset",value:function(){this.deltaPosition.set(0,0)}}]),t}();Object(Se["a"])(_n,"tempVec2_1",new T["K"]);var An=function(){function t(e){var i=this;Object(ke["a"])(this,t),Object(Se["a"])(this,"onContextMenu",(function(t){t.preventDefault()})),Object(Se["a"])(this,"onMouseDown",(function(t){i.clickStart.set(t.x,t.y)})),Object(Se["a"])(this,"onMouseUp",(function(t){Math.abs(i.clickStart.x-t.x)>5||Math.abs(i.clickStart.y-t.y)>5||document.body.requestFullscreen().finally((function(){i.target.requestPointerLock()}))})),Object(Se["a"])(this,"onWheel",(function(t){var e=t.deltaY;t.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(e*=.01),t.deltaMode===WheelEvent.DOM_DELTA_LINE&&(e*=.33),i.moveSpeed*=Math.pow(1.5,.25*-e),i.moveSpeed=T["q"].clamp(i.moveSpeed,.05,5),i.keyMove.speed=i.moveSpeed,i.keyHeight.speed=i.moveSpeed})),this.target=e,this.manager=null,this.data={},this.hammer=new vn["Manager"](this.target),this.initializeHammer(),this.keyMove=new Dn(this.target,.5,.1),this.keyHeight=new Cn(this.target,.5,.2),this.mouseRotate=new Ln(this.target,1.5,-2,-1.5,.5),this.mouseAngle=new En(this.target,1.5,-2,-1.5,.5),this.touchPan=new _n(this.target,this.hammer,5,.15),this.started=!1,this.clickStart=new T["K"],this.moveSpeed=.5,this.animationTargetHeight=0}return Object(Me["a"])(t,[{key:"start",value:function(t){this.manager=t,this.keyMove.start(t),this.keyHeight.start(t),this.mouseRotate.start(t),this.mouseAngle.start(t),this.touchPan.start(t),this.target.addEventListener("contextmenu",this.onContextMenu),this.target.addEventListener("mousedown",this.onMouseDown),this.target.addEventListener("mouseup",this.onMouseUp),window.addEventListener("wheel",this.onWheel,{passive:!0})}},{key:"stop",value:function(){this.keyMove.stop(),this.keyHeight.stop(),this.mouseRotate.stop(),this.mouseAngle.stop(),this.touchPan.stop(),this.target.removeEventListener("contextmenu",this.onContextMenu),this.target.removeEventListener("mousedown",this.onMouseDown),this.target.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("wheel",this.onWheel)}},{key:"update",value:function(t,e){this.keyMove.update(t,e),this.keyHeight.update(t,e),this.mouseRotate.update(t,e),this.mouseAngle.update(t,e),this.touchPan.update(t,e),this.manager.angle=T["q"].clamp(this.manager.angle,0,Math.PI),this.manager.distance=0,this.manager.ortho=0}},{key:"initializeHammer",value:function(){var t=new vn["Pan"]({event:"move",pointers:1,direction:vn["DIRECTION_ALL"],threshold:0});this.hammer.add(t)}}]),t}();T["w"].prototype.onClick=function(t){return!!this.parent&&(Array.isArray(t.eventStack)||(t.eventStack=[]),t.eventStack.push(this),this.parent.onClick(t))};var zn=function(t){Object(ki["a"])(i,t);var e=Object(Mi["a"])(i);function i(t,n,a){var s;Object(ke["a"])(this,i),s=e.call(this,t),Object(Se["a"])(Object(wi["a"])(s),"onMapInteraction",(function(t){var e=!0,i=t.detail.hiresHit;if(i||(e=!1,i=t.detail.lowresHit),i){if(s.position.copy(i.pointOnLine||i.point).add(t.detail.ray.direction.clone().multiplyScalar(.05)).floor(),s.element.innerHTML=e?'\n                <div class="group">\n                    <div class="label">'.concat(pe.t("blockTooltip.block"),':</div>\n                    <div class="content">\n                        <div class="entry"><span class="label">x: </span><span class="value">').concat(s.position.x,'</span></div>\n                        <div class="entry"><span class="label">y: </span><span class="value">').concat(s.position.y,'</span></div>\n                        <div class="entry"><span class="label">z: </span><span class="value">').concat(s.position.z,"</span></div>\n                    </div>\n                </div>\n            "):'\n                <div class="group">\n                    <div class="label">'.concat(pe.t("blockTooltip.position"),':</div>\n                    <div class="content">\n                        <div class="entry"><span class="label">x: </span><span class="value">').concat(s.position.x,'</span></div>\n                        <div class="entry"><span class="label">z: </span><span class="value">').concat(s.position.z,"</span></div>\n                    </div>\n                </div>\n            "),s.appState.debug){var n=s.position.clone().divideScalar(16).floor(),a=new T["K"](s.position.x,s.position.z).divideScalar(512).floor(),r="r.".concat(a.x,".").concat(a.y,".mca");s.element.innerHTML+='\n                <hr>\n                <div class="group">\n                    <div class="label">'.concat(pe.t("blockTooltip.chunk"),':</div>\n                    <div class="content">\n                        <div class="entry"><span class="label">x: </span><span class="value">').concat(n.x,'</span></div>\n                        <div class="entry"><span class="label">y: </span><span class="value">').concat(n.y,'</span></div>\n                        <div class="entry"><span class="label">z: </span><span class="value">').concat(n.z,'</span></div>\n                    </div>\n                </div>\n                <hr>\n                <div class="group">\n                    <div class="label">').concat(pe.t("blockTooltip.region.region"),':</div>\n                    <div class="content">\n                        <div class="entry"><span class="label">x: </span><span class="value">').concat(a.x,'</span></div>\n                        <div class="entry"><span class="label">z: </span><span class="value">').concat(a.y,'</span></div>\n                    </div>\n                    <div class="content">\n                        <div class="entry"><span class="label">').concat(pe.t("blockTooltip.region.file"),': </span><span class="value">').concat(r,"</span></div>\n                    </div>\n                </div>\n            ")}if(s.appState.debug){var o=i.faceIndex,l=i.object.geometry.attributes;if(l.sunlight&&l.blocklight){var c=l.sunlight.array[3*o],u=l.blocklight.array[3*o];s.element.innerHTML+='\n                    <hr>\n                    <div class="group">\n                        <div class="label">'.concat(pe.t("blockTooltip.light.light"),':</div>\n                        <div class="content">\n                            <div class="entry"><span class="label">').concat(pe.t("blockTooltip.light.sun"),': </span><span class="value">').concat(c,'</span></div>\n                            <div class="entry"><span class="label">').concat(pe.t("blockTooltip.light.block"),': </span><span class="value">').concat(u,"</span></div>\n                        </div>\n                    </div>\n                ")}}if(s.appState.debug){var h="";if(e){var d=t.detail.hiresHit.object.userData.tileUrl;h+="<div>".concat(d,"</div>")}var p=t.detail.lowresHit.object.userData.tileUrl;h+="<div>".concat(p,"</div>"),s.element.innerHTML+='\n                <hr>\n                <div class="files">\n                    '.concat(h,"\n                </div>\n            ")}s.appState.debug&&console.debug("Clicked Position Data:",t.detail),s.open()}})),Object(Se["a"])(Object(wi["a"])(s),"removeHandler",(function(t){t.composedPath().includes(s.element)||s.close()})),s.data.type="popup",s.data.label="Last Map Interaction",s.appState=n,s.events=a,s.visible=!1,s.elementObject=new Ai(U('<div id="bm-marker-'.concat(s.data.id,'" class="bm-marker-').concat(s.data.type,'">Test</div>'))),s.elementObject.position.set(.5,1,.5),s.addEventListener("removed",(function(){s.element.parentNode&&s.element.parentNode.removeChild(s.element)}));var r=new T["c"](1.01,1.01,1.01).translate(.5,.5,.5),o=new T["t"]({color:16777215,opacity:.5,transparent:!0});return s.cube=new T["s"](r,o),s.cube.onClick=function(t){return s.onClick(t)},s.add(s.elementObject),s.add(s.cube),s.animation=null,s.events.addEventListener("bluemapMapInteraction",s.onMapInteraction),window.addEventListener("mousedown",s.removeHandler),window.addEventListener("touchstart",s.removeHandler),window.addEventListener("keydown",s.removeHandler),window.addEventListener("mousewheel",s.removeHandler),s}return Object(Me["a"])(i,[{key:"onClick",value:function(t){return!0}},{key:"open",value:function(){var t=this;this.animation&&this.animation.cancel(),this.visible=!0,this.cube.visible=!0;var e=1;this.element.style.opacity="0",this.animation=F((function(i){t.element.style.opacity=(i*e).toString()}),300)}},{key:"close",value:function(){var t=this;this.animation&&this.animation.cancel(),this.cube.visible=!1;var e=parseFloat(this.element.style.opacity);this.animation=F((function(i){t.element.style.opacity=(e-i*e).toString()}),300,(function(e){e&&(t.visible=!1)}))}},{key:"element",get:function(){return this.elementObject.element.getElementsByTagName("div")[0]}},{key:"dispose",value:function(){Object(Si["a"])(Object(xi["a"])(i.prototype),"dispose",this).call(this),this.element.parentNode&&this.element.parentNode.removeChild(this.element)}}]),i}(_i),Un=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:360;e=JSON.stringify(e);var n=new Date;n.setTime(n.getTime()+24*i*60*60*1e3),document.cookie=t+"="+e+";expires="+n.toUTCString()+";SameSite=Lax"},Fn=function(t){for(var e=decodeURIComponent(document.cookie),i=e.split(";"),n=0;n<i.length;n++){var a=i[n];while(" "===a.charAt(0))a=a.substring(1);if(0===a.indexOf(t+"=")){var s=a.substring(t.length+1,a.length);try{s=JSON.parse(s)}catch(r){}return s}}},Vn=function(t,e){var i=Math.pow(10,e);return Math.round(t*i)/i},Rn=function(){function t(e){var i=this;Object(ke["a"])(this,t),Object(Se["a"])(this,"update",Object(jt["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,i.followPlayerMarkerWorld();case 2:i.updateLoop=setTimeout(i.update,1e3);case 3:case"end":return t.stop()}}),t)})))),Object(Se["a"])(this,"cameraMoved",(function(){i.hashUpdateTimeout&&clearTimeout(i.hashUpdateTimeout),i.hashUpdateTimeout=setTimeout(i.updatePageAddress,1500)})),Object(Se["a"])(this,"updatePageAddress",(function(){var t="#";if(i.mapViewer.map){t+=i.mapViewer.map.data.id;var e=i.mapViewer.controlsManager;t+=":"+Vn(e.position.x,0),t+=":"+Vn(e.position.y,0),t+=":"+Vn(e.position.z,0),t+=":"+Vn(e.distance,0),t+=":"+Vn(e.rotation,2),t+=":"+Vn(e.angle,2),t+=":"+Vn(e.tilt,2),t+=":"+Vn(e.ortho,0),t+=":"+i.appState.controls.state}history.replaceState(void 0,void 0,t),document.title=pe.t("pageTitle",{map:i.mapViewer.map?i.mapViewer.map.data.name:"?"})})),Object(Se["a"])(this,"loadPageAddress",Object(jt["a"])(regeneratorRuntime.mark((function t(){var e,n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=window.location.hash.substr(1),n=e.split(":"),10===n.length){t.next=4;break}return t.abrupt("return",!1);case 4:if(a=i.mapViewer.controlsManager,a.controls=null,i.mapViewer.map&&i.mapViewer.map.data.id===n[0]){t.next=15;break}return t.prev=7,t.next=10,i.switchMap(n[0]);case 10:t.next=15;break;case 12:return t.prev=12,t.t0=t["catch"](7),t.abrupt("return",!1);case 15:a.position.x=parseFloat(n[1]),a.position.y=parseFloat(n[2]),a.position.z=parseFloat(n[3]),a.distance=parseFloat(n[4]),a.rotation=parseFloat(n[5]),a.angle=parseFloat(n[6]),a.tilt=parseFloat(n[7]),a.ortho=parseFloat(n[8]),t.t1=n[9],t.next="flat"===t.t1?26:"free"===t.t1?28:30;break;case 26:return i.setFlatView(0),t.abrupt("break",32);case 28:return i.setFreeFlight(0,a.position.y),t.abrupt("break",32);case 30:return i.setPerspectiveView(0),t.abrupt("break",32);case 32:return t.abrupt("return",!0);case 33:case"end":return t.stop()}}),t,null,[[7,12]])})))),Object(Se["a"])(this,"mapInteraction",(function(t){if(t.detail.data.doubleTap){var e=i.mapViewer.controlsManager,n=!!t.detail.hit&&t.detail.hit.point||t.detail.object.getWorldPosition(new T["L"]),a=e.distance,s=Math.max(.25*a,5),r=e.position.x,o=n.x,l=e.position.z,c=n.z;i.viewAnimation=F((function(t){var i=V.easeInOutQuad(t);e.distance=T["q"].lerp(a,s,i),e.position.x=T["q"].lerp(r,o,i),e.position.z=T["q"].lerp(l,c,i)}),500)}})),this.events=e,this.mapViewer=new hn(e,this.events),this.mapControls=new Pn(this.mapViewer.renderer.domElement),this.freeFlightControls=new An(this.mapViewer.renderer.domElement),this.playerMarkerManager=null,this.markerFileManager=null,this.settings=null,this.savedUserSettings=new Map,this.maps=[],this.mapsMap=new Map,this.dataUrl="data/",this.mainMenu=new xe,this.appState={controls:{state:"perspective",mouseSensitivity:1,invertMouse:!1},menu:this.mainMenu,maps:[],theme:null,debug:!1},this.updateControlsSettings(),this.popupMarkerSet=new Oi("bm-popup-set"),this.popupMarker=new zn("bm-popup",this.appState,this.events),this.popupMarkerSet.add(this.popupMarker),this.mapViewer.markers.add(this.popupMarkerSet),this.updateLoop=null,this.hashUpdateTimeout=null,this.viewAnimation=null}return Object(Me["a"])(t,[{key:"load",value:function(){var t=Object(jt["a"])(regeneratorRuntime.mark((function t(){var e,i,n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.maps,this.maps=[],this.appState.maps.splice(0,this.appState.maps.length),this.mapsMap.clear(),t.next=6,this.getSettings();case 6:return t.next=8,this.mapViewer.switchMap(null);case 8:e.forEach((function(t){return t.dispose()})),this.maps=this.loadMaps(),i=Object(u["a"])(this.maps);try{for(i.s();!(n=i.n()).done;)a=n.value,this.mapsMap.set(a.data.id,a),this.appState.maps.push(a.data)}catch(s){i.e(s)}finally{i.f()}return t.next=14,this.loadPageAddress();case 14:if(t.sent){t.next=19;break}if(!(this.maps.length>0)){t.next=18;break}return t.next=18,this.switchMap(this.maps[0].data.id);case 18:this.resetCamera();case 19:return window.addEventListener("hashchange",this.loadPageAddress),this.events.addEventListener("bluemapCameraMoved",this.cameraMoved),this.events.addEventListener("bluemapMapInteraction",this.mapInteraction),this.updateLoop&&clearTimeout(this.updateLoop),this.updateLoop=setTimeout(this.update,1e3),t.next=26,this.loadUserSettings();case 26:this.saveUserSettings();case 27:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"followPlayerMarkerWorld",value:function(){var t=Object(jt["a"])(regeneratorRuntime.mark((function t(){var e,i,n,a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=!!this.mapViewer.controlsManager.controls&&this.mapViewer.controlsManager.controls.data.followingPlayer,!this.mapViewer.map||!e){t.next=27;break}if(e.world===this.mapViewer.map.data.world){t.next=27;break}i=null,n=Object(u["a"])(this.maps),t.prev=5,n.s();case 7:if((a=n.n()).done){t.next=14;break}if(s=a.value,s.data.world!==e.world){t.next=12;break}return i=s,t.abrupt("break",14);case 12:t.next=7;break;case 14:t.next=19;break;case 16:t.prev=16,t.t0=t["catch"](5),n.e(t.t0);case 19:return t.prev=19,n.f(),t.finish(19);case 22:if(i){t.next=25;break}return this.mapViewer.controlsManager.controls.stopFollowingPlayerMarker&&this.mapViewer.controlsManager.controls.stopFollowingPlayerMarker(),t.abrupt("return");case 25:return t.next=27,this.switchMap(i.data.id);case 27:case"end":return t.stop()}}),t,this,[[5,16,19,22]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"switchMap",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.mapsMap.get(t);if(!n)return Promise.reject('There is no map with the id "'.concat(t,'" loaded!'));var a=this.mapViewer.map?this.mapViewer.map.data.world:null;return this.mapViewer.switchMap(n).then((function(){n&&(e.initPlayerMarkerManager(),e.initMarkerFileManager(),i&&n.data.world!==a&&e.resetCamera()),e.updatePageAddress()}))}},{key:"resetCamera",value:function(){var t=this.mapViewer.map,e=this.mapViewer.controlsManager;t&&(e.position.set(t.data.startPos.x,0,t.data.startPos.z),e.distance=500,e.angle=0,e.rotation=0,e.tilt=0,e.ortho=0),e.controls=this.mapControls,this.appState.controls.state="perspective",this.updatePageAddress()}},{key:"loadMaps",value:function(){var t=this,e=this.settings,i=[];if(void 0!==e.maps)for(var n in e.maps)if(Object.prototype.hasOwnProperty.call(e.maps,n)){var a=e.maps[n];a.enabled&&function(){var e=new Qi(n,t.dataUrl+n+"/",t.dataUrl+"settings.json",t.dataUrl+"textures.json",t.mapViewer.events);i.push(e),e.loadSettings().catch((function(i){z(t.events,"Failed to load settings for map '".concat(e.data.id,"':")+i,"warning")}))}()}return i.sort((function(t,i){var n=e.maps[t.data.id].ordinal-e.maps[i.data.id].ordinal;return isNaN(n)?0:n})),i}},{key:"getSettings",value:function(){var t=Object(jt["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.settings){t.next=4;break}return t.next=3,this.loadSettings();case 3:this.settings=t.sent;case 4:return t.abrupt("return",this.settings);case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"loadSettings",value:function(){var t=this;return new Promise((function(e,i){var n=new T["i"];n.setResponseType("json"),n.load(t.dataUrl+"settings.json?"+_(),e,(function(){}),(function(){return i("Failed to load the settings.json!")}))}))}},{key:"initPlayerMarkerManager",value:function(){var t=this;this.mapViewer.map&&(this.playerMarkerManager?this.playerMarkerManager.worldId=this.mapViewer.map.data.world:this.playerMarkerManager=new Zi(this.mapViewer.markers,"live/players",this.mapViewer.map.data.world,this.events),this.playerMarkerManager.setAutoUpdateInterval(0),this.playerMarkerManager.update().then((function(){t.playerMarkerManager.setAutoUpdateInterval(1e3)})).catch((function(e){z(t.events,e,"warning"),t.playerMarkerManager.clear(),t.playerMarkerManager.dispose()})))}},{key:"initMarkerFileManager",value:function(){var t=this;this.markerFileManager&&(this.markerFileManager.clear(),this.markerFileManager.dispose()),this.mapViewer.map&&(this.markerFileManager=new Gi(this.mapViewer.markers,"data/markers.json",this.mapViewer.map.data.id,this.events),this.markerFileManager.update().then((function(){t.markerFileManager.setAutoUpdateInterval(1e4)})).catch((function(e){z(t.events,e,"warning"),t.markerFileManager.clear(),t.markerFileManager.dispose()})))}},{key:"updateControlsSettings",value:function(){var t=this.appState.controls.invertMouse?-1:1;this.freeFlightControls.mouseRotate.speedCapture=-1.5*this.appState.controls.mouseSensitivity,this.freeFlightControls.mouseAngle.speedCapture=-1.5*this.appState.controls.mouseSensitivity*t,this.freeFlightControls.mouseRotate.speedRight=-2*this.appState.controls.mouseSensitivity,this.freeFlightControls.mouseAngle.speedRight=-2*this.appState.controls.mouseSensitivity*t}},{key:"setPerspectiveView",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;if(this.mapViewer.map){this.viewAnimation&&this.viewAnimation.cancel();var n=this.mapViewer.controlsManager;n.controls=null;var a=n.distance,s=Math.max(5,i,a),r=n.position.y,o=T["q"].lerp(this.mapViewer.map.terrainHeightAt(n.position.x,n.position.z)+3,0,s/500),l=n.angle,c=Math.min(Math.PI/2,l,this.mapControls.getMaxPerspectiveAngleForDistance(s)),u=n.ortho,h=n.tilt;this.viewAnimation=F((function(t){var e=V.easeInOutQuad(t);n.position.y=T["q"].lerp(r,o,e),n.distance=T["q"].lerp(a,s,e),n.angle=T["q"].lerp(l,c,e),n.ortho=T["q"].lerp(u,0,t),n.tilt=T["q"].lerp(h,0,e)}),e,(function(e){t.mapControls.reset(),e&&(n.controls=t.mapControls,t.updatePageAddress())})),this.appState.controls.state="perspective"}}},{key:"setFlatView",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;if(this.mapViewer.map){this.viewAnimation&&this.viewAnimation.cancel();var n=this.mapViewer.controlsManager;n.controls=null;var a=n.distance,s=Math.max(5,i,a),r=n.rotation,o=n.angle,l=n.ortho,c=n.tilt;this.viewAnimation=F((function(t){var e=V.easeInOutQuad(t);n.distance=T["q"].lerp(a,s,e),n.rotation=T["q"].lerp(r,0,e),n.angle=T["q"].lerp(o,0,e),n.ortho=T["q"].lerp(l,1,t),n.tilt=T["q"].lerp(c,0,e)}),e,(function(e){t.mapControls.reset(),e&&(n.controls=t.mapControls,t.updatePageAddress())})),this.appState.controls.state="flat"}}},{key:"setFreeFlight",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(this.mapViewer.map){this.viewAnimation&&this.viewAnimation.cancel();var n=this.mapViewer.controlsManager;n.controls=null;var a=n.distance,s=n.position.y;i||(i=this.mapViewer.map.terrainHeightAt(n.position.x,n.position.z)+3);var r=n.angle,o=Math.PI/2,l=n.ortho,c=n.tilt;this.viewAnimation=F((function(t){var e=V.easeInOutQuad(t);n.position.y=T["q"].lerp(s,i,e),n.distance=T["q"].lerp(a,0,e),n.angle=T["q"].lerp(r,o,e),n.ortho=T["q"].lerp(l,0,Math.min(2*t,1)),n.tilt=T["q"].lerp(c,0,e)}),e,(function(e){e&&(n.controls=t.freeFlightControls,t.updatePageAddress())})),this.appState.controls.state="free"}}},{key:"setDebug",value:function(t){this.appState.debug=t,t?this.mapViewer.stats.showPanel(0):this.mapViewer.stats.showPanel(-1)}},{key:"setTheme",value:function(t){this.appState.theme=t,"light"===t?(this.mapViewer.rootElement.classList.remove("theme-dark"),this.mapViewer.rootElement.classList.add("theme-light")):"dark"===t?(this.mapViewer.rootElement.classList.remove("theme-light"),this.mapViewer.rootElement.classList.add("theme-dark")):(this.mapViewer.rootElement.classList.remove("theme-light"),this.mapViewer.rootElement.classList.remove("theme-dark"))}},{key:"updateMap",value:function(){var t=Object(jt["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,this.mapViewer.clearTileCache(),!this.mapViewer.map){t.next=5;break}return t.next=5,this.switchMap(this.mapViewer.map.data.id);case 5:this.saveUserSettings(),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),z(this.events,t.t0,"error");case 11:case"end":return t.stop()}}),t,this,[[0,8]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"resetSettings",value:function(){this.saveUserSetting("resetSettings",!0),location.reload()}},{key:"loadUserSettings",value:function(){var t=Object(jt["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.settings.useCookies){t.next=2;break}return t.abrupt("return");case 2:if(!this.loadUserSetting("resetSettings",!1)){t.next=6;break}return z(this.events,"Settings reset!","info"),this.saveUserSettings(),t.abrupt("return");case 6:return this.mapViewer.clearTileCache(this.loadUserSetting("tileCacheHash",this.mapViewer.tileCacheHash)),this.mapViewer.superSampling=this.loadUserSetting("superSampling",this.mapViewer.data.superSampling),this.mapViewer.data.loadedHiresViewDistance=this.loadUserSetting("hiresViewDistance",this.mapViewer.data.loadedHiresViewDistance),this.mapViewer.data.loadedLowresViewDistance=this.loadUserSetting("lowresViewDistance",this.mapViewer.data.loadedLowresViewDistance),this.mapViewer.updateLoadedMapArea(),this.appState.controls.mouseSensitivity=this.loadUserSetting("mouseSensitivity",this.appState.controls.mouseSensitivity),this.appState.controls.invertMouse=this.loadUserSetting("invertMouse",this.appState.controls.invertMouse),this.updateControlsSettings(),this.setTheme(this.loadUserSetting("theme",this.appState.theme)),t.next=17,pe.setLanguage(this.loadUserSetting("lang",pe.locale));case 17:this.setDebug(this.loadUserSetting("debug",this.appState.debug)),z(this.events,"Settings loaded!","info");case 19:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"saveUserSettings",value:function(){this.settings.useCookies&&(this.saveUserSetting("resetSettings",!1),this.saveUserSetting("tileCacheHash",this.mapViewer.tileCacheHash),this.saveUserSetting("superSampling",this.mapViewer.data.superSampling),this.saveUserSetting("hiresViewDistance",this.mapViewer.data.loadedHiresViewDistance),this.saveUserSetting("lowresViewDistance",this.mapViewer.data.loadedLowresViewDistance),this.saveUserSetting("mouseSensitivity",this.appState.controls.mouseSensitivity),this.saveUserSetting("invertMouse",this.appState.controls.invertMouse),this.saveUserSetting("theme",this.appState.theme),this.saveUserSetting("lang",pe.locale),this.saveUserSetting("debug",this.appState.debug),z(this.events,"Settings saved!","info"))}},{key:"loadUserSetting",value:function(t,e){var i=Fn("bluemap-"+t);return void 0===i?e:i}},{key:"saveUserSetting",value:function(t,e){this.savedUserSettings.get(t)!==e&&(this.savedUserSettings.set(t,e),Un("bluemap-"+t,e))}}]),t}();String.prototype.includesCI=function(t){return this.toLowerCase().includes(t.toLowerCase())};var Hn=new Rn(document.getElementById("map-container"));window.bluemap=Hn,s["a"].config.productionTip=!1,Object.defineProperty(s["a"].prototype,"$bluemap",{get:function(){return Hn}});var Bn=new s["a"]({i18n:pe,render:function(t){return t(fi)}}).$mount("#app");pe.loadLanguageSettings().catch((function(t){return console.error(t)})),Bn.$nextTick((function(){Hn.load().catch((function(t){return console.error(t)}))}))},"5c0b":function(t,e,i){"use strict";i("9c0c")},"5dd6":function(t,e,i){},6274:function(t,e,i){},"627e":function(t,e,i){},"635d":function(t,e,i){"use strict";i("cf6e")},6865:function(t,e,i){"use strict";i("6274")},"76c6":function(t,e,i){},"7b65":function(t,e,i){},"7c75":function(t,e,i){},8568:function(t,e,i){},"89de":function(t,e,i){},"8dd3":function(t,e,i){},"982f":function(t,e,i){"use strict";i("3452")},"9c0c":function(t,e,i){},"9eb8":function(t,e,i){"use strict";i("04be")},a126:function(t,e,i){},a5f7:function(t,e,i){},bd0a:function(t,e,i){},bfc9:function(t,e,i){"use strict";i("bd0a")},c2cb:function(t,e,i){},c70c:function(t,e,i){"use strict";i("89de")},ce79:function(t,e,i){"use strict";i("627e")},cf6e:function(t,e,i){},e998:function(t,e,i){},ef8f:function(t,e,i){"use strict";i("a5f7")},fd67:function(t,e,i){"use strict";i("5dd6")},fdfd:function(t,e,i){}});
//# sourceMappingURL=app.2df3842f.js.map